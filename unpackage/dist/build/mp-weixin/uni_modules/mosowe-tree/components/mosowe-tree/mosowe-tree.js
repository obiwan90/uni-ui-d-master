"use strict";const e=require("../../../../common/vendor.js"),t={name:"mosowe-tree",props:{modelValue:{type:Array,default:()=>[]},data:{type:Array,default:()=>[]},label:{type:String,default:"label"},value:{type:String,default:"id"},children:{type:String,default:"children"},disabled:{type:String,default:"disabled"},showCheckbox:{type:Boolean,default:!1},defaultExpandedKeys:{type:[Array,Boolean],default:!1},expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!1},emptyText:{type:String,default:"暂无数据"},height:{type:String,default:"800rpx"},itemHeight:{type:String,default:"60rpx"},indent:{type:String,default:"36rpx"}},model:{prop:"modelValue",event:"update:modelValue"},data:()=>({sourceData:[],chooseList:[],scrollTop:0,list:[],showList:[],offsetY:0,offsetNum:5,openList:[],startIndex:0,itemHeightPx:0,mosoweTreeContainerPx:0}),computed:{wrapHeight(){const e=this.itemHeight.replace(/[0-9]/g,"");return parseInt(this.itemHeight)*this.list.length+e},pageNum(){return this.mosoweTreeContainerPx&&this.itemHeightPx?Math.ceil(this.mosoweTreeContainerPx/this.itemHeightPx)+this.offsetNum:this.offsetNum}},watch:{chooseList:{handler(){this.$emit("update:modelValue",this.chooseList)},deep:!0},data:{handler(){this.init()},deep:!0}},created(){this.init()},methods:{init(){this.treeAddLevel(),this.list=JSON.parse(JSON.stringify(this.sourceData)),this.chooseList=[...this.modelValue],this.nodeOpenStatus(),this.nodeInfo()},treeAddLevel(){const e=(t,i=-1)=>(i++,t.map((t=>{t.nodeLevel=i;const s=t[this.children];return s&&s.length&&e(s,i),t})));this.sourceData=e(this.data)},nodeOpenStatus(){var e;if("boolean"==typeof this.defaultExpandedKeys&&this.defaultExpandedKeys&&(this.list=this.openNodes(this.list,[])),Array.isArray(this.defaultExpandedKeys)&&(null==(e=this.defaultExpandedKeys)?void 0:e.length)){let e=this.getValueByKeyForObject({value:this.defaultExpandedKeys,source:this.list,valueKey:this.value,targetKey:this.value}).map((e=>e.toString().split("/").map(Number)));e=Array.from(new Set(e.flat(1/0))),this.list=this.openNodes(this.list,[],e)}},nodeInfo(){this.$nextTick((()=>{const t=e.index.createSelectorQuery().in(this);t.select("#mosowe-tree-container").boundingClientRect((e=>{this.mosoweTreeContainerPx=e.height.toFixed(2)})),t.select("#mosowe-tree-wrap").boundingClientRect((e=>{this.itemHeightPx=e.height.toFixed(2)/this.list.length,this.startIndex=0;let t=setTimeout((()=>{clearTimeout(t),t=null,this.handleScroll(null)}),100)})).exec()}))},openNodes(e,t,i=[]){const s=t.map((e=>e[this.value]));let h=JSON.parse(JSON.stringify(e)),l=e.length-1,r=!1;for(;l>-1;){const t=e[l];!this.hasChildren(t)||s.includes(t[this.value])||i.length&&!i.includes(t[this.value])||(this.openList.push(t[this.value]),h.splice(l+1,0,...t[this.children]),t[this.children].filter((e=>this.hasChildren(e))).length&&(r=!0)),l--}return r&&(h=this.openNodes(h,e,i)),h},handleScroll(e){var t;const i=Math.floor((null==(t=null==e?void 0:e.detail)?void 0:t.scrollTop)||0);this.offsetY=i-i%this.itemHeightPx;let s=Math.floor(i/this.itemHeightPx);s>this.offsetNum&&(this.offsetY-=this.offsetNum*this.itemHeightPx,s-=this.offsetNum),this.startIndex=s,this.setShowList()},setShowList(){this.showList=[...this.list].slice(this.startIndex,this.startIndex+this.pageNum+this.offsetNum)},hasChildren(e){return Object.keys(e).includes(this.children)&&e[this.children].length>0},openOrCloseChild(e){const t=e[this.value],i=this.openList.indexOf(t);if(i>-1){this.openList.splice(i,1);const t=this.treeToArray(e[this.children]).map((e=>{const t=this.openList.indexOf(e[this.value]);return t>-1&&this.openList.splice(t,1),e[this.value]}));this.list=this.list.filter((e=>!t.includes(e[this.value])))}else{this.openList.push(t);const i=this.list.findIndex((t=>t[this.value]===e[this.value]));this.list.splice(i+1,0,...e[this.children])}this.setShowList()},labelClick(e){this.$emit("nodeClick",e),this.checkOnClickNode&&this.showCheckbox?this.selectionClick(e):this.expandOnClickNode&&this.hasChildren(e)&&this.openOrCloseChild(e)},selectionClick(e){if(e[this.disabled])return;const t=this.chooseList.indexOf(e[this.value]);let i=[...this.chooseList];if(t>-1)i.splice(t,1),this.hasChildren(e)&&this.treeToArray(e[this.children]).forEach((e=>{const t=i.indexOf(e[this.value]);t>-1&&i.splice(t,1)}));else{let t=[e[this.value]];this.hasChildren(e)&&this.treeToArray(e[this.children]).forEach((e=>{t.push(e[this.value])})),i.push(...t)}this.chooseList=Array.from(new Set(i)),this.selectionCheckFather(e)},selectionCheckFather(e){const t=[...this.chooseList];if(e.nodeLevel>0){const i=this.list.findIndex((t=>t[this.value]===e[this.value]));e.nodeLevel,this.list.slice(0,i).reverse(),[].forEach((e=>{const i=this.treeToArray(e[this.children]);let s=!0;for(let h=0;h<i.length;h++){const e=i[h];if(!t.includes(e[this.value])){s=!1;break}}if(s)t.push(e[this.value]);else{const i=t.indexOf(e[this.value]);i>-1&&t.splice(i,1)}})),this.chooseList=Array.from(new Set(t))}},isHalfCheck(e){return Object.keys(e).includes(this.children)&&this.treeToArray(e[this.children]).filter((e=>this.chooseList.includes(e[this.value]))).length>0&&!this.isAllCheck(e)},isAllCheck(e){return this.chooseList.includes(e[this.value])},treeToArray(e){const t=JSON.parse(JSON.stringify(e));var i=[];if(Array.isArray(t))for(var s=0,h=t.length;s<h;s++)i.push(t[s]),Array.isArray(t[s][this.children])&&t[s][this.children].length>0&&(i=i.concat(this.treeToArray(t[s][this.children])));return i},getValueByKeyForObject(e){if(!e)return[];const{value:t,source:i,valueKey:s,targetKey:h}=e;let l="",r=[],o=t;const n=t=>{if(t[this.children]){let i=this.getValueByKeyForObject({...e,source:t[this.children]});i.length&&(l=t[h],i=i.map((e=>l+"/"+e))),r.push(...i)}};return"[object Object]"===Object.prototype.toString.call(i)?(o.includes(i[s])&&r.push(i[h]),n(i)):i.forEach((t=>{"[object Object]"===Object.prototype.toString.call(t)&&(o.includes(t[s])&&r.push(t[h]),n(t)),Array.isArray(t)&&r.push(...this.getValueByKeyForObject({...e,source:t}))})),r},getHalfCheck(){const e=this.treeToArray(this.sourceData).filter((e=>this.isHalfCheck(e))).map((e=>(delete e[this.children],e)));return{halfNodeKeys:e.map((e=>e[this.value])),halfNodes:e}},getCheckedNodes(){return this.treeToArray(this.sourceData).filter((e=>this.isAllCheck(e))).map((e=>(delete e[this.children],e)))},setCheckedKeys(e,t=!0){const i=this.treeToArray(this.sourceData);let s=[...this.chooseList];if(t)for(;e.length;){const t=e.pop();s.push(t);const h=i.filter((e=>e[this.value]===t))[0];if(h&&this.hasChildren(h)){const e=this.treeToArray(h[this.children]).map((e=>e[this.value]));s.push(...e)}}else for(;e.length;){const t=e.pop(),h=s.indexOf(t);h>-1&&s.splice(h,1);const l=i.filter((e=>e[this.value]===t))[0];if(l&&this.hasChildren(l)){let e=this.treeToArray(l[this.children]).map((e=>e[this.value]));for(;e.length;){const t=e.pop(),i=s.indexOf(t);i>-1&&s.splice(i,1)}}}this.chooseList=Array.from(new Set(s))},filter(e){e?(this.list=this.openNodes(this.filterDeal(this.sourceData,e),[]),this.nodeInfo()):(this.openList=[],this.init()),this.scrollTop=-1,setTimeout((()=>{this.scrollTop=0}),100)},filterDeal(e,t){let i=JSON.parse(JSON.stringify(e)),s=[];for(let h of i)h[this.label].includes(t)?(this.hasChildren(h)&&(h[this.children]=this.filterDeal(h[this.children],t)),s.push(h)):this.hasChildren(h)&&(h[this.children]=this.filterDeal(h[this.children],t),h[this.children].length&&s.push(h));return s}}};const i=e._export_sfc(t,[["render",function(t,i,s,h,l,r){return e.e({a:!s.data.length||!l.list.length},s.data.length&&l.list.length?{}:{b:e.t(s.emptyText)},{c:e.f(l.showList,((t,i,h)=>e.e({a:e.f(t.nodeLevel,((e,t,i)=>({a:e}))),b:l.openList.includes(t[s.value])&&r.hasChildren(t)?1:"",c:!l.openList.includes(t[s.value])&&r.hasChildren(t)?1:"",d:e.o((e=>r.openOrCloseChild(t)),i)},s.showCheckbox?{e:t[s.disabled]?1:"",f:r.isHalfCheck(t)?1:"",g:r.isAllCheck(t)?1:"",h:e.o((e=>r.selectionClick(t)),i)}:{},{i:e.t(t[s.label]),j:"d-"+h,k:e.r("d",{node:t},h),l:e.o((e=>r.labelClick(t)),i),m:i}))),d:s.showCheckbox,e:"translateY("+l.offsetY+"px)",f:r.wrapHeight,g:s.height,h:s.indent,i:s.itemHeight,j:s.height})}],["__scopeId","data-v-0a84c927"]]);wx.createComponent(i);
