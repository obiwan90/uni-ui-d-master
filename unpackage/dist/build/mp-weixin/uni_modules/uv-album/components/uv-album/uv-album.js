"use strict";var t,e;const i=require("../../../../common/vendor.js"),s=require("../../../uv-ui-tools/libs/mixin/mpMixin.js"),l=require("../../../uv-ui-tools/libs/mixin/mixin.js"),h={name:"uv-album",mixins:[s.mpMixin,l.mixin],emits:["albumWidth"],props:{urls:{type:Array,default:()=>[]},keyName:{type:String,default:""},singleSize:{type:[String,Number],default:180},multipleSize:{type:[String,Number],default:70},space:{type:[String,Number],default:6},singleMode:{type:String,default:"scaleToFill"},multipleMode:{type:String,default:"aspectFill"},maxCount:{type:[String,Number],default:9},previewFullImage:{type:Boolean,default:!0},rowCount:{type:[String,Number],default:3},showMore:{type:Boolean,default:!0},...null==(e=null==(t=i.index.$uv)?void 0:t.props)?void 0:e.album},data:()=>({singleWidth:0,singleHeight:0,singlePercent:.6}),watch:{urls:{immediate:!0,handler(t){1===t.length&&this.getImageRect()}}},computed:{imageStyle(){return(t,e)=>{const{space:i,rowCount:s,multipleSize:l,urls:h}=this,n=this.showUrls.length;this.urls.length;const r={marginRight:this.$uv.addUnit(i),marginBottom:this.$uv.addUnit(i)};return t===n&&(r.marginBottom=0),(e===s||t===n&&e===this.showUrls[t-1].length)&&(r.marginRight=0),r}},showUrls(){const t=[];return this.urls.map(((e,i)=>{if(i+1<=this.maxCount){const s=Math.floor(i/this.rowCount);t[s]||(t[s]=[]),t[s].push(e)}})),t},imageWidth(){return this.$uv.addUnit(1===this.urls.length?this.singleWidth:this.multipleSize)},imageHeight(){return this.$uv.addUnit(1===this.urls.length?this.singleHeight:this.multipleSize)},albumWidth(){let t=0;return t=1===this.urls.length?this.singleWidth:this.showUrls[0].length*this.$uv.getPx(this.multipleSize)+this.$uv.getPx(this.space)*(this.showUrls[0].length-1),this.$emit("albumWidth",t),t}},methods:{onPreviewTap(t){const e=this.urls.map((t=>this.getSrc(t)));i.index.previewImage({current:t,urls:e})},getSrc(t){return this.$uv.test.object(t)?this.keyName&&t[this.keyName]||t.src:t},getImageRect(){const t=this.getSrc(this.urls[0]);i.index.getImageInfo({src:t,success:t=>{const e=t.width>=t.height;this.singleWidth=e?this.singleSize:t.width/t.height*this.$uv.getPx(this.singleSize),this.singleHeight=e?t.height/t.width*this.singleWidth:this.singleSize},fail:()=>{this.getComponentWidth()}})},async getComponentWidth(){await this.$uv.sleep(30),this.$uGetRect(".uv-album__row").then((t=>{this.singleWidth=t.width*this.singlePercent}))}}};if(!Array){i.resolveComponent("uv-text")()}Math;const n=i._export_sfc(h,[["render",function(t,e,s,l,h,n){return{a:i.f(n.showUrls,((e,l,h)=>({a:i.f(e,((e,r,u)=>i.e({a:n.getSrc(e),b:s.showMore&&s.urls.length>s.rowCount*n.showUrls.length&&l===n.showUrls.length-1&&r===n.showUrls[n.showUrls.length-1].length-1},s.showMore&&s.urls.length>s.rowCount*n.showUrls.length&&l===n.showUrls.length-1&&r===n.showUrls[n.showUrls.length-1].length-1?{c:"ec80cde3-0-"+h+"-"+u,d:i.p({text:"+"+(s.urls.length-s.maxCount),color:"#fff",size:.3*t.$uv.getPx(s.multipleSize),align:"center",customStyle:"justify-content: center"})}:{},{e:r,f:i.s(n.imageStyle(l+1,r+1)),g:i.o((t=>s.previewFullImage?n.onPreviewTap(n.getSrc(e)):""),r)}))),b:l}))),b:1===s.urls.length?n.imageHeight>0?s.singleMode:"widthFix":s.multipleMode,c:i.s({width:n.imageWidth,height:n.imageHeight,borderRadius:"10rpx"}),d:n.albumWidth}}],["__scopeId","data-v-ec80cde3"]]);wx.createComponent(n);
