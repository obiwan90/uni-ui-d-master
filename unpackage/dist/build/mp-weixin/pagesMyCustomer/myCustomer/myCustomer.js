"use strict";const e=require("../../common/vendor.js"),o=require("../api/api.js"),a=require("../../stores/locationStore.js");if(require("../../stores/tokenStore.js"),require("../../stores/userInfoStore.js"),!Array){e.resolveComponent("custom-header")()}Math||((()=>"../../components/custom-header/custom-header.js")+n)();const n=()=>"../../uni_modules/qiao-select/components/qiao-select/qiaoSelect.js",t={__name:"myCustomer",setup(n){const t=e.ref([]),s=e.ref("phone"),u=e.ref("phone");a.useLocationStore(),e.ref([]),e.ref();const r=e.ref([{name:"客户名称",value:""},{name:"联系方式",value:""},{name:"绑定微信",value:""},{name:"门店名称",value:""},{name:"门店地址",value:""}]),l=e.ref({fullLocation:"",province:"",city:"",region:"",address:"",postCode:"",longitude:"",latitude:"",name:""});e.ref(0),e.ref(0);const i=requirePlugin("chooseLocation"),c=e=>{e.length>0&&v(e)},d=e=>{e&&(console.log("selectSearchChange e:",e),r.value[0].value=e.nik_name,r.value[1].value=e.lxfs,r.value[2].value=e.phone,r.value[3].value=e.shopname,r.value[4].value=e.shopadd)},v=async a=>{const n={phone:a,opid:e.index.getStorageSync("sessionInfo").opid,lx:"1"},s=await o.apiCustomerSearch(n);1===s.zt&&(console.log("res:",s),t.value=s.lists?s.lists:[])},m=()=>{p()};e.onMounted((async()=>{l.value=await a.useLocationStore().getForm()})),e.onShow((()=>{const e=i.getLocation();if(console.log(e),e){l.value.address=e.address,l.value.province=e.province,l.value.city=e.city,l.value.region=e.district,l.value.latitude=e.latitude.toString(),l.value.longitude=e.longitude.toString();const o=[];o.push(e.province),o.push(e.city),o.push(e.district),l.value.fullLocation=o.join(" "),l.value.name=e.name,r.value[4].value=l.value.address}}));const p=async()=>{const a={phone:r.value[1].value,opid:e.index.getStorageSync("sessionInfo").opid,khname:r.value[0].value,shopname:r.value[3].value,shopadd:r.value[4].value,khphone:r.value[2].value},n=await o.apiCustomerAdd(a);200===n.code&&(e.index.showToast({title:"添加成功",icon:"success",duration:2e3}),e.index.navigateBack()),201===n.code&&e.index.showToast({title:"已经存在客户",icon:"error",duration:2e3}),console.log("res:",n)};return(o,a)=>({a:e.o(c),b:e.o(d),c:e.p({keyId:2,dataList:e.unref(t),phText:"请输入客户完整电话进行搜索",searchKey:e.unref(s),showBorder:!1,disabled:!1,showField:e.unref(u)}),d:e.f(e.unref(r),((o,a,n)=>e.e({a:e.t(o.name),b:"绑定微信"!==o.name&&"商家名称"!==o.name},"绑定微信"!==o.name&&"商家名称"!==o.name?{c:o.value}:{},{d:"绑定微信"===o.name},"绑定微信"===o.name?{e:o.value}:{},{f:"商家名称"===o.name},"商家名称"===o.name?{g:o.value}:{},{h:a}))),e:e.o(m)})}},s=e._export_sfc(t,[["__scopeId","data-v-69dd20df"]]);wx.createPage(s);
