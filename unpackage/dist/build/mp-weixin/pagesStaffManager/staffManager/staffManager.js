"use strict";const e=require("../../common/vendor.js"),o=require("../../api/station/station.js"),t=require("../../stores/menuPermissionStore.js");if(!Array){(e.resolveComponent("custom-header")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list")+e.resolveComponent("van-swipe-cell")+e.resolveComponent("uni-collapse-item")+e.resolveComponent("uni-collapse"))()}Math||((()=>"../../components/custom-header/custom-header.js")+(()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../uni_modules/uni-list/components/uni-list/uni-list.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse/uni-collapse.js"))();const n={__name:"staffManager",setup(n){const s=t.usePermissionStore(),i=e.ref([]),a=e.ref(new Set),l=e=>a.value.has(e),r=o=>{s.loadMenuAuthority(),(!o.includes("/pagesAuthority/authority/authority?")||s.hasMenuAuthority("updateAuthority"))&&(!o.includes("/pagesStaffInfos/staffInfos/staffInfos")||s.hasMenuAuthority("employeeUpdate"))?e.index.navigateTo({url:o}):e.index.showToast({title:"您没有操作权限",icon:"success",duration:2e3})},u=e.ref(),d=e=>{const o=u.value.find((o=>o.id===e));if(o){const e=o.regTime,t=new Date(1e3*e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}return null},c=async()=>{const t={opid:JSON.parse(e.index.getStorageSync("userInfo")).opid},n=await o.apiStationStaffList(t);200===n.code&&(i.value=n.lists,u.value=n.yglist)},f=async(t,n,s)=>{const i={opid:e.index.getStorageSync("sessionInfo").opid,ygid:n,lx:s},a=await o.apiStationStaffAction(t,i);console.log("StaffAction:",a),200===a.code&&c()},p=async t=>{const n={opid:e.index.getStorageSync("sessionInfo").opid,gwid:t},s=await o.apiStationDel(n);console.log("apiStationDel:",s),200===s.code&&c()};return e.onMounted((()=>{c()})),e.onShow((()=>{c()})),(o,t)=>({a:e.p({backgroundColor:"#ffffff"}),b:e.f(e.unref(i),((o,t,n)=>({a:l(t)?"":1,b:e.t(o.name),c:e.t(o.yglist.length),d:e.o((e=>r("/pagesAuthority/authority/authority?forEdit="+o.id)),t),e:e.o((t=>{return n=o.id,s.loadMenuAuthority(),void(s.hasMenuAuthority("deletPost")?e.index.showModal({title:"提示",content:"确定要删除该岗位吗?",success:e=>{e.confirm?(console.log("确认删除"),p(n)):e.cancel&&console.log("取消删除")}}):e.index.showToast({title:"您没有操作权限",icon:"success",duration:2e3}));var n}),t),f:"d863587f-4-"+n+",d863587f-3-"+n,g:"d863587f-3-"+n+",d863587f-2-"+n,h:e.f(o.yglist,((t,s,i)=>e.e({a:e.t(t.name),b:t.phone},t.phone?{c:e.t(t.phone),d:e.t(d(t.ygid))}:{},{e:"0"===t.status},(t.status,{}),{f:e.o((o=>{return n=t.ygid,void e.index.showModal({title:"提示",content:"确定要删除该员工吗?",success:e=>{e.confirm?(console.log("确认删除"),f("/Home/Gly/ygxg?lx=3",n,3)):e.cancel&&console.log("取消删除")}});var n}),s),g:e.o((e=>r("/pagesStaffInfos/staffInfos/staffInfos?forEdit="+t.ygid+"&gwid="+o.id)),s),h:e.t("1"===t.status?"禁用":"启用"),i:e.o((o=>{return n=t.ygid,s=t.status,void e.index.showModal({title:"提示",content:"1"===s?"确定要禁用该员工吗?":"确定启用该员工",success:e=>{if(e.confirm){let e="1"===s?1:2;f(1===e?"/Home/Gly/ygxg?lx=1":"/Home/Gly/ygxg?lx=2",n,e)}else e.cancel}});var n,s}),s),j:"d863587f-5-"+n+"-"+i+",d863587f-2-"+n,k:s}))),i:e.t(o.name),j:"d863587f-2-"+n+",d863587f-1-"+n,k:e.p({open:l(t),"show-arrow":!1,titleBorder:"none",border:!1}),l:e.sr("collapseRef","d863587f-1-"+n,{f:1}),m:e.o((e=>(e=>{a.value.has(e)?a.value.delete(e):a.value.add(e)})(t)),t),n:"d863587f-1-"+n,o:t}))),c:e.p({border:!1}),d:e.p({rightWidth:"147"}),e:e.o((e=>r("/pagesAuthority/authority/authority"))),f:e.o((e=>r("/pagesStaffInfos/staffInfos/staffInfos")))})}},s=e._export_sfc(n,[["__scopeId","data-v-d863587f"]]);wx.createPage(s);
