"use strict";const e=require("../../common/vendor.js"),l=require("../../api/search/search.js"),a=require("../../api/qualityCheck/qualityCheck.js"),n=require("../../utils/common.js"),u=require("../api/api.js");if(!Array){(e.resolveComponent("custom-header")+e.resolveComponent("van-empty")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uv-input")+e.resolveComponent("uv-upload")+e.resolveComponent("uni-collapse-item")+e.resolveComponent("uni-collapse")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../components/custom-header/custom-header.js")+i+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uv-input/components/uv-input/uv-input.js")+(()=>"../../uni_modules/uv-upload/components/uv-upload/uv-upload.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse/uni-collapse.js")+o+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+e.unref(t))();const o=()=>"./components/inputConfirm.js",i=()=>"../../uni_modules/qiao-select/components/qiao-select/qiaoSelect.js",t=()=>"./components/jixingPannel.js",r={__name:"productInput",setup(o){e.ref(!1);const i=e.getCurrentInstance(),t=e.ref({xhid:"",ppid:"",nc:"",bb:"",wl:"",ys:"",bx:"",start:"",delivery:e.index.getStorageSync("locationForm").fullLocation.split(" ").join(",")}),r=e.ref(null),s=e.ref([]),c=e.ref([]),f=e.ref(!1),d=e.ref(null),v=e.ref(null),p=e=>{C.value=!e.show,e||(f.value=e.show)},m=async(e,l)=>{console.log("select data:",e),console.log("selectedTabs:",l),e.length>0&&(r.value.clearData(),S.value=[],t.value.xhid=e[0].xhid,t.value.ppid=e[0].ppid,z.value[0].value=e[0].xhname,await h())},h=async()=>{s.value=[],c.value=[],z.value[1].value="",z.value[2].value="";const e=await u.apiRecoveryList(t.value);200===e.code&&(s.value=e.nclist?e.nclist.filter((e=>e.name)):[],c.value=e.yslist?e.yslist.filter((e=>e.name)):[],0===s.value.length&&(s.value=null),0===c.value.length&&(c.value=null),y()),console.log("Recovery list:",e)},g=e.computed((()=>z.value.filter(((e,l)=>"型号全称"!==e.key&&((1!==l||null!==s.value)&&(2!==l||null!==c.value)))))),y=async()=>{const e={xhid:t.value.xhid,ncid:z.value.find((e=>"内存"===e.key)).id,ysid:z.value.find((e=>"颜色"===e.key)).id},l=await u.apiGetProductId(e);"200"===l.code&&l.infos?(F.value=l.infos.id,K(l.infos.id).then((()=>{Y.value=new Array(T.value.length).fill(null)}))):N.value="",console.log(" 请求  productId.value:",N.value)};e.ref(!1);const b=e.ref("spname"),k=e.ref("spname"),x=e.ref(null),w=e=>{T.value[e];const l=Y.value[e];return l&&"1"===l.tpbs},j=e.ref("1"),E=e.reactive({batteryEfficiency:"",imei:"",purchaseEmployee:"",remark:"",warehouse:"",successId:"",ckid:"",cgyid:""}),I=e.ref(null),C=e.ref(!0),S=e.ref([]),T=e.ref([]),q=e.ref([]),_=e.ref([]);e.ref();const z=e.ref([{key:"型号",placeholder:"请搜索相关型号",value:""},{key:"内存",placeholder:"请搜索相关型号",value:""},{key:"颜色",placeholder:"请搜索相关型号",value:""},{key:"型号全称",placeholder:"",value:""}]),D=e.ref({title:"保修截止",values:["","",""],time:""}),A=e.ref([]),L=e.ref("");e.ref("");const Q=e.reactive({}),R=l=>{l.length>0&&(e.index.showLoading({title:"加载中....",mask:!0}),console.log("inputText",l),O(l),e.index.hideLoading())},F=e.ref(""),N=e.ref(""),P=e=>{if(e){console.log("selectSearchChange e:",e);const{id:l,xhname:a,ncname:n,ysname:u,spname:o}=e;F.value=l,z.value[0].value=a,z.value[1].value=n,z.value[2].value=u,z.value[3].value=o,s.value=[],c.value=[],S.value=[],K(l).then((()=>{Y.value=new Array(T.value.length).fill(null)}))}},B=e.ref(""),$=e=>{console.log("仓库 e:",e),B.value=M.value[e.detail.value].name,E.warehouse=B.value,E.ckid=M.value[e.detail.value].id},O=async e=>{const a={word:e},n=await l.apiSearchGoods(a);console.log("search res:",n),"200"===n.code&&(S.value=n.lists?n.lists:[])},G=e.ref(),J=e.ref([]),M=e.ref([]),V=e.ref(!1),K=async l=>{const n={opid:e.index.getStorageSync("sessionInfo").opid,id:l},u=await a.apiQualityCheckItem(n);if(200===u.code){if(V.value=u.lists.some((e=>e.name.includes("保修截止"))),T.value=u.lists.filter((e=>"保修截止"!==e.name)),console.log("dynamicList:",T.value),W.value=T.value.map((()=>!1)),q.value=u.gjbb,_.value=u.wlbb,G.value=u.infos,J.value=u.cgylist,M.value=u.cklist,M.value.length>0){const e=M.value.filter((e=>"1"===e.sxck));e.length>0&&(B.value=e[0].name,E.ckid=e[0].id,E.warehouse=B.value)}z.value[0].value=G.value.xhname,z.value[1].value=G.value.ncname,z.value[2].value=G.value.ysname,z.value[3].value=G.value.spname}},W=e.ref([]),Y=e.ref([]),H=e.ref(null),U=e.ref(null),X=(e,l)=>{Y.value[e]=l,A.value[e]=l.name,console.log("selectedText:",A.value),console.log("clickedItems:",Y.value),w(e)?W.value[e]=!0:W.value[e]=!1},Z=(e,l)=>Y.value[e]===l,ee=e=>H.value===e,le=e=>U.value===e,ae=e=>{const l=new Date(e.detail.value),a=l.getFullYear(),n=l.getMonth()+1,u=l.getDate();D.value.time=`${a}-${String(n).padStart(2,"0")}-${String(u).padStart(2,"0")}`,D.value.values[0]=a,D.value.values[1]=n,D.value.values[2]=u},ne=e=>{console.log("员工 e.detail.value:",e.detail.value),L.value=J.value[e.detail.value].username,E.purchaseEmployee=L.value,E.cgyid=J.value[e.detail.value].id},ue=()=>{I.value.close(),v.value.close(),C.value=!0},oe=()=>{e.index.scanCode({success:function(e){switch(console.log("条码类型："+e.scanType),console.log("条码内容："+e.result),e.scanType){case"QR_CODE":case"EAN_13":case"barCode":case"datamatrix":case"pdf417":break;default:e.scanType}E.imei=e.result}})},ie=()=>{if(console.log("comfrm check:",Q),console.log("formData",E),E.imei)if(E.imei.length===parseInt(G.value.cd))if(1!==G.value.sfjcdcxl||E.batteryEfficiency)if(console.log("formData.batteryEfficiency:",E.batteryEfficiency),E.batteryEfficiency&&parseInt(E.batteryEfficiency)>100)e.index.showToast({title:"电池效率不能大于100",icon:"none",duration:2e3});else if(H.value)if(U.value)if(Y.value.some((e=>!e)))e.index.showToast({title:"请选择所有检测项",icon:"none",duration:2e3});else if(E.purchaseEmployee)if(E.warehouse){for(let l=0;l<T.value.length;l++){const a=T.value[l];if(Y.value[l],w(l)&&(!Q[l]||0===Q[l].length))return void e.index.showToast({title:`请上传 ${a.name} 的图片`,icon:"none",duration:2e3})}(async()=>{const l=[];for(let e in Q)Q[e]&&Q[e].forEach((e=>{l.push({id:e.itemId,url:e.url})}));const n={id:N.value,opid:JSON.parse(e.index.getStorageSync("userInfo")).opid,ch:E.imei,gjbbid:H.value.id,wlbbid:U.value.id,ycbgtplist:JSON.stringify(l),jbztid:Y.value.map((e=>e.id)).join(","),jbztcolor:Y.value.map((e=>e.color)).join(","),jkbz:E.remark,efficiency:E.batteryEfficiency,bxsj:D.value.time,lx:"1",ckid:E.ckid,cgyid:E.cgyid,qcid:F.value};try{const l=await a.apiQualityCheckAdd1(n);console.log("apiQualityCheckAddData:",l),1===l.zt?(E.successId=l.ids,E.zjid=l.ids,x.value.getData(E.imei),"QC"!==se.value?I.value.open():e.index.showToast({title:"提交成功",icon:"none",duration:2e3}),N.value=l.ids):201===l.zt?e.index.showToast({title:"已有串号商品，请重新检测串号",icon:"none",duration:2e3}):e.index.showToast({title:"录入失败，请重试",icon:"none",duration:2e3})}catch(u){console.log("apiQualityCheckAddData :",u)}})()}else e.index.showToast({title:"请选择录入仓库",icon:"none",duration:500});else e.index.showToast({title:"请选择采购员工",icon:"none",duration:500});else e.index.showToast({title:"请选择网络版本",icon:"none",duration:2e3});else e.index.showToast({title:"请选择国家版本",icon:"none",duration:2e3});else e.index.showToast({title:"请输入电池效率",icon:"none",duration:2e3});else e.index.showToast({title:`IMEI 必须是 ${G.value.cd} 位`,icon:"none",duration:2e3});else e.index.showToast({title:"请输入商品串号",icon:"none",duration:2e3})},te=()=>{E.batteryEfficiency="",E.imei="",E.remark="",E.warehouse="",E.ckid="",E.cgyid="",E.purchaseEmployee="",E.successId="",D.value.time="",Y.value=[],H.value=null,U.value=null,L.value="",A.value=[],D.value.time="",D.value.values=["","",""],T.value=[],W.value=[],D.value={title:"保修截止",values:["","",""],time:""},V.value=!1,q.value=[],_.value=[],F.value="",N.value="",z.value=[{key:"型号",placeholder:"请搜索相关型号",value:""},{key:"内存",placeholder:"请搜索相关型号",value:""},{key:"颜色",placeholder:"请搜索相关型号",value:""},{key:"型号全称",placeholder:"",value:""}],S.value=[],r&&r.value&&r.value.clearData()},re=e=>{console.log("e",e);const{jbztycbg:l,machine:a,id:n,ch:u,gjbbname:o,wlbbname:i,efficiency:t,bxsj:r,cgyname:s,ckid:c,jkbz:f,qcid:d}=e;N.value=n,F.value=d,K(d).then((()=>{Y.value=new Array(T.value.length).fill(null),E.imei=u,((e,l)=>{q.value.forEach((l=>{l.name===e&&(H.value=l)})),_.value.forEach((e=>{e.name===l&&(U.value=e)}))})(o,i),(e=>{E.batteryEfficiency=e})(t),(e=>{D.value.time=e,e.split("-").forEach(((e,l)=>{D.value.values[l]=parseInt(e)}))})(r),(e=>{J.value.forEach((l=>{l.name===e&&(L.value=l.name,E.cgyid=l.id)}))})(s),(e=>{M.value.forEach((l=>{l.id===e&&(B.value=l.name,E.ckid=l.id)}))})(c),(e=>{E.jkbz=e})(f),(e=>{e&&e.split(",").forEach((e=>{T.value.forEach(((l,a)=>{const n=l.er.find((l=>l.id==e));n&&(Y.value[a]=n,A.value[a]=n.name,W.value[a]=!0)}))}))})(a),(e=>{e&&JSON.parse(e).forEach((e=>{const l=T.value.findIndex((l=>l.id==e.id));-1!==l&&(Q[l]||(Q[l]=[]),Q[l].push({url:e.url,itemId:e.id}))}))})(l)}))};e.index.$on("productInputRefresh",(()=>{te()}));const se=e.ref("");return e.onLoad((l=>{l.ch&&(async l=>{const n={opid:e.index.getStorageSync("sessionInfo").opid,ch:l},u=await a.apiQualityCheckSerialSearch(n);if(200===u.code)return S.value=u.lists?u.lists:[]})(l.ch).then((e=>{console.log("apiQualityCheckSerialSearchData:",e),re(e[0])})),l.from&&(se.value=l.from)})),(l,a)=>e.e({a:e.sr(r,"c2ff1dfe-1",{k:"qselect"}),b:e.o(R),c:e.o(P),d:e.p({keyId:2,dataList:e.unref(S),phText:"请搜索并确认型号全称",searchKey:e.unref(b),showBorder:!1,disabled:!1,showField:e.unref(k)}),e:e.f(e.unref(g).slice(0,3),((l,a,n)=>e.e({a:e.t(l.key),b:l.placeholder,c:l.value,d:e.o((e=>l.value=e.detail.value),a),e:0===a},0===a?{f:e.o((e=>(f.value=!0,void v.value.open())),a)}:{},{g:1===a&&null!==e.unref(s)&&e.unref(s).length>0},1===a&&null!==e.unref(s)&&e.unref(s).length>0?{h:e.unref(s),i:e.o((e=>(async e=>{console.log("选择 e:",e);const l=z.value.find((e=>"内存"===e.key));if(l){console.log("memoryItem",l),console.log("nclist.value",s.value);const a=Number(e.detail.value);a>=0&&a<s.value.length?(l.id=s.value[a].id,l.value=s.value[a].name,await y()):console.error("无效的索引:",a)}else console.error("未找到内存项")})(e)),a),j:e.unref(z)[1].value}:{},{k:2===a&&null!==e.unref(c)&&e.unref(c).length>0},2===a&&null!==e.unref(c)&&e.unref(c).length>0?{l:e.unref(c),m:e.o((e=>(async e=>{console.log("选择 e:",e);const l=z.value.find((e=>"颜色"===e.key));if(l){const a=Number(e.detail.value);a>=0&&a<c.value.length?(l.id=c.value[a].id,l.value=c.value[a].name,await y()):console.error("无效的索引:",a)}else console.error("未找到颜色项")})(e)),a),n:e.unref(z)[2].value}:{},{o:a}))),f:0==e.unref(T).length},0==e.unref(T).length?{g:e.p({image:"search",description:"请搜索相关型号"})}:{},{h:e.unref(T).length>0},e.unref(T).length>0?{i:e.o((a=>e.unref(i).proxy.copyText(l.receivedData.imei))),j:e.o((l=>e.unref(E).imei=l)),k:e.p({clearable:!0,inputBorder:!1,maxlength:e.unref(G).cd,placeholder:"请输入商品串号",modelValue:e.unref(E).imei}),l:e.o(oe)}:{},{m:e.unref(T).length>0&&1===e.unref(G).sfjcdcxl},e.unref(T).length>0&&1===e.unref(G).sfjcdcxl?{n:e.o((l=>e.unref(E).batteryEfficiency=l)),o:e.p({inputAlign:"right",maxlength:"3",type:"number",placeholder:"请输入",border:"none",modelValue:e.unref(E).batteryEfficiency})}:{},{p:e.unref(q).length>0},e.unref(q).length>0?{q:e.f(e.unref(q),((l,a,n)=>({a:e.t(l.name),b:ee(l)?1:"",c:ee(l)?1:"",d:a,e:e.o((e=>(e=>{H.value=e,console.log("selectedGjbb:",H.value)})(l)),a)})))}:{},{r:e.unref(_).length>0},e.unref(_).length>0?{s:e.f(e.unref(_),((l,a,n)=>({a:e.t(l.name),b:le(l)?1:"",c:le(l)?1:"",d:a,e:e.o((e=>(e=>{U.value=e,console.log("selectedWlbb:",U.value)})(l)),a)})))}:{},{t:e.unref(V)},e.unref(V)?{v:e.o(ae),w:e.f(e.unref(D).values,((l,a,n)=>({a:e.t(0===a?"年":1===a?"月":2===a?"日":""),b:"c2ff1dfe-5-"+n,c:e.p({inputAlign:"right",type:"number",border:"none",value:l}),d:a})))}:{},{x:e.unref(T).length>0},e.unref(T).length>0?{y:e.f(e.unref(T),((l,a,u)=>e.e({a:"保修截止"!==l.name},"保修截止"!==l.name?e.e({b:e.t(l.name),c:e.t(e.unref(A)[a]),d:e.unref(W)[a]?1:"",e:e.f(l.er.slice(0,3),((l,n,u)=>({a:e.t(l.name),b:Z(a,l)?1:"",c:Z(a,l)?1:"",d:n,e:e.o((e=>X(a,l)),n)}))),f:l.er.length>3},l.er.length>3?{g:e.f(l.er.slice(3),((l,n,u)=>({a:e.t(l.name),b:Z(a,l)?1:"",c:Z(a,l)?1:"",d:n+3,e:e.o((e=>X(a,l)),n+3)})))}:{},{h:w(a)},w(a)?{i:e.o((e=>((e,l,a)=>{console.log("itemId:",a),console.log("上传 event:",e),n.uploadFilesByIndex1(e,l,Q,a)})(e,a,l.id)),a),j:e.o((l=>e.unref(n.uploadCheack)(l,a)),a),k:e.o((e=>((e,l)=>{n.uploadDeleteByIndex(e,l,Q)})(e,a)),a),l:"c2ff1dfe-8-"+u+",c2ff1dfe-7-"+u,m:e.p({fileList:e.unref(Q)[a]||[],accept:"image",maxCount:e.unref(j),maxSize:"5242880",width:"152rpx",height:"152rpx",sizeType:["compressed"],previewFullImage:!0,previewFullVideo:!1})}:{},{n:"c2ff1dfe-7-"+u+",c2ff1dfe-6-"+u,o:e.p({"show-arrow":!1,open:e.unref(W)[a],titleBorder:"none",border:!1}),p:e.sr("collapseRef","c2ff1dfe-6-"+u,{f:1}),q:e.o((e=>((e,l)=>{console.log("面板：",e.length>0),W.value[l]=e.length>0})(e,a)),a),r:"c2ff1dfe-6-"+u}):{},{s:a})))}:{},{z:e.unref(T).length>0},e.unref(T).length>0?{A:e.t(e.unref(L)?e.unref(L):"请选择"),B:e.unref(J),C:e.o(ne),D:e.unref(L)}:{},{E:e.unref(T).length>0},e.unref(T).length>0?{F:e.t(e.unref(B)?e.unref(B):"请选择"),G:e.unref(M),H:e.o($),I:e.unref(B)}:{},{J:e.unref(T).length>0},e.unref(T).length>0?{K:e.unref(E).remark,L:e.o((l=>e.unref(E).remark=l.detail.value))}:{},{M:e.unref(T).length>0},e.unref(T).length>0?{N:e.o(te),O:e.o(ie)}:{},{P:e.unref(C),Q:e.sr(x,"c2ff1dfe-10,c2ff1dfe-9",{k:"inputConfirmRef"}),R:e.unref(N),S:e.o(ue),T:e.p({purchaseEmployee:e.unref(E).purchaseEmployee,id:e.unref(N),zjid:e.unref(E).zjid,imei:e.unref(E).imei,content:e.unref(z)}),U:e.sr(I,"c2ff1dfe-9",{k:"inputPopup"}),V:e.o(ue),W:e.o(p),X:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"}),Y:e.unref(f)},e.unref(f)?{Z:e.sr(d,"c2ff1dfe-12,c2ff1dfe-11",{k:"jixingPannelRef"}),aa:e.o(m),ab:e.o(ue)}:{},{ac:e.sr(v,"c2ff1dfe-11",{k:"jixingPopup"}),ad:e.o(ue),ae:e.o(p),af:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"})})}},s=e._export_sfc(r,[["__scopeId","data-v-c2ff1dfe"]]);wx.createPage(s);
