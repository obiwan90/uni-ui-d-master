"use strict";const e=require("../../common/vendor.js"),a=require("../../stores/menuPermissionStore.js"),l=require("../api/api.js"),o=require("../../api/shopCard/shopCard.js"),t=require("../../utils/common.js"),u=require("../../stores/userInfoStore.js");if(!Array){(e.resolveComponent("custom-channel-tap")+e.resolveComponent("van-tag")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list")+e.resolveComponent("uni-collapse-item")+e.resolveComponent("uni-collapse")+e.resolveComponent("uni-popup")+e.resolveComponent("uni-badge"))()}const n=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js",i=()=>"../../uni_modules/uni-badge/components/uni-badge/uni-badge.js";Math||((()=>"../../components/custom-channel-tap/custom-channel-tap.js")+(()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../uni_modules/uni-list/components/uni-list/uni-list.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse/uni-collapse.js")+e.unref(s)+n+e.unref(p)+e.unref(c)+i+e.unref(r)+e.unref(v))();const r=()=>"./components/share.js",s=()=>"./components/poster.js",v=()=>"./components/posterPannel.js",p=()=>"./components/bargaining.js",c=()=>"./components/detailProductEditPrice.js",d={__name:"productDetail",setup(n){const i=e.ref(!1),r=()=>{i.value=!1,e.index.reLaunch({url:"/pages/home/home"})},s=e.getCurrentInstance(),v=e.index.getStorageSync("selectedMine"),p=e.index.getStorageSync("identityData"),c=e.index.getStorageSync("adminId"),d=a.usePermissionStore(),m=e.ref(null),g=e.ref(""),f=e.ref(null),b=e.ref(null),y=e.ref(!1),x=e.ref(!1),h=e.ref(!1),j=e.ref(null),z=e.ref(!1),C=e.ref(null),w=e.ref(null),S=e.ref(null),k=e.ref();e.ref(null);const D=e.ref(),P=e.ref(!1),q=e.ref({id:""}),F=e.ref([]),T=e.ref([]),I=e.ref([]),_=e.ref([]),A=e.ref(null),E=e.ref([]),O=e.ref([]),B=e.ref(""),M=e.computed((()=>u.useUserStore().shopCount)),R=e.ref([{type:"gjbbname",title:"国家版本",value:"无"},{type:"wlbbname",title:"网络版本",value:"无"},{type:"bxzt",title:"保修状态",value:"无"},{type:"efficiency",title:"电池效率",value:"无"},{type:"delivery",title:"发货地",value:"无"}]),U=e.computed((()=>a.usePermissionStore().hasMenuAuthority("updategoods")&&""!==c)),J=e.computed((()=>{if(c&&v&&p){const e=p[v];return!!e&&A.value.gsid===e.gsid}return!1})),L=()=>{var e,a,l,o;null==(e=C.value)||e.close(),null==(a=w.value)||a.close(),null==(l=S.value)||l.close(),null==(o=j.value)||o.close()},N=e=>{h.value=e.show,e.show||(y.value=!1,x.value=!1,z.value=!1)},W=()=>{var e;return null==(e=C.value)?void 0:e.open()},$=()=>{var e;return null==(e=w.value)?void 0:e.open()},G=async a=>{var l;D.value=a,f.value=A.value,P.value=!0,await e.nextTick$1(),setTimeout((()=>{var e;null==(e=b.value)||e.handleShow()}),1e3),null==(l=C.value)||l.close()},X=()=>P.value=!1,H=()=>{var e;f.value=A.value,null==(e=m.value)||e.posterShow()},Y=e=>{const a=new Date(1e3*e);return`${a.getFullYear()}/${String(a.getMonth()+1).padStart(2,"0")}/${String(a.getDate()).padStart(2,"0")}`},Z=e=>_.value.some((a=>a.id===e)),K=async a=>{try{e.index.showLoading({title:"加载中..."});const o=await l.apiGetProductDetail({id:a.value.id});if("200"===o.code){A.value=o.infos,F.value=A.value.jbztycbg?JSON.parse(A.value.jbztycbg):[],T.value=A.value.gnjcycbg?JSON.parse(A.value.gnjcycbg):[],I.value=A.value.wxjcycbg?JSON.parse(A.value.wxjcycbg):[],_.value=[...F.value,...T.value,...I.value].map((e=>({id:e.id,url:e.url})));const e=new Date;e.setHours(0,0,0,0),E.value=o.infos.qualityinspection.map((a=>(a.er=a.er.filter((e=>"液晶显示"!==e.name)),a.er.forEach((a=>{"保修截止"===a.name&&(a.xznr=new Date(A.value.bxsj)<e?A.value.bxzt:A.value.bxsj,a.xznrcor="")})),a)));const{yjxsimg:a,jswgimg:l,pmwgimg:t}=A.value;O.value=[{imgs:l.split(",")},{imgs:t.split(",")},{imgs:a.split(",")}],o.yjinfos&&(A.value.combinationid.push(o.yjinfos.qminfos),A.value.combinationname.push(o.yjinfos.name),A.value.combinationyslist.push(o.yjinfos.color)),R.value=R.value.map((e=>({...e,value:o.infos[e.type]||"无"}))),B.value=[A.value.jkbz,A.value.gnjcbz,A.value.wxjcbz,A.value.pzbz,A.value.csbz].join(" ")}}catch(o){console.error("获取数据失败",o),e.index.showToast({title:"加载失败",icon:"none"})}finally{e.index.hideLoading()}},Q=e=>{console.log(e)},V=async()=>{"200"===(await o.apiAddShopCard({opid:e.index.getStorageSync("sessionInfo").opid,goodsid:A.value.id})).code?(e.index.showToast({title:"成功加入购物车",icon:"success"}),u.useUserStore().shopCount++):e.index.showToast({title:"购物车已存在相同商品",icon:"none"})},ee=async()=>{await V();const a=encodeURIComponent(JSON.stringify({lx:"2",id:q.value.id}));e.index.navigateTo({url:`/pagesSubOrder/subOrder/subOrder?data=${a}`})},ae=()=>t.saveImagesToAlbum((A.value.productimage.endsWith(",")?A.value.productimage.slice(0,-1):A.value.productimage).split(",")),le=()=>K(q);return e.onLoad((async e=>{e.id&&(q.value.id=e.id),await K(q),e.share&&(i.value=!0),s.proxy.setShareOptions({title:A.value?A.value.name:"",imageUrl:(A.value.productimage.endsWith(",")?A.value.productimage.slice(0,-1):A.value.productimage).split(",")[0],sharePath:"/pagesProductDetail/productDetail/productDetail?share=true&id="+q.value.id})})),e.onShow((async()=>{await u.useUserStore().refreshShopCarCount(),d.loadMenuAuthority(),await K(q)})),(a,l)=>e.e({a:i.value},i.value?{b:i.value,c:e.o(r)}:{},{d:A.value},A.value?e.e({e:e.f((A.value.productimage.endsWith(",")?A.value.productimage.slice(0,-1):A.value.productimage).split(","),((a,l,o)=>e.e({a:""!==a},""!==a?{b:a,c:e.o((e=>{return l=a,t.previewImages((A.value.productimage.endsWith(",")?A.value.productimage.slice(0,-1):A.value.productimage).split(","),l);var l}),l)}:{},{d:l}))),f:"1"===A.value.zjlx},"1"===A.value.zjlx?{g:e.p({text1:"官方质检",text1Color:"#E6432E",text2:A.value.finenessname,backgroundColor:"linear-gradient( 132deg, #D94C24 0%, #FF5221 100%)"})}:{},{h:"2"===A.value.zjlx},"2"===A.value.zjlx?{i:e.p({text1:"授权质检",text1Color:"#246C14",text2:A.value.finenessname,backgroundColor:"linear-gradient( 135deg, #246B13 0%, #39D591 100%)"})}:{},{j:"3"===A.value.zjlx},"3"===A.value.zjlx?{k:e.p({text1:"自由货源",text1Color:"#FF6C27",text2:A.value.finenessname,backgroundColor:"linear-gradient( 135deg, #FF6A27 0%, #FEB82E 100%) "})}:{},{l:e.t(A.value.name),m:e.t(A.value.price),n:"1"===A.value.special},(A.value.special,{}),{o:2===A.value.yjzt},2===A.value.yjzt?{p:e.p({size:"mini",plain:!0,textColor:"#EB4636"})}:{},{q:"1"===A.value.byzt},"1"===A.value.byzt?{r:e.p({size:"mini",plain:!0,textColor:"#669CFD"})}:{},{s:"2"===A.value.byzt},"2"===A.value.byzt?{t:e.p({size:"mini",plain:!0,textColor:"#669CFD"})}:{},{v:2===A.value.yjzt},2===A.value.yjzt?{w:e.o($)}:{},{x:e.f(R.value,((a,l,o)=>({a:e.t(a.title),b:e.t(a.value),c:l}))),y:U.value&&J.value},U.value&&J.value?{z:e.t(A.value.cgyname),A:e.t(A.value.ckname),B:e.t(Y(A.value.updatetime)),C:e.o((e=>{return a=A.value,k.value=a,z.value=!0,void(null==(l=j.value)||l.open());var a,l}))}:{},{D:e.o((a=>{return l="/pagesAftersalesRules/aftersalesRules/aftersalesRules",void e.index.navigateTo({url:l});var l})),E:e.t(A.value.zjr),F:e.t(A.value.wpbm),G:e.o((a=>e.unref(t.copyText)(A.value.wpbm.replace(/^XZXS/i,"")))),H:e.t(B.value),I:e.f(A.value.combinationid,((a,l,o)=>{var u;return{a:e.t(a),b:e.t(A.value.combinationname[l]),c:A.value.combinationyslist[l],d:e.f(null==(u=O.value[l])?void 0:u.imgs,((a,o,u)=>({a:o,b:a,c:e.o((e=>{var o,u,n;return u=null==(o=O.value[l])?void 0:o.imgs,n=a,t.previewImages(u,n)}),o)}))),e:l}})),J:e.f(E.value,((a,l,o)=>({a:e.t(a.name),b:e.t(0===a.ycnum?"全部正常":a.ycnum+"项异常"),c:0===a.ycnum?"#41AF6F":"#ED784B",d:"010d5914-9-"+o+",010d5914-8-"+o,e:"010d5914-8-"+o+",010d5914-7-"+o,f:e.f(a.er,((a,l,o)=>e.e({a:e.t(a.name),b:Z(a.id)},(Z(a.id),{}),{c:e.t(a.xznr),d:""===a.xznrcor?"":a.xznrcor,e:e.o((l=>(a=>{const l=_.value.map((e=>e.url)),o=_.value.findIndex((e=>e.id===a));e.index.previewImage({current:o,urls:l})})(a.id)),l),f:l}))),g:l,h:"010d5914-7-"+o+",010d5914-6"}))),K:e.p({border:!1}),L:e.p({titleBorder:"none",border:!1}),M:e.o(G),N:e.o(L),O:e.p({infos:A.value,modelData:R.value}),P:e.sr(C,"010d5914-10",{k:"posterPopup"}),Q:e.o(L),R:e.o(N),S:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"}),T:e.o(L),U:q.value.id,V:e.p({id:q.value.id}),W:e.sr(w,"010d5914-12",{k:"bargainingPopup"}),X:e.o(L),Y:e.o(N),Z:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"}),aa:z.value},z.value?{ab:e.o(le),ac:e.o(L),ad:e.p({selectedGood:k.value,combinationname:A.value.combinationname})}:{},{ae:e.sr(j,"010d5914-14",{k:"productEditPricePopup"}),af:e.o(L),ag:e.o(N),ah:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"})}):{},{ai:!h.value,aj:e.o(H),ak:e.o(ae),al:e.o(W),am:e.o(W),an:e.p({size:"small",text:"",absolute:"rightTop",type:"error"}),ao:e.o(Q),ap:"/pagesProductDetail/productDetail/productDetail?share=true&id="+q.value.id,aq:e.p({size:"small",text:M.value,absolute:"rightTop",type:"error"}),ar:e.o((a=>{return l="/pagesShopCar/shopCar/shopCar",void e.index.navigateTo({url:l});var l})),as:e.o((e=>V())),at:e.o(ee),av:P.value},P.value?{aw:e.sr(b,"010d5914-18",{k:"sharePopup"}),ax:e.o(X),ay:e.p({posterPrice:g.value,infos:f.value,data:D.value,qualityinspection:E.value,modelData:R.value})}:{},{az:e.sr(m,"010d5914-19",{k:"qualityPosterPopup"}),aA:e.p({infos:f.value,titleRemarl:B.value,modelData:R.value,qualityinspection:E.value})})}},m=e._export_sfc(d,[["__scopeId","data-v-010d5914"]]);wx.createPage(m);
