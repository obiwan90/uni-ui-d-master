"use strict";const e=require("../../../common/vendor.js"),o=require("../../../stores/userInfoStore.js");if(!Array){(e.resolveComponent("l-painter-image")+e.resolveComponent("l-painter-text")+e.resolveComponent("l-painter-view")+e.resolveComponent("l-painter-qrcode")+e.resolveComponent("l-painter")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni_modules/lime-painter/components/l-painter-image/l-painter-image.js")+(()=>"../../../uni_modules/lime-painter/components/l-painter-text/l-painter-text.js")+(()=>"../../../uni_modules/lime-painter/components/l-painter-view/l-painter-view.js")+(()=>"../../../uni_modules/lime-painter/components/l-painter-qrcode/l-painter-qrcode.js")+(()=>"../../../uni_modules/lime-painter/components/l-painter/l-painter.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const t={__name:"share",props:{infos:{type:Object,default:()=>{}},qualityinspection:{type:Array,default:()=>[]},modelData:{type:Array,default:()=>[]},data:{type:Object,default:()=>{}}},emits:["closeSharePannel"],setup(t,{expose:n,emit:i}){const p=e.ref(!1),s=e.ref(!1),r=e.ref(),a=t,l=()=>{console.log("share Popup is closed"),m.value.close()},c=e=>{e.show||(s.value=e.show,p.value=e.show,console.log("share Popup is closed"))},u=e.computed((()=>(console.log("props.modelData",a.modelData),a.modelData.filter((e=>"无"!==e.value&&"delivery"!==e.type))))),x=e.computed((()=>{const e=a.qualityinspection[0];return 0===e.ycnum?`${e.name}全部通过`:`${e.name}${e.ycnum}项异常`})),d=e.computed((()=>{const e=a.qualityinspection[1];return 0===e.ycnum?`${e.name}全部通过`:`${e.name}${e.ycnum}项异常`})),f=e.computed((()=>{const e=a.qualityinspection[2];return 0===e.ycnum?`${e.name}全部通过`:`${e.name}${e.ycnum}项异常`}));e.computed((()=>a.infos.shopname+"专员"));const g=e.ref(null),m=e.ref(null),h=e.ref(""),F=()=>new Promise(((o,t)=>{e.nextTick$1((()=>{g.value?g.value.canvasToTempFilePathSync({fileType:"jpg",pathType:"url",quality:.6,success:e=>{console.log(e.tempFilePath),h.value=e.tempFilePath,m.value.open(),o()},fail:o=>{console.log(o),e.index.showToast({title:"生成分享图片失败",icon:"none"}),t(o)}}):(console.error("poster is null in showPopup"),t(new Error("poster is null")))}))})),w=()=>{try{e.index.showLoading({title:"下载中...",mask:!0}),e.index.getImageInfo({src:h.value,success:o=>{e.index.saveImageToPhotosAlbum({filePath:o.path,success:o=>{m.value.close(),setTimeout((()=>{e.index.showToast({title:"保存成功，请到相册查看",icon:"none"})}),500)},fail:o=>{"saveImageToPhotosAlbum:fail cancel"!=o.errMsg?e.index.showModal({title:"授权提示",content:"需要授权保存相册",success:o=>{o.confirm&&e.index.openSetting({success:o=>{console.log(o),o.authSetting["scope.writePhotosAlbum"]?e.index.showToast({title:"获取授权成功",icon:"none"}):e.index.showToast({title:"获取权限失败",icon:"none"})}})}}):e.index.showToast({title:"保存失败，请重新点击下载",icon:"none"})},complete:()=>{e.index.hideLoading()}})}})}catch(o){console.log(o),e.index.hideLoading()}};return n({handleShow:async()=>{e.index.showLoading({title:"加载中",mask:!0}),r.value=await o.useUserStore().getInfo(),p.value=!0,s.value=!0,await e.nextTick$1();let t=0;const n=1e3,i=async()=>{if(g.value)try{await F(),e.index.hideLoading()}catch(o){console.error(o),e.index.hideLoading()}else console.error("poster is null"),t+=n,t<5e3?setTimeout(i,n):(console.error("最大延迟已达到，停止检查"),e.index.hideLoading())};setTimeout(i,n)}}),(o,n)=>e.e({a:e.unref(p)},e.unref(p)?e.e({b:e.p({"object-fit":"fill",css:"position: absolute;top:32rpx;left:30rpx;height: 72rpx;width: 72rpx;border-radius: 50%;",src:e.unref(r).img?"https://www.xzxskj.com"+e.unref(r).img:"https://www.xzxskj.com/Public/upload/66697e97b8c363900.png"}),c:""!==e.unref(r).nik_name},""!==e.unref(r).nik_name?{d:e.p({css:"position: absolute;top:32rpx;left:112rpx; font-family: PingFang SC, PingFang SC;font-weight: 400;font-size: 28rpx;color: #FFFFFF;text-shadow: 0px 0px 20px rgba(0,0,0,0.25);",text:e.unref(r).nik_name})}:{},{e:e.p({css:"position: absolute;top:70rpx;left:112rpx; font-family: PingFang SC, PingFang SC;font-weight: 400;font-size: 28rpx;color: #FFFFFF;text-shadow: 0px 0px 20px rgba(0,0,0,0.25);",text:t.data.phone}),f:e.p({css:"position: absolute;top:134rpx;left:20rpx;height: 764rpx;width: 650rpx;border: 2rpx solid #FFFFFF;border-radius: 20rpx 20rpx 20rpx 20rpx;background: #FFFFFF;"}),g:e.p({css:"object-fit:contain;position: absolute;top:154rpx;left:40rpx;height: 490rpx;width: 610rpx;border: 2rpx solid #FFFFFF;border-radius: 20rpx 20rpx 20rpx 20rpx;background: #FFFFFF;",src:t.infos.cover}),h:e.p({css:"font-family: PingFang SC, PingFang SC;font-weight: bold;font-size: 32rpx;color: #1F1F1F;",text:t.infos.name}),i:e.f(e.unref(u),((o,t,n)=>({a:t,b:"dc8c9faf-9-"+n+",dc8c9faf-8",c:e.p({css:"font-family: PingFang SC, PingFang SC;font-weight: 400;font-size: 28rpx;color: #8A8A8C;background: #F2F3F6;padding-left:4rpx;padding-right:4rpx;margin-right:10rpx",text:o.value})}))),j:e.p({css:"position: absolute;bottom:0;left:0;"}),k:e.p({css:"width:610rpx;position: absolute;top:674rpx;left:40rpx;height:100rpx;"}),l:e.p({css:"position: absolute;top:798rpx;left:40rpx; font-family: DIN, DIN;font-weight: bold;font-size: 48rpx;color: #EB4636;",text:`￥${t.data.price}`}),m:e.p({css:"background-image: url(https://www.xzxskj.com/Public/upload/66697cbf259ac1810.png);position: absolute;top:876rpx;left:100rpx;height: 64rpx;width: 12rpx;"}),n:e.p({css:"background-image: url(https://www.xzxskj.com/Public/upload/66697cbf259ac1810.png);position: absolute;top:876rpx;right:100rpx;height: 64rpx;width: 12rpx;"}),o:e.p({css:"position: absolute;top:918rpx;left:20rpx;width: 650rpx;height: 300rpx;background: #FFFFFF;border-radius: 20rpx 20rpx 20rpx 20rpx;border: 2rpx solid #FFFFFF;"}),p:e.p({css:"position: absolute;top:960rpx;left:45rpx; font-family: PingFang SC, PingFang SC;font-weight: 800;font-size: 48rpx;color: #1F1F1F;",text:t.infos.finenessname}),q:e.p({css:"background-image: url(https://www.xzxskj.com/Public/upload/6645a51f189276871.png);position: absolute;top:1052rpx;left:50rpx;height: 24rpx;width: 24rpx;"}),r:e.p({css:"background-image: url(https://www.xzxskj.com/Public/upload/6645a51f189276871.png);position: absolute;z-index:99;top:1106rpx;left:50rpx;height: 24rpx;width: 24rpx;"}),s:e.p({css:"background-image: url(https://www.xzxskj.com/Public/upload/6645a51f189276871.png);position: absolute;z-index:99;top:1160rpx;left:50rpx;height: 24rpx;width: 24rpx;"}),t:e.p({css:"position: absolute;top:1046rpx;left:86rpx; font-family: PingFang SC, PingFang SC;font-weight: 400;font-size: 24rpx;color: #1F1F1F;",text:e.unref(x)}),v:e.p({css:"position: absolute;top:1100rpx;left:86rpx; font-family: PingFang SC, PingFang SC;font-weight: 400;font-size: 24rpx;color: #1F1F1F;",text:e.unref(d)}),w:e.p({css:"position: absolute;top:1154rpx;left:86rpx; font-family: PingFang SC, PingFang SC;font-weight: 400;font-size: 24rpx;color: #1F1F1F;",text:e.unref(f)}),x:e.p({text:"https://www.xzxskj.com/Home/Hbindex/index?id="+t.data.id,css:"position: absolute;top:960rpx;right:50rpx;width: 176rpx; height: 176rpx"}),y:e.p({css:"opacity:0.6;position: absolute;top:1162rpx;right:50rpx; font-family: PingFang SC, PingFang SC;font-weight: 400;font-size: 22rpx;color: #1F1F1F;",text:"扫码查看商品详情"}),z:e.sr(g,"dc8c9faf-0",{k:"poster"}),A:e.p({hidden:!0,"file-type":"jpg",css:"width: 690rpx;height: 1240rpx;background-color: pink;background-image: url(https://www.xzxskj.com/Public/upload/664560d28b2697631.png);","custom-style":"position: fixed;top: 0;left: 0;"})}):{},{B:e.unref(s)},e.unref(s)?{C:e.o(l),D:e.unref(h),E:e.o(w)}:{},{F:e.sr(m,"dc8c9faf-23",{k:"popup"}),G:e.o(l),H:e.o(c),I:e.p({type:"center","background-color":"rgba(0,0,0,0)","safe-area":!1,"is-mask-click":!0})})}},n=e._export_sfc(t,[["__scopeId","data-v-dc8c9faf"]]);wx.createComponent(n);
