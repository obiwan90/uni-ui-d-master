"use strict";const e=require("../../../common/vendor.js"),o=require("../../../api/product/product.js");if(!Array){(e.resolveComponent("van-image")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list")+e.resolveComponent("uni-collapse-item")+e.resolveComponent("uni-collapse"))()}Math||((()=>"../../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../../uni_modules/uni-list/components/uni-list/uni-list.js")+(()=>"../../../uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item.js")+(()=>"../../../uni_modules/uni-collapse/components/uni-collapse/uni-collapse.js"))();const n={__name:"detailProductEditPrice",props:{selectedGood:{type:Object,default:{}},combinationname:{type:Array,default:[]}},emits:["close","reLoad"],setup(n,{emit:s}){const i=s,l=n,t=e.ref(),a=e.ref([]),c=e.ref([]),r=e.ref([]),d=(e,o,n)=>{c.value[e].fill(!1),c.value[e][o]=!c.value[e][o],r.value[e]=n};e.watch(r,(e=>{e.every((e=>null!==e))&&m()}),{deep:!0});const u=e.ref(),m=async()=>{const n=r.value.map((e=>e.id)),s={opid:e.index.getStorageSync("sessionInfo").opid,id:l.selectedGood.id,csid:n.join(",")};try{const n=await o.apiSelectedFineness(s);200===n.code?u.value=n.csinfos:(e.index.showToast({title:"未找到匹配成色，请联系客服",icon:"error",duration:2e3}),console.error("API returned an error",n))}catch(i){console.error("API call failed",i)}};function p(e){const{gjbbname:o,wlbbname:n,bxzt:s,efficiency:i,delivery:l}=e,t=[];o&&t.push(o),n&&t.push(n),s&&t.push(s),i&&t.push(`电池${i}%`),l&&t.push(`${l}发货`);return t.join("丨")}const v=async n=>{console.log("selectedText",r.value);const s={opid:e.index.getStorageSync("sessionInfo").opid,id:l.selectedGood.id,price:t.value?t.value:"",zhid:u.value?u.value.id:"",csid:n.join(",")};try{const n=await o.apiEditProductInfo(s);200===n.code?(console.log("Edit product info success",n),e.index.showToast({title:"修改成功",icon:"success",duration:500}),setTimeout((()=>{i("close"),i("reLoad")}),500)):console.error("API returned an error",n)}catch(a){console.error("API call failed",a)}},f=()=>{console.log("props.selectedGood",l.selectedGood),console.log("editePrice.value:",t.value),console.log("csinfos.value:",u.value);const o=!!t.value,n=!!u.value,s=r.value.every((e=>null!==e));if(o&&n){if(!s)return void e.index.showToast({title:"请选择完整的成色信息",icon:"none",duration:500});const o=r.value.map((e=>e.id));v(o)}else if(o){v([])}else if(n){if(!s)return void e.index.showToast({title:"请选择完整的成色信息",icon:"none",duration:500});const o=r.value.map((e=>e.id));v(o)}else e.index.showToast({title:"请输入修改金额或者选择成色信息",icon:"none",duration:500})};return e.onMounted((async()=>{await(async()=>{const n={opid:e.index.getStorageSync("sessionInfo").opid,id:l.selectedGood.id};try{const e=await o.apiFinenessList(n);if(200===e.code){const{cslists:o,yjlist:n}=e;Array.isArray(o)&&n&&Array.isArray(n.yjlists)?(a.value=[...o.map((e=>({name:e.name,items:e.er.map((e=>({name:e.name,id:e.id})))}))),{name:n.name,items:n.yjlists.map((e=>({name:e.name,id:e.id})))}],c.value=a.value.map((e=>Array(e.items.length).fill(!1))),r.value=a.value.map((()=>null))):console.error("Invalid data structure",e)}else console.error("API returned an error",e)}catch(s){console.error("API call failed",s)}})(),l.combinationname.forEach(((e,o)=>{a.value.forEach(((o,n)=>{o.items.forEach(((o,s)=>{o.name===e&&d(n,s,o)}))}))}))})),(o,n)=>{var s,i,m;return e.e({a:e.o((e=>o.$emit("close"))),b:l.selectedGood},l.selectedGood?e.e({c:e.p({lazyLoad:!0,width:"190rpx",height:"190rpx",radius:"18rpx",fit:"fill",src:l.selectedGood.cover}),d:(null==(s=u.value)?void 0:s.name)||l.selectedGood.finenessname},(null==(i=u.value)?void 0:i.name)||l.selectedGood.finenessname?{e:e.t((null==(m=u.value)?void 0:m.name)||l.selectedGood.finenessname)}:{},{f:e.t(l.selectedGood.name),g:e.t(p(l.selectedGood)),h:e.t(l.selectedGood.price)}):{},{i:t.value,j:e.o((e=>t.value=e.detail.value)),k:e.t(u.value?u.value.name:l.selectedGood.finenessname),l:e.f(a.value,((o,n,s)=>{var i;return{a:e.t(o.name),b:e.t(null==(i=r.value[n])?void 0:i.name),c:"ec664f65-4-"+s+",ec664f65-3-"+s,d:"ec664f65-3-"+s+",ec664f65-2-"+s,e:e.f(o.items,((o,s,i)=>({a:e.t(o.name),b:c.value[n][s]?1:"",c:c.value[n][s]?1:"",d:s,e:e.o((e=>d(n,s,o)),s)}))),f:n,g:"ec664f65-2-"+s+",ec664f65-1"}})),m:e.p({border:!1}),n:e.p({open:!1,titleBorder:"none",border:!1}),o:e.sr("collapseRef","ec664f65-1"),p:e.o(((...e)=>o.onCancel&&o.onCancel(...e))),q:e.o(f)})}}},s=e._export_sfc(n,[["__scopeId","data-v-ec664f65"]]);wx.createComponent(s);
