"use strict";const e=require("../../common/vendor.js");require("../../utils/system.js");const o=require("../api/api.js"),t=require("../../utils/common.js");if(!Array){(e.resolveComponent("custom-header")+e.resolveComponent("uv-tabs")+e.resolveComponent("van-image")+e.resolveComponent("uv-count-down")+e.resolveComponent("z-paging"))()}Math||((()=>"../../components/custom-header/custom-header.js")+s+(()=>"../../uni_modules/uv-tabs/components/uv-tabs/uv-tabs.js")+(()=>"../../uni_modules/uv-count-down/components/uv-count-down/uv-count-down.js")+(()=>"../../uni_modules/z-paging/components/z-paging/z-paging.js"))();const s=()=>"../../uni_modules/qiao-select/components/qiao-select/qiaoSelect.js",n={__name:"order",setup(s){const n=async()=>{i();try{const e=await t.scanCode();console.log("result",e),e&&g(e)}catch(e){console.error("扫码失败：",e)}finally{l()}},i=()=>{e.index.showLoading({title:"加载中...",mask:!0})},l=()=>{e.index.hideLoading()},a=e.ref(null),r=e.ref(""),d=e.ref([]),c=e.ref("ch"),u=e.ref("ch"),g=e=>{e.length>0&&"custom"==W.value&&p(e)},f=e=>{console.log("selectChange:",e),e&&(a&&a.value&&(a.value.clearData(),d.value=[]),r.value=e.ch,x.value.reload(!0))},p=async e=>{const t={ch:e},s=await o.apiGetOrderSearch(t);200===s.code&&(d.value=s.lists),console.log("res",s)},m=e.ref([]),x=e.ref(null),v=async(e,o)=>{console.log("pageNo:",e),console.log("pageSize:",o);const t=await G(R.value,W.value);console.log("data：",t),x.value.complete(t)},y=e.ref();e.ref();const h=e.ref(!1),z=e.ref(!1),b=e.ref([{name:"待付款",lx:"3",type:"custom"},{name:"待发货",lx:"4",type:"custom"},{name:"待收货",lx:"5",type:"custom"},{name:"已收货",lx:"6",type:"custom"},{name:"交易成功",lx:"7",type:"custom"},{name:"议价中",lx:"2",type:"yj"},{name:"议价成功",lx:"3",type:"yj"},{name:"议价失败",lx:"4",type:"yj"},{name:"售后中",lx:"2",zt:"1",type:"sh"},{name:"售后成功",lx:"3",zt:"2",type:"sh"},{name:"售后失败",lx:"4",zt:"3",type:"sh"}]),w=e.ref(),j=e.computed((()=>b.value.map((e=>({name:e.name,type:e.type,lx:e.lx}))))),S=e=>{w.value=e.index,console.log("tabsData:",j.value),W.value=j.value[e.index].type,R.value=j.value[e.index].lx,x.value.reload(!0)},T=(e,o)=>{const t=C.value.find((t=>t.zt.includes(e)&&t.lx===o));return console.log(),t?t.btns:[]},I=e=>{"1"===e.payment&&k(e.id)},k=async t=>{const s={lx:"1",id:t,opid:e.index.getStorageSync("sessionInfo").opid},n=await o.apiGetWxPay(s);console.log("wx支付参数:",n);const i={nonceStr:n.nonceStr,package:n.package,paySign:n.paySign,timeStamp:n.timeStamp,signType:n.signType};D(i)},D=o=>{e.index.requestPayment({provider:"wxpay",...o,success(o){console.log("success:"+JSON.stringify(o)),console.log("支付成功"),e.index.showToast({title:"支付成功",icon:"success",duration:1e3}),setTimeout((()=>{x.value.reload(!0)}),1e3)},fail(o){console.log("pay fail:",JSON.stringify(o)),console.log("支付失败"),e.index.showToast({title:"支付失败",icon:"none",duration:1e3})}})},O=o=>{const t=o.kddh;e.index.navigateTo({url:`plugin://kdzs-plugin/logistics-list?num=${t}&appName=数码购机&title=物流信息`})},_=e=>"确认收货"===e||"催发货"===e||"立即支付"===e?"special-btn":"normal-btn",C=e.ref([{type:"议价中",zt:["1"],lx:"1",btns:[]},{type:"待付款",zt:["1"],lx:"2",btns:["取消订单","立即支付"]},{type:"待发货",zt:["2","3"],lx:"2",btns:["催发货"]},{type:"待收货",zt:["4"],lx:"2",btns:["查看物流","确认收货"]},{type:"已收货",zt:["5"],lx:"2",btns:[]},{type:"售后中",zt:["6"],lx:"2",btns:[]},{type:"交易成功",zt:["7"],lx:"2",btns:[]}]),q=e.ref([{zt:["1"],lx:["1"],text:"等待确认议价"},{zt:["1"],lx:["2"],text:"他人付款后将无法购买请尽快支付!"},{zt:["2","3"],lx:["2"],text:"等待发货"},{zt:["2"],lx:["1"],text:"等待确认议价"},{zt:["3"],lx:["1"],text:"议价成功等待发货"},{zt:["5"],lx:["1","2"],text:"已收货"},{zt:["6"],lx:["1","2"],text:"售后中"},{zt:["7"],lx:["1","2"],text:"交易成功"}]),B=e.ref([{zt:"1",text:"售后中"},{zt:"2",text:"售后成功"},{zt:"3",text:"售后失败"}]),N=(e,o)=>{if(console.log("zt:",e),console.log("lx:",o),"sh"===W.value)return B.value.find((o=>o.zt===e)).text;const t=q.value.find((t=>t.zt.includes(e)&&t.lx.includes(o)));return console.log("titleItem:",t),t?t.text:""},A=(e,o)=>{console.log("addTime:",e),console.log("bargainingTimeName:",o);const t=(new Date).getTime();return new Date(1e3*parseInt(e)+3600*parseInt(o)*1e3).getTime()-t},E=(o,t)=>{const s=JSON.stringify(o);e.index.setStorageSync("orderDetailItem",s),"custom"===t&&e.index.navigateTo({url:"/pagesOrderDetail/orderDetail/orderDetail?orderId="+o.orderid}),"yj"===t&&e.index.navigateTo({url:"/pagesYjOrderDetail/yjOrderDetail/yjOrderDetail"}),"sh"===t&&e.index.navigateTo({url:"/pagesShOrderDetail/shOrderDetail/shOrderDetail"})};e.ref([]);const G=async(t,s)=>{let n;switch(s){case"custom":n=await o.apiGetOrderlist({opid:e.index.getStorageSync("sessionInfo").opid,lx:r.value?"":t,ch:r.value});break;case"yj":n=await o.apiGetYjIndex({opid:e.index.getStorageSync("sessionInfo").opid,lx:t});break;case"sh":n=await o.apiGetShIndex({opid:e.index.getStorageSync("sessionInfo").opid,lx:t});break;default:n={code:200,lists:[]}}if(200===n.code){if("custom"===s)return console.log("custom.lists:",n.lists),r.value&&(w.value=parseInt(n.lists[0].zt)-1,r.value=""),n.lists.filter((e=>e.goodsinfos.length>0));if("yj"===s)return h.value=!0,console.log("yj.lists:",n.lists),Array.isArray(n.lists)&&n.lists.length>0?n.lists:[];if("sh"===s)return z.value=!0,console.log("sh.lists:",n.lists),n.lists.length>0?(n.lists.forEach((e=>{if(!Array.isArray(e.goodsinfos)){const o=e.goodsinfos;e.goodsinfos=[],o&&e.goodsinfos.push(o)}})),n.lists=n.lists.filter((e=>e.goodsinfos.length>0)),n.lists):[]}console.log(n)},P=e=>{console.log(e),console.log("进来了吗");let o=[];return"1"===e.zt&&(e.goodsinfos.gjbbname&&o.push(e.goodsinfos.gjbbname),e.goodsinfos.wlbbname&&o.push(e.goodsinfos.wlbbname),e.goodsinfos.bxzt&&o.push(e.goodsinfos.bxzt),e.goodsinfos.efficiency&&o.push(`电池${e.goodsinfos.efficiency}%`),e.goodsinfos.delivery&&o.push(`${e.goodsinfos.delivery}发货`)),o.join("丨")},$=e=>{console.log(e),console.log("进来了吗");let o=[];return"2"===e.zt&&(e.goodsinfos.gjbbname&&o.push(e.goodsinfos.gjbbname),e.goodsinfos.wlbbname&&o.push(e.goodsinfos.wlbbname),e.goodsinfos.bxzt&&o.push(e.goodsinfos.bxzt),e.goodsinfos.efficiency&&o.push(`电池${e.goodsinfos.efficiency}%`),e.goodsinfos.delivery&&o.push(`${e.goodsinfos.delivery}发货`)),o.join("丨")},F=async t=>{const s={id:t,opid:e.index.getStorageSync("sessionInfo").opid};"200"===(await o.apiCancelOrder(s)).code&&(e.index.showToast({title:"操作成功",icon:"none",duration:1e3}),setTimeout((()=>{x.value.reload(!0)}),500))},L=t=>{const s={id:t};200===o.apiUrgeShipment(s).code&&(e.index.showToast({title:"操作成功",icon:"none",duration:1e3}),setTimeout((()=>{x.value.reload(!0)}),500))},H=async t=>{const s={opid:e.index.getStorageSync("sessionInfo").opid,id:t};"200"===(await o.apiConfirmReceived(s)).code&&(e.index.showToast({title:"操作成功",icon:"success",duration:1e3}),setTimeout((()=>{x.value.reload(!0)}),500))},J=async t=>{const s={id:t},n=await o.apiCheckPay(s);return"200"!==n.code&&("201"===n.code?(e.index.showToast({title:"订单已售",icon:"success",duration:1e3}),!0):void 0)},R=e.ref(),W=e.ref();return e.onLoad((e=>{const o=e.order,t=e.yj,s=e.sh;o?(R.value=o,b.value=b.value.filter((e=>"custom"===e.type||"all"===e.type)),w.value=b.value.findIndex((e=>e.lx===o)),y.value="采购订单",console.log("采购订单"),W.value="custom"):t?(R.value=t,b.value=b.value.filter((e=>"yj"===e.type||"all"===e.type)),w.value=b.value.findIndex((e=>e.lx===t)),y.value="议价订单",console.log("议价订单"),W.value="yj"):s?(R.value=s,b.value=b.value.filter((e=>"sh"===e.type||"all"===e.type)),w.value=b.value.findIndex((e=>e.lx===s)),y.value="售后订单",console.log("售后订单"),W.value="sh"):(w.value=0,b.value=b.value)})),e.onShow((()=>{x&&x.value&&x.value.reload(!0)})),(o,t)=>e.e({a:e.t(e.unref(y)),b:e.sr(a,"5ec7d90c-1",{k:"searchRef"}),c:e.o(g),d:e.o(f),e:e.p({keyId:22,phText:"请输入串号",dataList:e.unref(d),searchKey:e.unref(c),showBorder:!1,disabled:!1,showField:e.unref(u)}),f:e.o(n),g:e.o(S),h:e.p({list:e.unref(j),lineWidth:"30",lineColor:"linear-gradient( 86deg, #ED784B 0%, #EB4636 100%)",lineHeight:"3",fontSize:28,inactiveStyle:{color:"#1F1F1F"},activeStyle:{color:"#E6432E",fontWeight:"bold",fontSize:32},current:e.unref(w)}),i:!e.unref(h)&&!e.unref(z)},e.unref(h)||e.unref(z)?{}:{j:e.f(e.unref(m),((o,t,s)=>e.e({a:e.t(o.ordernumber),b:e.t(N(o.zt,o.lx)),c:e.f(o.goodsinfos,((t,n,i)=>e.e({a:"5ec7d90c-4-"+s+"-"+i+",5ec7d90c-3",b:e.p({width:"190rpx",height:"190rpx",radius:"18rpx",fit:"fill",src:t.goodsinfos.cover}),c:t.goodsinfos.finenessname},t.goodsinfos.finenessname?{d:e.t(t.goodsinfos.finenessname)}:{},{e:e.t(t.goodsinfos.name),f:"1"===t.goodsinfos.zt},"1"===t.goodsinfos.zt?{g:e.t(P(t))}:{h:e.t(t.goodsinfos.ch)},{i:e.t(t.price)},(o.isBargaining,{}),o.isBargaining?{j:e.t(t.originalPrice)}:{},{k:n,l:e.o((e=>E(o,"custom")),n)}))),d:!o.isBargaining,e:o.isBargaining,f:e.t(o.goodsinfos.length),g:e.t(o.price),h:"1"===o.zt||"2"===o.zt||"3"===o.zt||"4"===o.zt},"1"===o.zt||"2"===o.zt||"3"===o.zt||"4"===o.zt?{i:e.f(T(o.zt,o.lx),((t,s,n)=>({a:e.t(t),b:s,c:e.o((e=>((e,o)=>{console.log("Button clicked:",e),"查看物流"===e&&O(o),"立即支付"===e&&(J(o.id)||I(o)),"取消订单"===e&&F(o.id),"催发货"===e&&L(o.id),"确认收货"===e&&H(o.id)})(t,o)),s),d:e.n(_(t))})))}:{},{j:t})))},{k:e.unref(h)},e.unref(h)?{l:e.f(e.unref(m),((o,t,s)=>e.e({a:e.t(o.ordernumber),b:e.t(N(o.zt,o.lx)),c:"等待确认议价"===N(o.zt,o.lx)&&"已结束"===A(o.pay_time,o.bargainingtimename)},"等待确认议价"===N(o.zt,o.lx)&&"已结束"===A(o.pay_time,o.bargainingtimename)?{}:"等待确认议价"===N(o.zt,o.lx)&&"1"===o.lx?{e:"5ec7d90c-5-"+s+",5ec7d90c-3",f:e.p({time:A(o.pay_time,o.bargainingtimename),format:"HH:mm:ss"})}:{},{d:"等待确认议价"===N(o.zt,o.lx)&&"1"===o.lx,g:"5ec7d90c-6-"+s+",5ec7d90c-3",h:e.p({width:"190rpx",height:"190rpx",radius:"18rpx",fit:"fill",src:o.goodsinfos.cover}),i:o.goodsinfos.finenessname},o.goodsinfos.finenessname?{j:e.t(o.goodsinfos.finenessname)}:{},{k:e.t(o.goodsinfos.name),l:"1"===o.goodsinfos.zt},"1"===o.goodsinfos.zt?{m:e.t($(o))}:{n:e.t(o.goodsinfos.ch)},{o:e.t(o.price),p:e.t(o.goodsinfos.price),q:t,r:e.o((e=>E(o,"yj")),t)})))}:{},{m:e.unref(z)},e.unref(z)?{n:e.f(e.unref(m),((o,t,s)=>({a:e.t(o.ordernumber),b:e.t(N(o.zt,o.lx)),c:e.f(o.goodsinfos,((o,t,n)=>e.e({a:"5ec7d90c-7-"+s+"-"+n+",5ec7d90c-3",b:e.p({width:"190rpx",height:"190rpx",radius:"18rpx",fit:"fill",src:o.cover}),c:o.finenessname},o.finenessname?{d:e.t(o.finenessname)}:{},{e:e.t(o.name),f:e.t(o.ch),g:e.t(o.price),h:t}))),d:e.t(o.price),e:t,f:e.o((e=>E(o,"sh")),t)})))}:{},{o:e.sr(x,"5ec7d90c-3",{k:"paging"}),p:e.o(v),q:e.o((o=>e.isRef(m)?m.value=o:null)),r:e.p({"show-refresher-update-time":!0,fixed:!1,modelValue:e.unref(m)})})}},i=e._export_sfc(n,[["__scopeId","data-v-5ec7d90c"]]);wx.createPage(i);
