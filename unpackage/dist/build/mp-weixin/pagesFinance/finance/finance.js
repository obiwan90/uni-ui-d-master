"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/debounce.js"),n=require("../api/api.js"),o=require("../../utils/system.js");if(!Array){(e.resolveComponent("z-paging")+e.resolveComponent("uni-popup"))()}const t=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||(s+(()=>"../../uni_modules/z-paging/components/z-paging/z-paging.js")+e.unref(l)+t)();const s=()=>"../../uni_modules/qiao-select/components/qiao-select/qiaoSelect.js",l=()=>"./components/saixuan-pannel.js",r={__name:"finance",setup(t){const s=e.ref("ch"),l=e.ref("ch"),r=e.ref(null),u=e.ref(!1),i=()=>{console.log("Popup is closed"),r.value.close()},c=e=>{e.show||(u.value=e.show)},f=()=>{u.value=!0,r.value.open()},d=e.ref(null),p=e.ref([]),g=e.ref(!1),v=async(e,a)=>{console.log("pageNo:",e),console.log("pageSize:",a);const n=await D(e-1);d.value.complete(n),p.value=p.value.map((e=>({...e,selected:g.value})))},h=e.ref(0),m=e.ref(["未对账","已对账"]);e.ref(0),e.ref([{value:0,text:"串号搜索"},{value:1,text:"串号搜索"},{value:2,text:"串号搜索"}]);const x=e.ref([]),k=e=>{console.log(e),R(e.id)},y=()=>{g.value=!g.value,p.value.forEach((e=>{e.selected=g.value}))};e.watch(p,(e=>{g.value=e.every((e=>e.selected))}),{deep:!0});const j=()=>{e.index.navigateBack()},w=e.computed((()=>{let e=0;return p.value.forEach((a=>{a.selected&&(e+=1)})),e})),b=e.computed((()=>{let e=0;return p.value.forEach((a=>{a.selected&&(e+=parseFloat(a.price))})),e.toFixed(2)})),S=e.ref([]),_=e.ref([]),q=e.ref([]),z=e.ref(""),B=e.ref(""),F=e.ref(""),E=e.ref(""),T=e.ref(""),C=e.ref(""),D=async e=>{const a={lx:h.value+1,start:e.toString(),skkssj:z.value,skjssj:B.value,ckid:F.value,ygid:E.value,cgid:T.value,zffs:C.value},o=await n.apiFinanceList(a);return console.log("res:",o),"200"===o.code?(S.value=o.cgyglist,_.value=o.cklist,q.value=o.xsyglist,o.lists):[]},H=async a=>{const o={opid:e.index.getStorageSync("sessionInfo").opid,orderid:a},t=await n.apiFinanceCheck(o);console.log("res:",t),"200"===t.code&&(e.index.showToast({title:"对账成功",icon:"success",duration:500}),setTimeout((()=>{d.value.refresh(!0)}),500))},I=a.debounce((e=>{L(e)}),300,!0),L=e=>{H(e)},P=e=>{console.log("selectedConfirm",e),z.value=e["开始时间戳"],B.value=e["结束时间戳"],F.value=e["仓库"].join(","),E.value=e["销售员工"].join(","),T.value=e["采购员工"].join(","),C.value=e["收款方式"].join(","),d.value.reload(!0)},R=async e=>{const a={id:e,lx:h.value+1},o=await n.financeReconciliationSelect(a);console.log("select res:",o),"200"===o.code&&(p.value=o.lists)},A=e=>{console.log("输入框内容:",e),e.length>0&&(async e=>{const a={lx:h.value+1,start:"0",search:e},o=await n.financeReconciliationSearch(a),t=[];"200"===o.code&&o.lists.forEach((e=>{e.ch.split(",").forEach((a=>{t.push({ch:a,id:e.id})}))})),x.value=t})(e)},G=()=>{const e=p.value.filter((e=>e.selected)).map((e=>e.id)).join(", ");H(e)};return e.onShow((()=>{d.value.refresh(!1)})),(a,n)=>e.e({a:e.unref(o.getStatusBarHeight)()+"px",b:e.o(j),c:e.f(e.unref(m),((a,n,o)=>({a:e.t(a),b:e.o((e=>(e=>{h.value=e,d.value.reload(!0)})(n)),n),c:e.unref(h)===n?1:"",d:n}))),d:e.unref(o.getTitleBarHeight)()+"px",e:e.unref(o.getLeftIconLeft)()+"px",f:e.unref(o.getStatusBarHeight)()+e.unref(o.getTitleBarHeight)()+"px",g:e.o(A),h:e.o(k),i:e.p({keyId:1,dataList:e.unref(x),phText:"请输入串号搜索",searchKey:e.unref(s),showField:e.unref(l),showBorder:!1,disabled:!1}),j:e.o(f),k:e.f(e.unref(p),((a,n,o)=>e.e({a:e.t(a.khname),b:e.t(a.khphone)},"未对账"===e.unref(m)[e.unref(h)]?e.e({c:a.selected},(a.selected,{}),{d:e.o((e=>a.selected=!a.selected),n)}):{},{e:e.f(a.goodslist,((n,o,t)=>e.e({a:n.finenessname},n.finenessname?{b:e.t(n.finenessname)}:{},{c:e.t(n.name),d:e.t(n.ch),e:e.t(n.cgyname),f:n.ckame},n.ckame?{g:e.t(n.ckame)}:{},{h:e.t(n.price),i:o,j:e.o((n=>{return o="/pagesFinanceDetail/financeDetail/financeDetail?data="+a.id,void e.index.navigateTo({url:o});var o}),o)}))),f:e.t(a.ygname?a.ygname:"线下支付 "),g:e.t(a.remark),h:e.t(a.num),i:e.t(a.price)},"未对账"===e.unref(m)[e.unref(h)]?{j:e.o((n=>e.unref(I)(a.id)),n)}:{},{k:n}))),l:e.t(e.unref(m)[e.unref(h)]),m:"未对账"===e.unref(m)[e.unref(h)],n:"未对账"===e.unref(m)[e.unref(h)],o:e.sr(d,"3a74fda2-1",{k:"paging"}),p:e.o(v),q:e.o((a=>e.isRef(p)?p.value=a:null)),r:e.p({"default-page-size":20,"show-refresher-update-time":!0,fixed:!1,modelValue:e.unref(p)}),s:e.t(e.unref(w)),t:e.t(e.unref(b)),v:e.unref(g)},(e.unref(g),{}),{w:e.o(y),x:"未对账"===e.unref(m)[e.unref(h)]},"未对账"===e.unref(m)[e.unref(h)]?{y:e.o(G)}:{},{z:e.unref(u)},e.unref(u)?{A:e.o(P),B:e.o(i),C:e.p({cgyglist:e.unref(S),cklist:e.unref(_),xsyglist:e.unref(q)})}:{},{D:e.sr(r,"3a74fda2-2",{k:"saixuanPannelPopup"}),E:e.o(i),F:e.o(c),G:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"})})}},u=e._export_sfc(r,[["__scopeId","data-v-3a74fda2"]]);wx.createPage(u);
