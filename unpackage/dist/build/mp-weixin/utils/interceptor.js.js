"use strict";const e=require("../common/vendor.js"),o=require("../stores/userInfoStore.js");let t="https://www.xzxskj.com",n={whitePathList:["/pagesLogin/login/login","/pages/home/home"],whiteApiList:["/Home/Goods/shoppingcart","/Home/index/index","/Home/Homes/index","/Home/Users/get_session_keys","/Home/Users/infos","/Home/Gly/qxlist","/Home/Users/add","/Home/Upload/add"]};const i=(o,n,i)=>(o.startsWith(t)&&(o=o.replace(t,"")),!(n&&i&&n.route.includes(o)&&!i.route.includes(o))||(e.index.showToast({title:"您没有权限!",icon:"none"}),!1)),s=(e,o,i)=>(e.startsWith(t)&&(e=e.replace(t,"")),!!n.whiteApiList.includes(e)||(console.log("api:",e),!(o&&i&&o.api.includes(e)&&!i.api.includes(e)))),r=(o,t)=>{if(n.whitePathList.includes(o))return!0;return!!e.index.getStorageSync("userInfo")||(e.index.navigateTo({url:"/pagesLogin/login/login"}),!1)};exports.routingIntercept=function(){o.useUserStore(),["navigateTo","redirectTo","reLaunch","switchTab"].forEach((t=>{e.index.addInterceptor(t,{invoke(t){const n=t.url.split("?")[0];if(!r(n))return!1;const s=o.useUserStore().getInfo(),a=e.index.getStorageSync("authorityList")||{route:[],menu:[],api:[]},u=e.index.getStorageSync("userAuthorityUrls")||{route:[],menu:[],api:[]};return console.log("path拦截 path:",n),console.log("path拦截 info:",s),!!i(n,a,u)&&void 0},fail(e){console.log("拦截失败:",e)}})})),e.index.addInterceptor("request",{invoke(o){const t=e.index.getStorageSync("authorityList")||{route:[],menu:[],api:[]},n=e.index.getStorageSync("userAuthorityUrls")||{route:[],menu:[],api:[]},i=o.url;return console.log("拦截器API检查:",i),console.log("请求参数:",o.data),s(i,t,n)?o:(e.index.showToast({title:"您没有操作权限!",icon:"none"}),!1)},fail(e){console.log("API拦截失败:",e)}})};
