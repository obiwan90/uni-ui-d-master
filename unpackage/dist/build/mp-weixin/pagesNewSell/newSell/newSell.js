"use strict";const e=require("../../common/vendor.js"),a=require("../../api/qualityCheck/qualityCheck.js"),o=require("../../api/search/search.js"),l=require("../api/api.js"),n=require("../../stores/userInfoStore.js"),u=require("../../utils/common.js");if(!Array){(e.resolveComponent("custom-header")+e.resolveComponent("uv-checkbox")+e.resolveComponent("uv-checkbox-group")+e.resolveComponent("uv-radio")+e.resolveComponent("uv-radio-group")+e.resolveComponent("uv-upload")+e.resolveComponent("uv-calendars")+e.resolveComponent("uni-popup"))()}const r=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||((()=>"../../components/custom-header/custom-header.js")+t+(()=>"../../uni_modules/uv-checkbox/components/uv-checkbox/uv-checkbox.js")+(()=>"../../uni_modules/uv-checkbox/components/uv-checkbox-group/uv-checkbox-group.js")+(()=>"../../uni_modules/uv-radio/components/uv-radio/uv-radio.js")+(()=>"../../uni_modules/uv-radio/components/uv-radio-group/uv-radio-group.js")+(()=>"../../uni_modules/uv-upload/components/uv-upload/uv-upload.js")+(()=>"../../uni_modules/uv-calendars/components/uv-calendars/uv-calendars.js")+e.unref(i)+r)();const t=()=>"../../uni_modules/qiao-select/components/qiao-select/qiaoSelect.js",i=()=>"./components/jixingPannel.js",s={__name:"newSell",setup(r){const t=e.ref(null),i=e.ref([]),s=e.ref([]),c=e.ref(!1),d=e.ref(null),v=e.ref(null),p=()=>{console.log("Popup is closed"),v.value.close()},f=e=>{e||(c.value=e.show)},m=async(e,a)=>{console.log("select data:",e),console.log("selectedTabs:",a),e.length>0&&(t.value.clearData(),y.value=[],$.value.xhid=e[0].xhid,$.value.ppid=e[0].ppid,S.value[0].value=e[0].qcname,g.value="",await H())},h=e.ref(""),g=e.ref(),y=e.ref([]),k=e.ref("spname"),x=e.ref("spname"),w=e.ref(["1"]),b=e.ref(["1"]),j=e.ref("72h"),T=e.ref([{name:"12h",checked:!1},{name:"24h",checked:!1},{name:"48h",checked:!1},{name:"72h",checked:!0}]),S=e.ref([{key:"型号",placeholder:"请搜索相关型号",value:""},{key:"内存",placeholder:"请搜索相关型号",value:"",id:""},{key:"颜色",placeholder:"请搜索相关型号",value:"",id:""},{key:"型号全称",placeholder:"",value:""}]),C=a=>{a.length>0&&(e.index.showLoading({title:"加载中....",mask:!0}),console.log("inputText",a),q(a),e.index.hideLoading())},q=async e=>{const a={word:e},l=await o.apiSearchGoods(a);console.log("search res:",l),"200"===l.code&&(y.value=l.lists?l.lists:[])},I=async e=>{if(e){console.log("selectSearchChange e:",e);const{id:a,xhname:o,ncname:l,ysname:n,spname:u}=e;i.value=[],s.value=[],t.value.clearData(),y.value=[],g.value=a,await _(a)}},_=async o=>{const l={opid:e.index.getStorageSync("sessionInfo").opid,id:o},n=await a.apiQualityCheckItem(l);200===n.code&&(S.value[0].value=n.infos.xhname,S.value[1].value=n.infos.ncname,S.value[2].value=n.infos.ysname,S.value[3].value=n.infos.spname,n.infos.ysname||(s.value=null),n.infos.ncname||(i.value=null))},R=e.ref("自由发布"),F=e.ref(),L=e.ref(),M=e.ref(null),P=e.ref([{key:"外观成色",placeholder:"请选择",value:""},{key:"功能检测",placeholder:"请输入",value:"全好"},{key:"维修检测",placeholder:"请输入",value:"全原"},{key:"同行价格",placeholder:"请输入",value:""},{key:"销售数量",placeholder:"请输入",value:"1"},{key:"销售时长",placeholder:"请选择",value:""}]),z=e=>{console.log("日历回调：",e),P.value[5].placeholder=e.range.before+"~"+e.range.after},B=e=>{"外观成色"===e&&console.log("选择成色"),"销售时长"===e&&(console.log("打开日历"),M.value.open())},D=()=>{const e=new Date,a=e.getFullYear(),o=e.getMonth()+1,l=e.getDate();return`${a}-${o<10?"0"+o:o}-${l<10?"0"+l:l}`},E=e.ref([]),G=e=>{E.value.splice(e.index,1)},N=a=>{console.log(a),e.index.showToast({title:"超出上传限制",icon:"error",duration:2e3})},V=async a=>{let o=[].concat(a.file);E.value.length;for(const n of o)try{const a=await u.compressImage(n);if(!a)continue;console.log("compressedResult",a);const o=await e.index.uploadFile({url:"https://www.xzxskj.com/Home/Upload/add",filePath:a.tempFilePath,name:"imgs",header:{"Content-Type":"multipart/form-data"}}),l=JSON.parse(o.data);if(200!==l.code)return console.error("上传失败:",l),void e.index.showToast({title:"上传失败,稍后再试",icon:"error",duration:2e3});console.log("上传成功:",l.urls);l.urls.split(",").forEach((e=>{e.trim()&&(E.value.push({url:"https://www.xzxskj.com"+e.trim(),status:"success",message:""}))}))}catch(l){console.error("上传失败:",l),e.index.showToast({title:"上传失败",icon:"error",duration:2e3})}},A=e.computed((()=>S.value.filter(((e,a)=>"型号全称"!==e.key&&((1!==a||null!==i.value)&&(2!==a||null!==s.value)))))),J=e=>{console.log(e),e.length>0&&"1"===e[0]?P.value[1].value="全好":P.value[1].value=""},U=e=>{console.log(e),e.length>0&&"1"===e[0]?P.value[2].value="全原":P.value[2].value=""},$=e.ref({xhid:"",ppid:"",nc:"",bb:"",wl:"",ys:"",bx:"",start:"",delivery:e.index.getStorageSync("locationForm").fullLocation.split(" ").join(",")}),H=async()=>{i.value=[],s.value=[],S.value[1].value="",S.value[2].value="";const e=await l.apiRecoveryList($.value);200===e.code&&(i.value=e.nclist?e.nclist.filter((e=>e.name)):[],s.value=e.yslist?e.yslist.filter((e=>e.name)):[],0===i.value.length&&(i.value=null),0===s.value.length&&(s.value=null),K()),console.log("Recovery list:",e)},K=async()=>{const e={xhid:$.value.xhid,ncid:S.value.find((e=>"内存"===e.key)).id,ysid:S.value.find((e=>"颜色"===e.key)).id},a=await l.apiGetProductId(e);"200"===a.code&&a.infos?g.value=a.infos.id:g.value="",console.log(" 请求  productId.value:",g.value)},O=async()=>{console.log("  提交  comfirm productId.value",g.value);const a=S.value.find((e=>"内存"===e.key)),o=S.value.find((e=>"颜色"===e.key));null===i.value||a.value?null===s.value||o.value?g.value?L.value?E.value.length?P.value[0].value?P.value[3].value?P.value[4].value?j.value?await(async()=>{try{const a={id:h.value,opid:e.index.getStorageSync("sessionInfo").opid,type:"1",describes:L.value,img:E.value.map((e=>e.url)).join(","),fullnameid:g.value,fineness:P.value[0].value,price:P.value[3].value,num:P.value[4].value,duration:j.value.replace("h",""),functions:P.value[1].value,service:P.value[2].value,fbd:e.index.getStorageSync("locationForm").city},o=await l.apiAddMarket(a);"200"===o.code?(e.index.showToast({title:"添加成功",icon:"success",duration:500}),setTimeout((()=>{""!==h.value?e.index.navigateBack():e.index.navigateTo({url:"/pagesMarketCount/marketCount/marketCount?from=newSell"})}),500)):e.index.showToast({title:o.msg?o.msg:"请重试",icon:"error",duration:3e3}),console.log("addmarket res",o)}catch(a){console.error("Error adding market:",a),e.index.showToast({title:"发生错误，请重试",icon:"error",duration:2e3})}})():e.index.showToast({title:"请选择销售时长",icon:"error",duration:2e3}):e.index.showToast({title:"请填写销售数量",icon:"error",duration:2e3}):e.index.showToast({title:"请填写同行价格",icon:"error",duration:2e3}):e.index.showToast({title:"请选择外观成色",icon:"error",duration:2e3}):e.index.showToast({title:"请上传至少一张图片",icon:"error",duration:2e3}):e.index.showToast({title:"请填写描述信息",icon:"error",duration:2e3}):e.index.showToast({title:"当前型号暂不支持上传",icon:"error",duration:2e3}):e.index.showToast({title:"请选择颜色",icon:"error",duration:2e3}):e.index.showToast({title:"请选择内存",icon:"error",duration:2e3})},Q=e.ref([]);return e.onLoad((async a=>{let o=e.index.getStorageSync("infos");if(o&&""!==o.info.shopname||e.index.showModal({title:"提示",content:"您还未注册商家",confirmText:"去注册",success(a){a.confirm?e.index.navigateTo({url:"/pagesMenber/menber/menber"}):e.index.navigateBack()}}),console.log("传递过来的参数:",a.data),a.data){const e=JSON.parse(decodeURIComponent(a.data));R.value="卖货修改",F.value=e.id,h.value=e.id,console.log("data",e),await _(e.fullnameid),P.value=[{key:"外观成色",placeholder:"请选择",value:e.fineness},{key:"功能检测",placeholder:"请输入",value:e.functions},{key:"维修检测",placeholder:"请输入",value:e.service},{key:"同行价格",placeholder:"请输入",value:e.price},{key:"销售数量",placeholder:"请输入",value:e.num},{key:"销售时长",placeholder:"请选择",value:e.duration+"h"}],g.value=e.fullnameid,j.value=e.duration+"h",L.value=e.describes,e.img.split(",").forEach((e=>{E.value.push({url:e})}))}(async()=>{const e=await l.apiGetQuality();"200"===e.code&&(Q.value=e.lists)})()})),e.onShow((async()=>{await n.useUserStore().getInfo();let a=e.index.getStorageSync("infos");a&&""!==a.info.shopname||e.index.showModal({title:"提示",content:"您还未注册商家",confirmText:"去注册",success(a){a.confirm?e.index.navigateTo({url:"/pagesMenber/menber/menber"}):e.index.navigateBack()}})})),(a,o)=>e.e({a:e.t(e.unref(R)),b:e.sr(t,"ae9065f4-1",{k:"qselect"}),c:e.o(C),d:e.o(I),e:e.p({keyId:22,dataList:e.unref(y),phText:"请搜索并确认型号全称",searchKey:e.unref(k),showBorder:!1,disabled:!1,showField:e.unref(x)}),f:e.f(e.unref(A).slice(0,3),((a,o,l)=>e.e({a:e.t(a.key),b:a.placeholder,c:a.value,d:e.o((e=>a.value=e.detail.value),o),e:0===o},0===o?{f:e.o((e=>(c.value=!0,void v.value.open())),o)}:{},{g:1===o&&null!==e.unref(i)&&e.unref(i).length>0},1===o&&null!==e.unref(i)&&e.unref(i).length>0?{h:e.unref(i),i:e.o((e=>(async e=>{console.log("选择 e:",e);const a=S.value.find((e=>"内存"===e.key));if(a){console.log("memoryItem",a),console.log("nclist.value",i.value);const o=Number(e.detail.value);o>=0&&o<i.value.length?(a.id=i.value[o].id,a.value=i.value[o].name,await K()):console.error("无效的索引:",o)}else console.error("未找到内存项")})(e)),o),j:e.unref(S)[1].value}:{},{k:2===o&&null!==e.unref(s)&&e.unref(s).length>0},2===o&&null!==e.unref(s)&&e.unref(s).length>0?{l:e.unref(s),m:e.o((e=>(async e=>{console.log("选择 e:",e);const a=S.value.find((e=>"颜色"===e.key));if(a){const o=Number(e.detail.value);o>=0&&o<s.value.length?(a.id=s.value[o].id,a.value=s.value[o].name,await K()):console.error("无效的索引:",o)}else console.error("未找到颜色项")})(e)),o),n:e.unref(S)[2].value}:{},{o:o}))),g:e.f(e.unref(P),((a,o,l)=>e.e({a:e.t(a.key),b:"销售时长"!==a.key},"销售时长"!==a.key?e.e({c:"销售时长"===a.key},"销售时长"===a.key?{d:e.t(a.placeholder),e:e.o((e=>B(a.key)),o)}:{},{f:"外观成色"===a.key},"外观成色"===a.key?{g:e.t(""!==a.value?a.value:a.placeholder),h:""!==a.value?"black":"#808080",i:e.unref(Q),j:e.o((e=>((e,a)=>{console.log("选择 e:",e),a.value=Q.value[e.detail.value].name})(e,a)),o),k:a.value}:{l:"同行价格"===a.key||"销售数量"===a.key?"number":"text",m:a.placeholder,n:e.o((e=>B(a.key)),o),o:"维修检测"===a.key&&e.unref(w).length>0||"功能检测"===a.key&&e.unref(b).length>0,p:a.value,q:e.o((e=>a.value=e.detail.value),o)},{r:"维修检测"===a.key||"功能检测"===a.key},"维修检测"===a.key||"功能检测"===a.key?e.e({s:"维修检测"===a.key},"维修检测"===a.key?{t:"ae9065f4-3-"+l+",ae9065f4-2-"+l,v:e.p({activeColor:"red",name:"1",label:"维修检测"===a.key?"全原":"全好",labelColor:"grey"}),w:e.o(U,o),x:"ae9065f4-2-"+l,y:e.o((a=>e.isRef(w)?w.value=a:null),o),z:e.p({shape:"circle",modelValue:e.unref(w)})}:{},{A:"功能检测"===a.key},"功能检测"===a.key?{B:"ae9065f4-5-"+l+",ae9065f4-4-"+l,C:e.p({activeColor:"red",name:"1",label:"维修检测"===a.key?"全原":"全好",labelColor:"grey"}),D:e.o(J,o),E:"ae9065f4-4-"+l,F:e.o((a=>e.isRef(b)?b.value=a:null),o),G:e.p({shape:"circle",modelValue:e.unref(b)})}:{}):{}):{H:e.f(e.unref(T),((a,o,n)=>({a:o,b:"ae9065f4-7-"+l+"-"+n+",ae9065f4-6-"+l,c:e.p({customStyle:{margin:"8px"},label:a.name,name:a.name})}))),I:"ae9065f4-6-"+l,J:e.o((a=>e.isRef(j)?j.value=a:null),o),K:e.p({modelValue:e.unref(j)})},{L:o}))),h:e.unref(L),i:e.o((a=>e.isRef(L)?L.value=a.detail.value:null)),j:e.o(V),k:e.o(G),l:e.o(N),m:e.p({fileList:e.unref(E),multiple:!0,maxCount:10,width:"162rpx",height:"162rpx",accept:"image",maxSize:"5242880",name:"2",previewFullVideo:!0}),n:e.sr(M,"ae9065f4-9",{k:"calendars"}),o:e.o(z),p:e.p({mode:"range",color:"#ff0000",date:[D(),""]}),q:e.o(O),r:e.unref(c)},e.unref(c)?{s:e.sr(d,"ae9065f4-11,ae9065f4-10",{k:"jixingPannelRef"}),t:e.o(m),v:e.o(p)}:{},{w:e.sr(v,"ae9065f4-10",{k:"jixingPopup"}),x:e.o(p),y:e.o(f),z:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"})})}},c=e._export_sfc(s,[["__scopeId","data-v-ae9065f4"]]);wx.createPage(c);
