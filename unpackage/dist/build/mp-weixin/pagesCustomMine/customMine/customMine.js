"use strict";const e=require("../../common/vendor.js"),t=require("../../stores/tabStore.js"),n=require("../../stores/userInfoStore.js"),o=require("../../stores/menuPermissionStore.js"),u=require("../../utils/system.js");if(!Array){(e.resolveComponent("uni-badge")+e.resolveComponent("identity-pannel")+e.resolveComponent("uni-popup")+e.resolveComponent("custom-tabbar"))()}Math||((()=>"../../uni_modules/uni-badge/components/uni-badge/uni-badge.js")+(()=>"../../components/identity-pannel/identity-pannel.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../components/custom-tabbar/custom-tabbar.js"))();const a={__name:"customMine",setup(a){const i=o.usePermissionStore(),r=t.useTabStore(),s=n.useUserStore(),m=e.ref(!1),c=e.ref(null),g=e.ref(!1),x=e.ref(!1),l=e.ref(null),p=e.ref(""),h=e.ref(""),d=e.ref(""),f=e.ref(!1);let w=!1;const y=e.ref([{text:"实时库存",value:"0"},{text:"实时销量",value:"0"},{text:"实时售额",value:"0"},{text:"今日上架",value:"0"}]),v=e.ref([{title:"商品管理",menuAuthority:"productManager",value:[{text:"商品录入",image:"https://www.xzxskj.com/xcximg/icon_luru12@3x.png",path:"/pagesProductInput/productInput/productInput",menuAuthority:"productInput"},{text:"功能检测",image:"https://www.xzxskj.com/xcximg/icon_zhijian1@3x.png",path:"/pagesFuncCheck/funcCheck/funcCheck",menuAuthority:"funcCheck"},{text:"维修检测",image:"https://www.xzxskj.com/xcximg/icon_weixin12@3x.png",path:"/pagesMaintenanceInput/maintenanceInput/maintenanceInput",menuAuthority:"maintenanceInput"},{text:"成色判断",image:"https://www.xzxskj.com/xcximg/icon_chengse@3x.png",path:"/pagesFinenessJudge/finenessJudge/finenessJudge",menuAuthority:"finenessJudge"},{text:"拍照上传",image:"https://www.xzxskj.com/xcximg/icon_paizhao12@3x.png",path:"/pagesTakePhoto/takePhoto/takePhoto",menuAuthority:"takePhoto"},{text:"定价上架",image:"https://www.xzxskj.com/xcximg/icon_shangjia@3x.png",path:"/pagesListingProduct/listingProduct/listingProduct",menuAuthority:"listingProduct"},{text:"库存管理",image:"https://www.xzxskj.com/xcximg/icon_kucun@3x.png",path:"/pagesInventoryManager/inventoryManager/inventoryManager",menuAuthority:"inventoryManager"},{text:"质检管理",image:"https://www.xzxskj.com/xcximg/icon_zhijian@3x.png",path:"/pagesQualityControl/qualityControl/qualityControl",menuAuthority:"qualityControl"},{text:"串号追踪",image:"https://www.xzxskj.com/xcximg/icon_chuanhao12@3x.png",path:"/pagesImeiTrack/ImeiTrack/imeiTrack",menuAuthority:"imeiTrack"},{text:"商品移库",image:"https://www.xzxskj.com/xcximg/icon_yiku@3x.png",path:"/pagesMovingInventory/movingInventory/movingInventory",menuAuthority:"productRelocation"},{text:"快速批发",image:"https://www.xzxskj.com/xcximg/icon_pifa12@3x.png",path:"/pagesFirstWholesale/firstWholeSale/firstWholeSale",menuAuthority:"firstWholeSale"}]},{title:"后台管理",menuAuthority:"back",value:[{text:"员工岗位",image:"https://www.xzxskj.com/xcximg/icon_yuangong@3x.png",path:"/pagesStaffManager/staffManager/staffManager",menuAuthority:"staffManager"},{text:"仓库管理",image:"https://www.xzxskj.com/xcximg/icon_cangku12@3x.png",path:"/pagesWarehouseManagement/warehouseManagement/warehouseManagement",menuAuthority:"warehouseManagement"},{text:"客户管理",image:"https://www.xzxskj.com/xcximg/icon_kehuguanli@3x.png",path:"/pagesCustomManager/customManager/customManager",menuAuthority:"customManager"},{text:"退款审核",image:"https://www.xzxskj.com/xcximg/approval.png",path:"/pagesApproval/approval/approval",menuAuthority:"refundReview",num:"0"},{text:"财务对账",image:"https://www.xzxskj.com/xcximg/icon_duizhang@3x.png",path:"/pagesFinance/finance/finance",menuAuthority:"finance"},{text:"收款账户",image:"https://www.xzxskj.com/xcximg/icon_shoukuan12@3x.png",path:"/pagesPayAccount/payAccount/payAccount",menuAuthority:"receivingAccount"},{text:"发货地址",image:"https://www.xzxskj.com/xcximg/icon_dizhi@3x.png",path:"/pagesShippingAddress/shippingAddress/shippingAddress",menuAuthority:"shippingAddress"}]},{title:"其他",value:[{text:"平台客服",image:"https://www.xzxskj.com/xcximg/icon_kefu@3x.png",menuAuthority:""},{text:"意见反馈",image:"https://www.xzxskj.com/xcximg/icon_fankui@3x.png",path:"/pagesSuggest/suggest/suggest?title=意见反馈",menuAuthority:""}]}]),k=e.ref([{title:"销售订单",menuAuthority:"saleOrder",num:"0",values:[{image:"https://www.xzxskj.com/xcximg/icon_daifukuan@3x.png",text:"待付款",lx:"3",path:"/pagesCustomOrder/customOrder/customOrder?order=3",menuAuthority:"pendingPayment",num:"0"},{image:"https://www.xzxskj.com/xcximg/icon_daifahuo@3x.png",text:"待发货",lx:"4",path:"/pagesCustomOrder/customOrder/customOrder?order=4",menuAuthority:"pendingShipment",num:"0"},{image:"https://www.xzxskj.com/xcximg/icon_daishouhuo@3x.png",text:"待收货",lx:"5",path:"/pagesCustomOrder/customOrder/customOrder?order=5",menuAuthority:"pendingReceipt",num:"0"},{image:"https://www.xzxskj.com/xcximg/icon_yishouhou1@3x.png",text:"已收货",lx:"6",path:"/pagesCustomOrder/customOrder/customOrder?order=6",menuAuthority:"receivedGoods",num:"0"},{image:"https://www.xzxskj.com/xcximg/icon_jianyiwancheng@3x.png",text:"交易完成",lx:"7",path:"/pagesCustomOrder/customOrder/customOrder?order=7",menuAuthority:"dealDone",num:"0"}],selected:!0},{title:"议价订单",menuAuthority:"yjOrder",num:"0",values:[{image:"https://www.xzxskj.com/xcximg/icon_yijiazh@3x.png",text:"议价待确认",lx:"2",path:"/pagesCustomOrder/customOrder/customOrder?yj=2",menuAuthority:"yjToBeConfirmed",num:"0"},{image:"https://www.xzxskj.com/xcximg/icon_yijiacg@3x.png",text:"议价成功",lx:"3",path:"/pagesCustomOrder/customOrder/customOrder?yj=3",menuAuthority:"yjSuccessfully",num:"0"},{image:"https://www.xzxskj.com/xcximg/icon_yijiasb@3x.png",text:"驳回议价",lx:"4",path:"/pagesCustomOrder/customOrder/customOrder?yj=4",menuAuthority:"rejectBargaining",num:"0"}],selected:!1},{title:"售后订单",menuAuthority:"serviceOrder",num:"0",values:[{image:"https://www.xzxskj.com/xcximg/icon_shouhouzhong@3x.png",text:"售后中",lx:"2",path:"/pagesCustomOrder/customOrder/customOrder?sh=2",menuAuthority:"serviceIng",num:"0"},{image:"https://www.xzxskj.com/xcximg/icon_shouhouchenggong@3x.png",text:"售后成功",lx:"3",path:"/pagesCustomOrder/customOrder/customOrder?sh=3",menuAuthority:"serviceSuccess",num:"0"},{image:"https://www.xzxskj.com/xcximg/icon_shouhouzhong@3x.png",text:"售后失败",lx:"4",path:"/pagesCustomOrder/customOrder/customOrder?sh=4",menuAuthority:"serviceFail",num:"0"}],selected:!1},{title:"先货后款",menuAuthority:"fpbkOrder",num:"0",values:[{image:"https://www.xzxskj.com/xcximg/icon_shouhouzhong@3x.png",text:"未收款",lx:"2",path:"/pagesCustomOrder/customOrder/customOrder?fpak=1",menuAuthority:"unpaidPayments",num:"0"},{image:"https://www.xzxskj.com/xcximg/icon_shouhouchenggong@3x.png",text:"已收款",lx:"3",path:"/pagesCustomOrder/customOrder/customOrder?fpak=2",menuAuthority:"receivedPayment",num:"0"},{image:"https://www.xzxskj.com/xcximg/icon_shouhouzhong@3x.png",text:"已退货",lx:"4",path:"/pagesCustomOrder/customOrder/customOrder?fpak=3",menuAuthority:"returnedProduct",num:"0"}],selected:!1}]),j=e.computed((()=>{const e=L.value.find((e=>e.selected));return e?e.values:[]})),A=e.computed((()=>{const e=L.value.find((e=>e.selected));return console.log("selectedItem.length<4",e.length<4),e.values.length<4?{paddingLeft:"76rpx",paddingRight:"62rpx"}:{}})),z=e.computed((()=>i.hasMenuAuthority("supplier"))),_=e.computed((()=>i.hasMenuAuthority("dataCenter"))),O=e.computed((()=>v.value.filter((e=>!e.menuAuthority||i.hasMenuAuthority(e.menuAuthority))).map((e=>({...e,value:e.value.filter((e=>!e.menuAuthority||i.hasMenuAuthority(e.menuAuthority)))}))))),b=()=>{m.value=!1,e.index.navigateBack({delta:getCurrentPages().length-1})},C=()=>{l.value.close()},S=()=>{x.value=!0,l.value.open()},M=t=>{e.index.navigateTo({url:t})},I=e=>{e.detail.deltaY<0||(f.value=!0)},P=async()=>{if(w)return;w=!0,c.value=await s.getInfo();const t=e.index.getStorageSync("infos");t&&(q(t),B(t)),F(),setTimeout((()=>{f.value=!1,w=!1}),1e3)},T=()=>{f.value=!1},q=e=>{[{title:"销售订单",field:"zordernum",subfields:[{index:1,field:"dfh"}]},{title:"议价订单",field:"zyjordernum",subfields:[{index:0,field:"yjz"}]},{title:"售后订单",field:"zshordernum",subfields:[{index:0,field:"shz"}]},{title:"先货后款",field:"zxhhkordernum",subfields:[{index:0,field:"wsk"}]}].forEach((t=>{const n=k.value.find((e=>e.title===t.title));n&&(n.num=e[t.field],t.subfields.forEach((t=>{n.values[t.index].num=e[t.field]})))}))},B=e=>{const t=v.value.find((e=>"后台管理"===e.title));t&&(t.value[3].num=e.cwtknum),y.value[0].value=e.goodsnum,y.value[3].value=e.jrnum,y.value[1].value=e.ssnum,y.value[2].value=e.ssprice},F=()=>{const t=e.index.getStorageSync("selectedMine");e.index.getStorageSync("identityData"),c.value.joininfos&&c.value.joininfos.length>0?g.value=!0:g.value=!1,t&&(p.value=c.value.joininfos[t-1].gwname,h.value=c.value.joininfos[t-1].gsname,d.value=c.value.joininfos[t-1].username),i.loadMenuAuthority();0===e.index.getStorageSync("userAuthorityUrls").route.length&&(e.index.showToast({title:"您没有权限",icon:"error",duration:2e3}),setTimeout((()=>{e.Vs.database().collection("user-setting").where({user_id:JSON.parse(e.index.getStorageSync("userInfo")).id}).remove().then((()=>{e.index.clearStorageSync(),e.index.reLaunch({url:"/pages/home/home"})}))}),500))},L=e.computed((()=>{console.log("权限：",i.menuAuthorityData),console.log("过滤前mine_card_datas",k.value);const e=k.value.filter((e=>!e.menuAuthority||i.hasMenuAuthority(e.menuAuthority))).map((e=>({...e,values:e.values.filter((e=>!e.menuAuthority||i.hasMenuAuthority(e.menuAuthority)))})));return!e.some((e=>e.selected))&&e.length>0&&(e[0].selected=!0),console.log("过滤后mine_card_datas",e),e}));let D=null;const J=()=>{D&&(clearInterval(D),D=null,console.log("定时器已停止"))};return e.onLoad((async t=>{t.from&&"identity"===t.from&&(m.value=!0),c.value=await s.getInfo();const n=e.index.getStorageSync("infos");n&&(q(n),B(n)),F(),r.setCurrentTabIndex(4)})),e.onShow((()=>{r.setCurrentTabIndex(4),D=setInterval((async()=>{c.value=await s.getInfo();const t=e.index.getStorageSync("infos");t&&(q(t),B(t)),F()}),5e3)})),e.onUnload((()=>{J()})),e.onHide((()=>{J()})),e.index.$on("pagesCustomMineUpdate",(async()=>{c.value=await s.getInfo(),F()})),(t,n)=>e.e({a:e.unref(m)},e.unref(m)?{b:e.unref(m),c:e.o(b)}:{},{d:e.unref(u.getStatusBarHeight)()+"px",e:e.t(e.unref(h)),f:e.unref(u.getTitleBarHeight)()+"px",g:e.unref(u.getLeftIconLeft)()+"px",h:e.unref(c)},e.unref(c)?e.e({i:""===e.unref(c).img?"https://www.xzxskj.com/xcximg/132.jpg":"https://www.xzxskj.com"+e.unref(c).img,j:e.t(e.unref(d)),k:e.t(e.unref(p)),l:e.unref(g)},e.unref(g)?{m:e.o(S)}:{}):{},{n:z.value},z.value?{o:e.o((e=>M("/pagesAccount/account/account?from=customer")))}:{},{p:_.value},_.value?{q:e.o((e=>M("/pagesDataCenter/dataCenter/dataCenter"))),r:e.f(e.unref(y),((t,n,o)=>({a:e.t(t.value),b:e.t(t.text),c:n})))}:{},{s:L.value&&L.value.length>0},L.value&&L.value.length>0?{t:e.f(L.value,((t,n,o)=>({a:e.t(t.title),b:t.selected?1:"",c:"f3b91444-0-"+o,d:e.p({size:"small",text:t.num,inverted:"0"===t.num||t.selected,absolute:"rightTop",type:"error","custom-style":{color:"#ffffff"}}),e:n,f:e.o((e=>{return n=t,k.value.forEach((e=>{e.selected=e.title===n.title})),k.value=[...k.value],void console.log("Updated mine_card_datas",k.value);var n}),n)}))),v:e.f(j.value,((t,n,o)=>({a:t.image,b:"f3b91444-1-"+o,c:e.p({size:"small",text:t.num,inverted:"0"===t.num,absolute:"rightTop",type:"error","custom-style":{color:"#ffffff"}}),d:e.t(t.text),e:n,f:e.o((e=>M(t.path)),n)}))),w:e.s(A.value)}:{},{x:O.value&&O.value.length>0},O.value&&O.value.length>0?{y:e.f(O.value,((n,o,u)=>({a:e.t(n.title),b:e.f(n.value,((n,o,a)=>e.e({a:n.image,b:"f3b91444-2-"+u+"-"+a,c:e.p({size:"small",text:n.num,inverted:"0"===n.num,absolute:"rightTop",type:"error","custom-style":{color:"#ffffff"}}),d:e.t(n.text),e:"平台客服"===n.text},"平台客服"===n.text?{f:e.o(((...e)=>t.onContact&&t.onContact(...e)),o)}:{},{g:o,h:e.o((e=>M(n.path)),o)}))),c:o})))}:{},{z:e.unref(f),A:e.o(I),B:e.o(P),C:e.o(T),D:e.unref(x)},e.unref(x)?{E:e.o(C)}:{},{F:e.sr(l,"f3b91444-3",{k:"identityPopup"}),G:e.o(C),H:e.o(t.change),I:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area:false":!0,type:"center"})})}},i=e._export_sfc(a,[["__scopeId","data-v-f3b91444"]]);wx.createPage(i);
