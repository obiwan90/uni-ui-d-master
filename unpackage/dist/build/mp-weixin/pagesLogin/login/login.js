"use strict";const e=require("../../common/vendor.js"),o=require("../../api/login/loginApi.js"),n=require("../../api/member/member.js"),i=require("../../stores/tokenStore.js"),t=require("../../stores/userInfoStore.js"),s={__name:"login",setup(s){const r=async s=>{const r=await i.useTokenStore().getSession();await i.useTokenStore().getToken();const a={encryptedData:s.detail.encryptedData,iv:s.detail.iv,session_key:r.session_key,opid:r.opid},d=await o.apiGetPhone(a);if(console.log("login res:",d),null!==d.phone){i.useTokenStore().setPhone(d.phone);const o=e.index.getStorageSync("locationForm"),s=d.phone,a={opid:r.opid,phone:s,yqopid:"",laiyuan:1,city:o?o.city:"",unionid:e.index.getStorageSync("sessionInfo").unionid},p={openid:r.opid};await n.apiAddWxUser(a);const c=await n.apiGetUserInfo(p);c&&t.useUserStore().setInfo(c),e.index.reLaunch({url:"/pages/home/home"})}else e.index.showToast({title:"登录失败",icon:"error",duration:2e3}),e.index.navigateTo({url:"/pages/home/home"})};return(o,n)=>({a:e.o(r)})}},r=e._export_sfc(s,[["__scopeId","data-v-4ab0f9c0"]]);wx.createPage(r);
