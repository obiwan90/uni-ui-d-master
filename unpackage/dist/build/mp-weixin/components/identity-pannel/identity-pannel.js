"use strict";const e=require("../../common/vendor.js"),a=require("../../stores/userInfoStore.js"),n=require("../../utils/debounce.js"),i={__name:"identity-pannel",emits:["close"],setup(i,{emit:t}){const s=t,d=()=>{s("close")},o=e.ref([]),u=e.ref(0),c=e.ref(""),r=e.ref(""),l=n.debounce((()=>m()),1e3,!0),m=async()=>{e.index.setStorageSync("adminLx",c.value),e.index.setStorageSync("adminId",r.value);const n=e.index.getStorageSync("selectedMine")||0;if(n===u.value)return void d();await a.useUserStore().getInfo(),e.index.setStorageSync("identityData",o.value),e.index.setStorageSync("selectedMine",u.value),await(async()=>{const a=JSON.parse(e.index.getStorageSync("userInfo")),n=e.Vs.database();await n.collection("user-setting").where({user_id:a.id}).remove(),await n.collection("user-setting").add({user_id:a.id,adminLx:c.value,adminId:r.value,identityData:o.value,selectedMine:String(u.value)})})();if(o.value[n].adminLx===o.value[u.value].adminLx){const a="1"===o.value[n].adminLx;e.index.$emit(a?"pagesAdminUpdate":"pagesCustomMineUpdate"),d()}else e.index.showLoading({title:"加载中"}),setTimeout((()=>{e.index.redirectTo({url:o.value[u.value].path+"?from=identity",success:()=>{e.index.hideLoading()},fail:a=>{console.error("Redirect failed:",a),e.index.hideLoading()}})}),300),d()};return e.onMounted((()=>{const a=e.index.getStorageSync("selectedMine");a&&(u.value=a),(()=>{const a=JSON.parse(e.index.getStorageSync("userInfo"));a.joininfos&&a.joininfos.length>0&&(o.value.push({image:"https://www.xzxskj.com/Public/upload/66a5cbd5313826194.png",username:a.username||"",text:"我是用户",adminLx:"",adminId:"",company:"",path:"/pagesUserMine/userMine/userMine"}),a.joininfos.forEach((e=>{const a="1"===e.adminlx?"https://www.xzxskj.com/Public/upload/66a5cbecc3e433030.png":"2"===e.adminlx||"4"===e.adminlx?"https://www.xzxskj.com/Public/upload/66a5cbbbd871a873.png":"",n="1"===e.adminlx?"/pagesAdmin/admin/admin":"2"===e.adminlx||"4"===e.adminlx?"/pagesCustomMine/customMine/customMine":"";o.value.push({image:a,username:e.username||"",text:e.gsname,adminLx:e.adminlx,adminId:e.id,company:e.gwname,path:n,gsid:e.gsid})})))})()})),(a,n)=>({a:e.o((e=>a.$emit("close"))),b:e.f(o.value,((a,n,i)=>e.e({a:a.image,b:e.t(a.text),c:a.company},a.company?{d:e.t(a.company),e:"1"===a.adminLx?1:""}:{},{f:"我是用户"===a.text?1:"",g:u.value===n},(u.value,{}),{h:n,i:u.value===n?1:"",j:e.o((e=>((e,a)=>{u.value=e,c.value=a.adminLx,r.value=a.adminId})(n,a)),n)}))),c:e.o((a=>e.unref(l)()))})}},t=e._export_sfc(i,[["__scopeId","data-v-84c6418b"]]);wx.createComponent(t);
