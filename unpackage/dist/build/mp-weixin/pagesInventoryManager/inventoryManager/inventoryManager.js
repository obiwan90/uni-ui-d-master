"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/common.js"),o=require("../api/api.js");if(!Array){(e.resolveComponent("custom-header")+e.resolveComponent("uni-data-select")+e.resolveComponent("van-dropdown-item")+e.resolveComponent("van-dropdown-menu")+e.resolveComponent("uni-dateformat")+e.resolveComponent("van-loading")+e.resolveComponent("van-image")+e.resolveComponent("van-tag")+e.resolveComponent("uni-icons")+e.resolveComponent("z-paging")+e.resolveComponent("uni-popup"))()}const t=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||((()=>"../../components/custom-header/custom-header.js")+(()=>"../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+l+(()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/z-paging/components/z-paging/z-paging.js")+e.unref(n)+t+e.unref(u)+e.unref(s))();const l=()=>"../../uni_modules/qiao-select/components/qiao-select/qiaoSelect.js",n=()=>"./components/inventoryManagerSaixuan.js",u=()=>"./components/productControlPannel.js",s=()=>"./components/exportLog.js",r={__name:"inventoryManager",setup(t){const l=e.computed((()=>0===M.value?"ch":"name")),n=e.computed((()=>0===M.value?"ch":"name")),u=e.ref(null),s=async()=>{r();try{const e=await a.scanCode();console.log("result",e),e&&H(e).then((()=>{L.value.length>0&&(u.value.inputText=L.value[0].ch)}))}catch(e){console.error("扫码失败：",e)}finally{i()}},r=()=>{e.index.showLoading({title:"加载中...",mask:!0})},i=()=>{e.index.hideLoading()},c=e.ref(!1),d=e.ref([]),p=e.ref(0),v=e.ref([{value:0,text:"批量快速批发"},{value:1,text:"批量退出库存"}]),f=a=>{const o=v.value[a];e.index.showModal({title:"确认操作",content:`确定要进行${o.text}操作吗？`,success:e=>{e.confirm?(console.log("用户点击确定"),pe(a)):e.cancel&&console.log("用户点击取消")}})},m=()=>{c.value=!c.value,c.value?(d.value=E.value,console.log("selectedItems",d.value)):d.value=[]},g=e=>{const a=d.value.indexOf(e);a>-1?d.value.splice(a,1):d.value.push(e)},h=e.computed((()=>d.value.length)),x=e.computed((()=>d.value.reduce(((e,a)=>e+(parseFloat(a.price)||0)),0))),z=e.ref(null),b=e.ref(!0),y=e.ref(null),k=e.ref(!1),C=e.ref(null),F=e.ref(!1),w=e.ref(null),j=()=>{console.log("Popup is closed"),C.value.close(),w.value.close(),z.value.close(),_.value.refresh(!0)},S=e=>{e.show||(k.value=e.show,F.value=e.show)},P=()=>{b.value=!0,y.value.initTime(),z.value.open()},I=()=>{k.value=!0,C.value.open()},_=e.ref(null),E=e.ref([]);e.ref(!0);const q=async(e,a)=>{if(console.log("pageNo:",e),console.log("pageSize:",a),ie.value.start=String(e-1),await ce(),ie.value.ch){const e=R(ne.value[0].zt);console.log("重置",e),K.value=D.value.find((a=>a.text===e)).value,console.log("重置",K.value)}_.value.complete(ne.value)},M=e.ref(0),T=e.ref([{value:0,text:"串号搜索"},{value:1,text:"型号搜索"}]),G=e=>{console.log("e:",e),L.value=[],M.value=e},L=e.ref([]),W=e=>{console.log(e),ie.value.ch="",ie.value.id="",0===M.value?ie.value.ch=e.ch:ie.value.id=e.id,ie.value.zt&&(ie.value.zt=""),u.value.clearData(),L.value=[],_.value.reload(!0)},H=async a=>{console.log("输入框内容:",a),a.length>0?(console.log("inputText",a),e.index.showLoading({title:"加载中",mask:!0}),0===M.value&&await(async e=>{const a={ch:e},t=await o.apiChSelectSearch(a);"200"===t.code&&t.goodslist&&(console.log(t),L.value=t.goodslist)})(a),1===M.value&&await(async e=>{const a={xh:e},t=await o.apiModelSearch(a);console.log("res",t),"200"===t.code&&(L.value=t.goodslist)})(a),e.index.hideLoading()):(L.value=[],ie.value.id="")},D=e.ref([{text:"上架中",value:"1"},{text:"平台已售",value:"2"},{text:"先货后款",value:"3"},{text:"线下已售",value:"4"},{text:"临时下架",value:"5"},{text:"已退库存",value:"6"}]),O=e.ref([{text:"上架中",value:"1"},{text:"平台已售",value:"5"},{text:"先货后款",value:"7"},{text:"线下已售",value:"6"},{text:"临时下架",value:"3"},{text:"已退库存",value:"4"}]),R=e=>{const a=O.value.find((a=>a.value===e));return a?a.text:""},B=e.ref([{text:"最新上架",value:"1"},{text:"库龄最长",value:"2"}]),A=e.ref([{text:"全部采购",value:-1}]),V=e.ref([{text:"全部仓库",value:-1}]),K=e.ref("1"),N=e.ref("1"),J=e.ref(-1),X=e.ref(-1),$=e.ref([{type:"上架中",zt:"1",btns:["临时下架","退出库存","快速批发"]},{type:"先货后款",zt:"7",btns:["去收款"]},{type:"临时下架",zt:"3",btns:["退出库存","继续上架"]},{type:"已退库存",zt:"4",btns:[]},{type:"平台已售",zt:"5",btns:[]},{type:"线下已售",zt:"6",btns:[]}]),Q=e=>$.value.find((a=>a.zt===e)),U=e=>{K.value=e.detail,ie.value.zt=e.detail,ie.value.ch&&(ie.value.ch=""),u.value.clearData(),L.value=[],console.log("selectParamChange1:",e),_.value.reload(!0)},Y=e=>{N.value=e.detail,ie.value.lx=e.detail,console.log("selectParamChange2:",e),_.value.reload(!0)},Z=e=>{J.value=e.detail,console.log("selectParamChange3:",e),ie.value.cgygid=-1===e.detail?"":e.detail,_.value.reload(!0)},ee=e=>{X.value=e.detail,console.log("selectParamChange4:",e),ie.value.ckid=-1===e.detail?"":e.detail,_.value.reload(!0)},ae=e.ref(),oe=e.ref(),te=e.ref(),le=(a,o)=>{const t=Q(a.zt).btns[o];e.index.showModal({title:"确认",content:`您确定要执行 "${t}" 操作吗？`,success:o=>{o.confirm&&("商品管理"===t&&(ae.value=a.name,oe.value=a.ch,te.value=a.id,F.value=!0,w.value.open()),"去收款"===t&&e.index.navigateTo({url:"/pagesCustomOrder/customOrder/customOrder?fpak=1&ch="+a.ch}),"临时下架"===t&&de("/Home/Goods/updatezt?zt=1",{id:a.id,zt:"1"}),"退货下架"===t&&de("/Home/Goods/updatezt?zt=3",{id:a.id,zt:"3"}),"退出库存"===t&&de("/Home/Goods/updatezt?zt=2",{id:a.id,zt:"2"}),"退货上架"===t&&de("/Home/Goods/updatezt?zt=4",{id:a.id,zt:"4"}),"继续上架"===t&&de("/Home/Goods/updatezt?zt=5",{id:a.id,zt:"5"}),"快速批发"===t&&e.index.navigateTo({url:"/pagesFirstWholesale/firstWholeSale/firstWholeSale?data="+JSON.stringify(a)}),"重新录入"===t&&e.index.navigateTo({url:"/pagesProductInput/productInput/productInput?ch="+a.ch+"&qcid="+a.qcid+"&zjid="+a.zjid}))}})},ne=e.ref([]),ue=e.ref([]),se=e.ref([]),re=e.ref(0),ie=e.ref({opid:e.index.getStorageSync("sessionInfo").opid,zt:"1",lx:"1",zxsj:"1",ckid:"",cgygid:"",start:"",qt:"",classid:"",ppid:"",systemid:"",versionid:"",finenessid:"",memoryid:"",colourid:"",price:"",sjkssj:"",sjjssj:"",id:"",ch:""}),ce=async()=>{const a=await o.apiGetInventory(ie.value);"200"===a.code&&(console.log("库存信息 res:",a),ne.value=a.goodslist,ue.value=a.cgyglist,se.value=a.cklist,re.value=(a=>{const o=e.ref(0);return a.forEach((e=>{o.value+=parseInt(e.price?e.price:"0")})),o.value})(ne.value),se.value&&(se.value.forEach((e=>{V.value.some((a=>a.value===e.id))||(V.value.push({text:e.name,value:e.id}),console.log("option4:",V.value))})),V.value=[...V.value],console.log("cklist:",se.value)),ue.value&&(ue.value.forEach((e=>{A.value.some((a=>a.value===e.id))||(A.value.push({text:e.username,value:e.id}),console.log("option3:",A.value))})),A.value=[...A.value],console.log("cgyglist:",ue.value)))},de=async(a,t)=>{200===(await o.apiEditInventory(a,t)).code&&(e.index.showToast({title:"操作成功",icon:"none",duration:2e3}),_.value.refresh(!0))},pe=e=>{0===e&&ve(d.value),1===e&&fe(d.value)},ve=a=>{let o="";a.length>0&&(a.forEach((e=>{o+=e.ch+","})),o.endsWith(",")&&(o=o.slice(0,-1)),e.index.navigateTo({url:"/pagesFirstWholesale/firstWholeSale/firstWholeSale?chs="+o}))},fe=e=>{let a="";e.length>0&&(e.forEach((e=>{a+=e.id+","})),a.endsWith(",")&&(a=a.slice(0,-1)),de("/Home/Goods/updatezt?zt=2",{id:a,zt:"2"}))};return(o,t)=>e.e({a:e.p({backgroundColor:"#FFFFFF"}),b:e.o(G),c:e.o((a=>e.isRef(M)?M.value=a:null)),d:e.p({localdata:e.unref(T),clear:!1,modelValue:e.unref(M)}),e:e.sr(u,"c3b43181-2",{k:"myInputRef"}),f:e.o(H),g:e.o(W),h:e.p({keyId:1,dataList:e.unref(L),phText:"请输入串号",searchKey:"name",showBorder:!1,disabled:!1,searchKey:e.unref(l),showField:e.unref(n)}),i:e.o(s),j:e.o(I),k:e.o(U),l:e.p({value:e.unref(K),options:e.unref(D),popupStyle:"border-radius: 0 0 20rpx 20rpx;"}),m:e.o(Y),n:e.p({value:e.unref(N),options:e.unref(B),popupStyle:"border-radius: 0 0 20rpx 20rpx;"}),o:e.o(Z),p:e.p({value:e.unref(J),options:e.unref(A),popupStyle:"border-radius: 0 0 20rpx 20rpx;"}),q:e.o(ee),r:e.p({value:e.unref(X),options:e.unref(V),popupStyle:"border-radius: 0 0 20rpx 20rpx;"}),s:e.p({zIndex:"20",activeColor:"#EB4636"}),t:e.f(e.unref(E),((o,t,l)=>e.e("1"==e.unref(K)||"3"==e.unref(K)||"5"==e.unref(K)?{a:e.t(o.kl)}:{},{b:"c3b43181-9-"+l+",c3b43181-8",c:e.p({date:e.unref(a.formatTimestamp)(o.add_times),format:"yyyy-MM-dd hh:mm:ss"}),d:e.t(R(o.zt)),e:o.special&&"1"===o.special},(o.special&&o.special,{}),{f:"c3b43181-11-"+l+",c3b43181-10-"+l,g:"c3b43181-10-"+l+",c3b43181-8",h:e.p({width:"95",height:"95",fit:"as",radius:"18rpx",src:o.cover,mode:"fill"}),i:o.finenessname},o.finenessname?{j:e.t(o.finenessname),k:"c3b43181-12-"+l+",c3b43181-8",l:e.p({size:"medium",color:"linear-gradient( 132deg, #D94C24 0%, #FF5221 100%)"})}:{},{m:e.t(o.name),n:e.t(o.ch),o:e.t(o.cgyname),p:e.t(o.ckname),q:e.t(o.price),r:"1"===e.unref(K)&&!e.unref(d).includes(o)},"1"!==e.unref(K)||e.unref(d).includes(o)?{}:{s:e.o((e=>g(o)),t),t:"c3b43181-13-"+l+",c3b43181-8",v:e.p({color:"#D2CFCA",type:"circle",size:"32"})},{w:"1"===e.unref(K)&&e.unref(d).includes(o)},"1"===e.unref(K)&&e.unref(d).includes(o)?{x:e.o((e=>g(o)),t),y:"c3b43181-14-"+l+",c3b43181-8",z:e.p({color:"#E6432E",type:"checkbox-filled",size:"32"})}:{},{A:"1"!==o.zt},"1"!==o.zt?{B:e.t(o.cgname),C:"c3b43181-15-"+l+",c3b43181-8",D:e.p({date:"2024-04-16 11:45:12",format:"yyyy-MM-dd hh:mm:ss"}),E:e.t(o.price)}:{},{F:Q(o.zt).btns.length>0},Q(o.zt).btns.length>0?{G:e.f(Q(o.zt).btns,((a,t,l)=>({a:e.t(a),b:t===Q(o.zt).btns.length-1?" #FFFFFF":"#1F1F1F",c:e.o((e=>le(o,t)),t),d:t,e:t===Q(o.zt).btns.length-1?"none":"2rpx solid #1f1f1f",f:t===Q(o.zt).btns.length-1?1:.5,g:t===Q(o.zt).btns.length-1?"linear-gradient(89deg, #FF6D0C 0%, #EB4636 100%)":""})))}:{},{H:t}))),v:"1"==e.unref(K)||"3"==e.unref(K)||"5"==e.unref(K),w:e.p({type:"spinner",size:"20",vertical:!0}),x:e.sr(_,"c3b43181-8",{k:"paging"}),y:e.o(q),z:e.o((a=>e.isRef(E)?E.value=a:null)),A:e.p({"default-page-size":20,"show-refresher-update-time":!0,fixed:!1,modelValue:e.unref(E)}),B:e.t("1"===e.unref(K)?e.unref(h):e.unref(E).length),C:e.t("1"===e.unref(K)?e.unref(x):e.unref(re)),D:"1"===e.unref(K)},"1"===e.unref(K)?e.e({E:!e.unref(c)},(e.unref(c),{}),{F:e.o(m)}):{},{G:"1"!==e.unref(K)},"1"!==e.unref(K)?{H:e.o(P)}:{},{I:"1"===e.unref(K)},"1"===e.unref(K)?{J:e.o(f),K:e.o((a=>e.isRef(p)?p.value=a:null)),L:e.p({localdata:e.unref(v),placement:"top",clear:!1,modelValue:e.unref(p)}),M:e.o(P)}:{},{N:e.unref(k)},e.unref(k)?{O:e.o(j)}:{},{P:e.sr(C,"c3b43181-17",{k:"saiXuanPannelPopup"}),Q:e.o(j),R:e.o(S),S:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"}),T:e.unref(F)},e.unref(F)?{U:e.unref(te),V:e.o(j),W:e.p({id:e.unref(te),name:e.unref(ae),imei:e.unref(oe)})}:{},{X:e.sr(w,"c3b43181-19",{k:"productControlPannelPopup"}),Y:e.o(j),Z:e.o(S),aa:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"center"}),ab:e.unref(b)},e.unref(b)?{ac:e.sr(y,"c3b43181-22,c3b43181-21",{k:"exportLogPannelRef"}),ad:e.o(j)}:{},{ae:e.sr(z,"c3b43181-21",{k:"exportLogPopup"}),af:e.o(j),ag:e.o(G),ah:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!1,"safe-area":!1,type:"bottom"})})}},i=e._export_sfc(r,[["__scopeId","data-v-c3b43181"]]);wx.createPage(i);
