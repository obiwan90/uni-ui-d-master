"use strict";const e=require("../../common/vendor.js");require("../../stores/tokenStore.js"),require("../../stores/userInfoStore.js");const i=require("../../utils/common.js"),n=require("../../api/qualityCheck/qualityCheck.js");if(!Array){(e.resolveComponent("custom-header")+e.resolveComponent("van-tag")+e.resolveComponent("uv-album")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list")+e.resolveComponent("uni-collapse-item")+e.resolveComponent("uni-collapse")+e.resolveComponent("uv-upload"))()}Math||((()=>"../../components/custom-header/custom-header.js")+(()=>"../../uni_modules/uv-album/components/uv-album/uv-album.js")+(()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../uni_modules/uni-list/components/uni-list/uni-list.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse/uni-collapse.js")+(()=>"../../uni_modules/uv-upload/components/uv-upload/uv-upload.js"))();const t={__name:"qualityReport",setup(t){const a=e.getCurrentInstance(),l=e.ref([{type:"gjbbname",title:"国家版本",value:"无"},{type:"wlbbname",title:"网络版本",value:"无"},{type:"bxzt",title:"保修状态",value:"无"},{type:"efficiency",title:"电池效率",value:"无"}]),o=e.ref([{title:"上传图片",tips:"* 机身背面为封面图",items:[{text:"机身背面",image:"https://www.xzxskj.com/xcximg/img_add_img@3x.png",fileList:[]},{text:"屏幕息屏",image:"https://www.xzxskj.com/xcximg/img_add_closewindow@3x.png",fileList:[]},{text:"关于本机",image:"https://www.xzxskj.com/xcximg/img_add_about@3x.png",fileList:[]}]},{title:"中框四面",items:[{text:"中框上方",image:"https://www.xzxskj.com/xcximg/img_add_upward@3x.png",fileList:[]},{text:"中框右侧",image:"https://www.xzxskj.com/xcximg/img_add_right@3x.png",fileList:[]},{text:"中框下方",image:"https://www.xzxskj.com/xcximg/img_add_downward@3x.png",fileList:[]},{text:"中框左侧",image:"https://www.xzxskj.com/xcximg/img_add_left@3x.png",fileList:[]}]},{title:"机身四角",items:[{text:"左上角",image:"https://www.xzxskj.com/xcximg/img_add_lefttop@3x.png",fileList:[]},{text:"右上角",image:"https://www.xzxskj.com/xcximg/img_add_righttop@3x.png",fileList:[]},{text:"右下角",image:"https://www.xzxskj.com/xcximg/img_add_rightdown@3x.png",fileList:[]},{text:"左下角",image:"https://www.xzxskj.com/xcximg/img_add_leftdown@3x.png",fileList:[]}]}]),s=e.ref(!1);e.ref("ch"),e.ref("ch"),e.ref(!1),e.ref(null);const u=e.ref(""),r=e.ref([]),c=e.ref(),m=e.ref(!1),p=e.ref([]),f=e.ref(),d=e.ref(),g=e.ref([]),x=e.ref(),v=e.ref(),w=e.ref(),h=e.ref([]),b=async()=>{const e={id:z.value.zjid},i=await n.apiQualityCheckInfo(e);if("200"===i.code){console.log("Quality check info:",i),f.value=i.infos;new Date(f.value.bxsj);x.value=f.value.jbztycbg?JSON.parse(f.value.jbztycbg):[],v.value=f.value.gnjcycbg?JSON.parse(f.value.gnjcycbg):[],w.value=f.value.wxjcycbg?JSON.parse(f.value.wxjcycbg):[],h.value=[...x.value.map((e=>({id:e.id,url:e.url}))),...v.value.map((e=>({id:e.id,url:e.url}))),...w.value.map((e=>({id:e.id,url:e.url})))];(()=>{const e=new Date;e.setHours(0,0,0,0)})();g.value=i.infos.qualityinspection,g.value.forEach((e=>{e.er.forEach((e=>{"保修截止"===e.name&&(e.xznr=f.value.bxsj,e.xznrcor="",e.xznrcor="black")}))})),console.log("qualityinspection:",g.value),d.value=i.yjinfos,f.value.combinationid.push(d.value.qminfos),f.value.combinationname.push(d.value.name),f.value.combinationyslist.push(d.value.color);const e=f.value.yjxsimg.split(","),n=f.value.jswgimg.split(","),t=f.value.pmwgimg.split(",");p.value=[{imgs:n},{imgs:t},{imgs:e}],l.value=l.value.map((e=>({...e,value:i.infos[e.type]||"无"}))),console.log("urls:",p.value[0].imgs)}},j=e=>!!h.value.find((i=>i.id===e)),z=e.ref(null);return e.index.$on("listingProductRefresh",(()=>{z.value=null,r.value=[]})),e.onLoad((t=>{if(t.data)try{s.value=!0,z.value=JSON.parse(decodeURIComponent(t.data)),u.value=z.value.jkbz+" "+z.value.gnjcbz+" "+z.value.wxjcbz+" "+z.value.pzbz+" "+z.value.csbz,console.log("Received data:",z.value),b()}catch(a){console.error("Failed to parse received data:",a)}t.ch&&(async i=>{const t={opid:e.index.getStorageSync("sessionInfo").opid,ch:i},a=await n.apiQualityCheckSerialSearch(t);if(200===a.code)return r.value=a.lists?a.lists:[]})(t.ch).then((e=>{(e=>{if(console.log("selectChange:",e),o.value.forEach((e=>{e.items.forEach((e=>{e.fileList=[]}))})),e){console.log("selectChange e:",e);const{name:n,ch:t,machinetime:a,jkuidname:l,id:s,functionaltime:r,gnjcuidname:p,servicetime:f,serviceuidname:d,price:g,special:x,finenessname:v,csbz:w,jkbz:h,gnjcbz:j,wxjcbz:y,pzbz:_,cgyname:k,productimage:C}=e;if(z.value={spname:n,imei:t,inputTime:i.formatTimestamp(a),inputPerson:l,funcInputTime:i.formatTimestamp(r),funcInputPerson:p,maintenanceInputTime:i.formatTimestamp(f),maintenanceInputPerson:d,zjid:s,finenessname:v,cgyname:k},console.log("Received data:",z.value),u.value=h+" "+j+" "+y+" "+_+" "+w,c.value=g,m.value=1==x,b(),C){const e=C.split(",");let i=0;o.value.forEach((n=>{n.items.forEach((n=>{i<e.length&&(n.fileList.push({url:e[i],name:n.text}),i++)}))}))}console.log("data",o.value)}})(e[0])}))})),(i,n)=>e.e({a:e.p({backgroundColor:"#F3F2F6"}),b:e.unref(z)},e.unref(z)?e.e({c:e.unref(z).finenessname},e.unref(z).finenessname?{d:e.t(e.unref(z).finenessname),e:e.p({size:"mini",color:"linear-gradient(132deg, #D94C24 0%, #FF5221 100%)"})}:{},{f:e.t(e.unref(z).spname),g:e.t(e.unref(z).imei),h:e.o((i=>e.unref(a).proxy.copyText(e.unref(z).imei))),i:e.t(e.unref(z).cgyname),j:e.t(e.unref(z).inputPerson),k:e.t(e.unref(z).funcInputPerson),l:e.t(e.unref(z).maintenanceInputPerson),m:e.t(e.unref(u))}):{},{n:e.f(e.unref(l),((i,n,t)=>({a:e.t(i.title),b:e.t(i.value),c:n}))),o:e.unref(z)},e.unref(z)?{p:e.unref(c),q:e.o((i=>e.isRef(c)?c.value=i.detail.value:null)),r:e.unref(m)?"https://www.xzxskj.com/xcximg/icon_xuanze_sel@3x.png":"https://www.xzxskj.com/xcximg/icon_moren_nor@3x.png"}:{},{s:e.unref(z)},e.unref(z)?{t:e.f(e.unref(f).combinationid,((i,n,t)=>({a:e.t(i),b:e.t(e.unref(f).combinationname[n]),c:e.unref(f).combinationyslist[n],d:"b8232a1d-2-"+t,e:e.p({urls:e.unref(p)[n].imgs,maxCount:"2",rowCount:"2",multipleSize:"48rpx",singleSize:"48rpx",space:"8rpx"}),f:n})))}:{},{v:e.unref(z)},e.unref(z)?{w:e.f(e.unref(g),((i,n,t)=>e.e({a:e.t(i.name),b:0===i.ycnum},0===i.ycnum?{}:{c:e.t(i.ycnum+"项异常")},{d:"b8232a1d-6-"+t+",b8232a1d-5-"+t,e:"b8232a1d-5-"+t+",b8232a1d-4-"+t,f:e.f(i.er,((i,n,t)=>e.e({a:e.t(i.name),b:j(i.id)},(j(i.id),{}),{c:e.t(i.xznr),d:""===i.xznrcor?"#41AF6F":i.xznrcor,e:e.o((n=>{return t=i.id,void h.value.forEach(((i,n)=>{i.id===t&&e.index.previewImage({current:n,urls:h.value.map((e=>e.url))})}));var t}),n),f:n}))),g:n,h:"b8232a1d-4-"+t+",b8232a1d-3"}))),x:e.p({border:!1}),y:e.p({titleBorder:"none",border:!1})}:{},{z:e.unref(z)},e.unref(z)?{A:e.f(e.unref(o),((i,n,t)=>e.e({a:e.t(i.title),b:0===n},0===n?{c:e.t(i.tips)}:{},{d:e.f(i.items,((i,n,a)=>e.e({a:i.fileList.length>0},i.fileList.length>0?{b:i.image,c:"b8232a1d-7-"+t+"-"+a,d:e.p({fileList:i.fileList,name:"1",multiple:!0,accept:"image",maxCount:1,maxSize:"5242880",width:"0",height:"0",sizeType:["compressed"],previewFullImage:!1,previewFullVideo:!1}),e:e.f(i.fileList,((i,n,t)=>({a:i.url,b:e.t(i.name),c:n,d:e.o((n=>(i=>{const n=o.value.flatMap((e=>e.items.flatMap((e=>e.fileList.map((e=>e.url))))));console.log("data:",o.value),console.log("url:",i);const t=n.indexOf(i);console.log("current:",t),e.index.previewImage({showmenu:!0,current:t,urls:n,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮,第"+(e.index+1)+"张图片")},fail:function(e){console.log(e.errMsg)}}})})(i.url)),n)})))}:{},{f:n}))),e:n})))}:{})}},a=e._export_sfc(t,[["__scopeId","data-v-b8232a1d"]]);wx.createPage(a);
