"use strict";const e=require("../../common/vendor.js"),a=require("../../api/station/station.js");if(!Array){(e.resolveComponent("custom-header")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../components/custom-header/custom-header.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+e.unref(l)+e.unref(n)+e.unref(o))();const o=()=>"./components/staffinfos-warehouse-pannel.js",l=()=>"./components/staffPannel.js",n=()=>"./components/messagePannel.js",u={__name:"staffInfos",setup(o){const l=e.ref(""),n=e.ref(""),u=e.ref("-1"),s=e.ref(""),t=e.ref("新建员工"),i=e.ref(""),r=e.ref(""),c=e.ref(""),f=e.ref(""),p=e.ref(null),d=e.ref(null),v=e.ref(null),g=e.ref(null),m=e.ref(null),x=e.ref(null),w=e.ref(null),h=e.ref(!1),k=()=>{m.value.close(),d.value.close(),g.value.close(),p.value.close()},b=e.ref([]),j=e=>{const a=b.value.indexOf(e);-1===a?b.value.push(e):b.value.splice(a,1)},S=e=>b.value.includes(e),y=e.ref(""),_=e.ref([]),P=e=>{y.value=_.value[e.detail.value],r.value=_.value[e.detail.value].id},R=()=>{h.value=!0,d.value.open()},z=()=>{l.value="配置员工",h.value=!0,g.value.open()},I=()=>{l.value="消息推送",h.value=!0,m.value.open()},E=e.ref(),A=e.ref("-1"),O=e.ref(),C=e.ref(""),D=e=>{console.log("员工数据：",e);const a=e.filter((e=>e.selected)),o=a.map((e=>e.text)),l=a.map((e=>e.ygid));E.value=o.join(","),A.value=l.join(",").replace(/^,/,"")||"-1"},J=e=>{console.log("消息数据：",e);const a=e.filter((e=>e.selected)),o=a.map((e=>e.text)),l=a.map((e=>e.tsid));O.value=o.join(","),C.value=l.join(",").replace(/^,/,"")},N=e=>{console.log("仓库数据：",e);const a=e.filter((e=>e.selected)),o=a.map((e=>e.text)),l=a.map((e=>e.ckid));o.length===e.length?(n.value="全部仓库",u.value="0"):(n.value=o.join(","),u.value=l.join(",").replace(/^,/,"")||"-1")},T=e=>{f.value=e,p.value.close()},q=()=>{e.index.showModal({title:"重置密码",content:"是否重置密码",success:function(e){e.confirm&&(f.value="123456")}})},B=e.ref([]),L=()=>{(async o=>{const l={id:o,username:i.value,phone:s.value.replace(/\s+/g,""),gwid:r.value,ckid:u.value,gzlx:b.value.join(","),opid:JSON.parse(e.index.getStorageSync("userInfo")).opid,password:f.value,contact:c.value.replace(/\s+/g,""),ygid:A.value,tsid:C.value};200===(await a.apiStaffEdit(l)).code&&(e.index.showToast({title:"修改成功",icon:"none"}),e.index.navigateBack())})(W.value)},M=()=>{(async()=>{const o={username:i.value,phone:s.value,gwid:r.value,ckid:u.value,gzlx:b.value.join(","),opid:JSON.parse(e.index.getStorageSync("userInfo")).opid,password:f.value,contact:c.value,ygid:A.value,tsid:C.value},l=await a.apiStaffAdd(o);200===l.code?(e.index.showToast({title:"保存成功",icon:"none"}),e.index.navigateBack()):e.index.showToast({title:l.msg||"操作失败",icon:"none"})})()},W=e.ref();return e.onLoad((o=>{o.forEdit&&(t.value="修改员工",W.value=o.forEdit,(async e=>{const o={ygid:e},l=await a.apiStaffDetail(o);200===l.code&&(i.value=l.infos.username,s.value=l.infos.phone,c.value=l.infos.lxfs,f.value=l.infos.mm,l.infos.gzlx.split(",").forEach((e=>{b.value.push(e)})),x.value.setSelectedStaffs(l.infos.ygidlist),v.value.setSelectedWarehouses(l.infos.ckid),console.log("res:",l),w.value.setSelectedStaffs(l.infos.tslists))})(o.forEdit),r.value=o.gwid),(async()=>{const o={opid:JSON.parse(e.index.getStorageSync("userInfo")).opid},l=await a.apiAdminStationList(o);if(200===l.code&&(B.value=l.lists,l.lists.forEach((e=>{"1"===e.status&&_.value.push({id:e.id,name:e.name})})),r.value)){console.log("gwid:",r.value),console.log("positionArray:",_.value);const e=_.value.findIndex((e=>e.id===r.value.toString()));console.log("selectedIndex:",e),-1!==e&&(y.value=_.value[e])}})()})),(a,o)=>e.e({a:e.t(e.unref(t)),b:e.unref(i),c:e.o((a=>e.isRef(i)?i.value=a.detail.value:null)),d:e.unref(c),e:e.o((a=>e.isRef(c)?c.value=a.detail.value:null)),f:e.unref(W),g:e.unref(s),h:e.o((a=>e.isRef(s)?s.value=a.detail.value:null)),i:e.unref(y).name,j:e.o((a=>e.unref(y).name=a.detail.value)),k:e.unref(_),l:e.o(P),m:e.unref(y),n:e.unref(_),o:e.o(P),p:e.unref(y),q:e.unref(n),r:e.o((a=>e.isRef(n)?n.value=a.detail.value:null)),s:e.o(R),t:e.unref(E),v:e.o((a=>e.isRef(E)?E.value=a.detail.value:null)),w:e.o(z),x:e.unref(O),y:e.o((a=>e.isRef(O)?O.value=a.detail.value:null)),z:e.o(I),A:e.unref(f),B:e.o((a=>e.isRef(f)?f.value=a.detail.value:null)),C:e.o(q),D:e.o(k),E:e.o(T),F:e.p({mode:"input",title:"重置密码","before-close":!0}),G:e.sr(p,"e04d196b-1",{k:"dialogPopup"}),H:e.p({type:"dialog"}),I:e.sr(x,"e04d196b-4,e04d196b-3",{k:"staffPannelRef"}),J:e.o(k),K:e.o(D),L:e.p({title:e.unref(l),workerData:a.workerData}),M:e.sr(g,"e04d196b-3",{k:"staffPannelPopup"}),N:e.o(k),O:e.o(a.change),P:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"}),Q:e.sr(w,"e04d196b-6,e04d196b-5",{k:"messagePannelRef"}),R:e.o(k),S:e.o(J),T:e.sr(m,"e04d196b-5",{k:"messagePannelPopup"}),U:e.o(k),V:e.o(a.change),W:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"}),X:e.sr(v,"e04d196b-8,e04d196b-7",{k:"warehousePannelRef"}),Y:e.o(k),Z:e.o(N),aa:e.sr(d,"e04d196b-7",{k:"warehousePannelPopup"}),ab:e.o(k),ac:e.o(a.change),ad:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"}),ae:S("1")?"https://www.xzxskj.com/xcximg/icon_xuanze_sel@3x.png":"https://www.xzxskj.com/xcximg/icon_moren_nor@3x.png",af:e.o((e=>j("1"))),ag:S("3")?"https://www.xzxskj.com/xcximg/icon_xuanze_sel@3x.png":"https://www.xzxskj.com/xcximg/icon_moren_nor@3x.png",ah:e.o((e=>j("3"))),ai:"新建员工"===e.unref(t)},"新建员工"===e.unref(t)?{aj:e.o(M)}:{ak:e.o(L)})}},s=e._export_sfc(u,[["__scopeId","data-v-e04d196b"]]);wx.createPage(s);
