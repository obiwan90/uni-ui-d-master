"use strict";const e=require("../../common/vendor.js");require("../../stores/tokenStore.js"),require("../../stores/userInfoStore.js");const n=require("../../utils/common.js"),i=require("../../api/qualityCheck/qualityCheck.js");if(!Array){(e.resolveComponent("custom-header")+e.resolveComponent("van-empty")+e.resolveComponent("van-tag")+e.resolveComponent("uv-album")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list")+e.resolveComponent("uni-collapse-item")+e.resolveComponent("uni-collapse")+e.resolveComponent("uv-upload")+e.resolveComponent("uni-popup"))()}const o=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||((()=>"../../components/custom-header/custom-header.js")+a+(()=>"../../uni_modules/uv-album/components/uv-album/uv-album.js")+(()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../uni_modules/uni-list/components/uni-list/uni-list.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse/uni-collapse.js")+(()=>"../../uni_modules/uv-upload/components/uv-upload/uv-upload.js")+e.unref(t)+o)();const t=()=>"./components/listingProductPannel.js",a=()=>"../../uni_modules/qiao-select/components/qiao-select/qiaoSelect.js",s={__name:"listingProduct",setup(o){const t=e.getCurrentInstance(),a=e.ref(!0),s=e.ref([{title:"上传图片",tips:"* 机身背面为封面图",items:[{text:"机身背面",image:"https://www.xzxskj.com/xcximg/img_add_img@3x.png",fileList:[]},{text:"屏幕息屏",image:"https://www.xzxskj.com/xcximg/img_add_closewindow@3x.png",fileList:[]},{text:"关于本机",image:"https://www.xzxskj.com/xcximg/img_add_about@3x.png",fileList:[]}]},{title:"中框四面",items:[{text:"中框上方",image:"https://www.xzxskj.com/xcximg/img_add_upward@3x.png",fileList:[]},{text:"中框右侧",image:"https://www.xzxskj.com/xcximg/img_add_right@3x.png",fileList:[]},{text:"中框下方",image:"https://www.xzxskj.com/xcximg/img_add_downward@3x.png",fileList:[]},{text:"中框左侧",image:"https://www.xzxskj.com/xcximg/img_add_left@3x.png",fileList:[]}]},{title:"机身四角",items:[{text:"左上角",image:"https://www.xzxskj.com/xcximg/img_add_lefttop@3x.png",fileList:[]},{text:"右上角",image:"https://www.xzxskj.com/xcximg/img_add_righttop@3x.png",fileList:[]},{text:"右下角",image:"https://www.xzxskj.com/xcximg/img_add_rightdown@3x.png",fileList:[]},{text:"左下角",image:"https://www.xzxskj.com/xcximg/img_add_leftdown@3x.png",fileList:[]}]}]),l=e.ref(null),u=async()=>{r();try{const e=await n.scanCode();console.log("result",e),e&&d(e).then((()=>{b.value.length>0&&(l.value.inputText=b.value[0].ch)}))}catch(e){console.error("扫码失败：",e)}finally{c()}},r=()=>{e.index.showLoading({title:"加载中...",mask:!0})},c=()=>{e.index.hideLoading()},m=e.ref(!1),p=e.ref("ch"),f=e.ref("ch"),d=n=>{n.length>0&&(e.index.showLoading({title:"加载中....",mask:!0}),console.log("inputText",n),q(n),e.index.hideLoading())},g=i=>{console.log("e:",i),m.value=!1,e.index.showModal({content:"退出质检流程再次质检根据串号搜索",showCancel:!0,success:e=>{e.cancel?m.value=!0:(console.log("用户点击了确认"),n.navigateToPage("pagesCustomMine/customMine/customMine"))}})},v=e.ref(!1),x=e.ref(null),h=()=>{console.log("Popup is closed"),x.value.close()},w=e=>{e.show||(v.value=e.show)},j=e.ref(""),b=e.ref([]),z=e=>{if(console.log("selectChange:",e),s.value.forEach((e=>{e.items.forEach((e=>{e.fileList=[]}))})),s.value=[...s.value],e){console.log("selectChange e:",e);const{name:i,ch:o,machinetime:t,jkuidname:a,id:s,functionaltime:l,gnjcuidname:u,servicetime:r,serviceuidname:c,price:m,special:p,finenessname:f,csbz:d,jkbz:g,gnjcbz:v,wxjcbz:x,pzbz:h,cgyname:w,productimage:b}=e;J.value={spname:i,imei:o,inputTime:n.formatTimestamp(t),inputPerson:a,funcInputTime:n.formatTimestamp(l),funcInputPerson:u,maintenanceInputTime:n.formatTimestamp(r),maintenanceInputPerson:c,zjid:s,finenessname:f,cgyname:w},console.log("Received data:",J.value),j.value=g+" "+v+" "+x+" "+h+" "+d,y.value=m,_.value=1==p,D()}},y=e.ref(),_=e.ref(!1),k=()=>{_.value=!_.value},C=e.ref([]),L=e.ref(),I=e.ref(),P=e.ref([]),S=e.computed((()=>P.value.some((e=>e.ycnum>0)))),T=()=>{y.value?(J.value.price=y.value,J.value.sftj=_.value?1:0,console.log("receivedData",J.value),"QC"!==N.value?(v.value=!0,x.value.open()):e.index.showToast({title:"提交成功",icon:"none",duration:2e3})):e.index.showToast({title:"请输入定价金额",icon:"none",duration:2e3})},q=async n=>{const o={opid:e.index.getStorageSync("sessionInfo").opid,ch:n},t=await i.apiQualityCheckSerialSearch(o);if(200===t.code)return t.lists=t.lists.filter((e=>""!==e.productimage)),b.value=t.lists?t.lists:[]},F=e.ref(),E=e.ref(),M=e.ref(),R=e.ref([]),D=async()=>{s.value.forEach((e=>{e.items.forEach((e=>{e.fileList=[]}))}));const e={id:J.value.zjid},n=await i.apiQualityCheckInfo(e);if("200"===n.code){console.log("Quality check info:",n),L.value=n.infos;new Date(L.value.bxsj);F.value=L.value.jbztycbg?JSON.parse(L.value.jbztycbg):[],E.value=L.value.gnjcycbg?JSON.parse(L.value.gnjcycbg):[],M.value=L.value.wxjcycbg?JSON.parse(L.value.wxjcycbg):[],R.value=[...F.value.map((e=>({id:e.id,url:e.url}))),...E.value.map((e=>({id:e.id,url:e.url}))),...M.value.map((e=>({id:e.id,url:e.url})))];(()=>{const e=new Date;e.setHours(0,0,0,0)})();P.value=n.infos.qualityinspection,P.value.forEach((e=>{e.er.forEach((e=>{"保修截止"===e.name&&(e.xznr=L.value.bxsj,e.xznrcor="",e.xznrcor="black")}))}));const e=n.infos.productimage;if(e){const n=e.split(",");let i=0;s.value.forEach((e=>{e.items.forEach((e=>{i<n.length&&(e.fileList.push({url:n[i],name:e.text}),i++)}))}))}console.log("qualityinspection:",P.value),I.value=n.yjinfos,L.value.combinationid.push(I.value.qminfos),L.value.combinationname.push(I.value.name),L.value.combinationyslist.push(I.value.color);const i=L.value.yjxsimg.split(","),o=L.value.jswgimg.split(","),t=L.value.pmwgimg.split(",");C.value=[{imgs:o},{imgs:t},{imgs:i}],console.log("urls:",C.value[0].imgs)}},O=e=>!!R.value.find((n=>n.id===e)),J=e.ref(null);e.index.$on("listingProductRefresh",(()=>{J.value=null,b.value=[]}));const N=e.ref(""),Q=e.ref(null);return e.onLoad((e=>{if(e.data)try{m.value=!0,J.value=JSON.parse(decodeURIComponent(e.data)),j.value=J.value.jkbz+" "+J.value.gnjcbz+" "+J.value.wxjcbz+" "+J.value.pzbz+" "+J.value.csbz,console.log("Received data:",J.value),D(),_.value=S}catch(n){console.error("Failed to parse received data:",n)}e.ch&&(Q.value=e.ch,q(e.ch).then((e=>{z(e[0])}))),e.from&&(N.value=e.from)})),e.index.$on("naviInit",(()=>{console.log("跳转重置"),m.value=!1})),(n,i)=>e.e({a:e.unref(m)},e.unref(m)?e.e({b:e.unref(a)},e.unref(a)?{c:e.unref(m),d:e.o(g)}:{}):{},{e:e.p({backgroundColor:"#F3F2F6"}),f:e.sr(l,"36866ed7-1",{k:"searchInputRef"}),g:e.o(d),h:e.o(z),i:e.p({keyId:11,dataList:e.unref(b),phText:"请输入串号",searchKey:e.unref(p),showBorder:!1,disabled:!1,showField:e.unref(f)}),j:e.o(u),k:!e.unref(J)},e.unref(J)?{}:{l:e.p({description:"请搜索相关商品进行拍照"})},{m:e.unref(J)},e.unref(J)?e.e({n:e.unref(J).finenessname},e.unref(J).finenessname?{o:e.t(e.unref(J).finenessname),p:e.p({size:"mini",color:"linear-gradient(132deg, #D94C24 0%, #FF5221 100%)"})}:{},{q:e.t(e.unref(J).spname),r:e.t(e.unref(J).imei),s:e.o((n=>e.unref(t).proxy.copyText(e.unref(J).imei))),t:e.t(e.unref(J).cgyname),v:e.t(e.unref(J).inputPerson),w:e.t(e.unref(J).funcInputPerson),x:e.t(e.unref(J).maintenanceInputPerson),y:e.t(e.unref(j))}):{},{z:e.unref(J)},e.unref(J)?e.e({A:e.unref(S)},(e.unref(S),{}),{B:e.unref(y),C:e.o((n=>e.isRef(y)?y.value=n.detail.value:null)),D:e.unref(_)?"https://www.xzxskj.com/xcximg/icon_xuanze_sel@3x.png":"https://www.xzxskj.com/xcximg/icon_moren_nor@3x.png",E:e.o(k)}):{},{F:e.unref(J)},e.unref(J)?{G:e.f(e.unref(L).combinationid,((n,i,o)=>({a:e.t(n),b:e.t(e.unref(L).combinationname[i]),c:e.unref(L).combinationyslist[i],d:"36866ed7-4-"+o,e:e.p({urls:e.unref(C)[i].imgs,maxCount:"2",rowCount:"2",multipleSize:"48rpx",singleSize:"48rpx",space:"8rpx"}),f:i})))}:{},{H:e.unref(J)},e.unref(J)?{I:e.f(e.unref(P),((n,i,o)=>e.e({a:e.t(n.name),b:0===n.ycnum},0===n.ycnum?{}:{c:e.t(n.ycnum+"项异常")},{d:"36866ed7-8-"+o+",36866ed7-7-"+o,e:"36866ed7-7-"+o+",36866ed7-6-"+o,f:e.f(n.er,((n,i,o)=>e.e({a:e.t(n.name),b:O(n.id)},(O(n.id),{}),{c:e.t(n.xznr),d:""===n.xznrcor?"#41AF6F":n.xznrcor,e:e.o((i=>{return o=n.id,void R.value.forEach(((n,i)=>{n.id===o&&e.index.previewImage({current:i,urls:R.value.map((e=>e.url))})}));var o}),i),f:i}))),g:i,h:"36866ed7-6-"+o+",36866ed7-5"}))),J:e.p({border:!1}),K:e.p({titleBorder:"none",border:!1})}:{},{L:e.unref(J)},e.unref(J)?{M:e.f(e.unref(s),((n,i,o)=>e.e({a:e.t(n.title),b:0===i},0===i?{c:e.t(n.tips)}:{},{d:e.f(n.items,((n,i,t)=>({a:n.image,b:"36866ed7-9-"+o+"-"+t,c:e.p({fileList:n.fileList,name:"1",multiple:!0,accept:"image",maxCount:1,maxSize:"5242880",width:"0",height:"0",sizeType:["compressed"],previewFullImage:!1,previewFullVideo:!1}),d:e.f(n.fileList,((n,i,o)=>({a:n.url,b:e.t(n.name),c:i,d:e.o((i=>(n=>{const i=s.value.flatMap((e=>e.items.flatMap((e=>e.fileList.map((e=>e.url))))));console.log("data:",s.value),console.log("url:",n);const o=i.indexOf(n);console.log("current:",o),e.index.previewImage({showmenu:!0,current:o,urls:i,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮,第"+(e.index+1)+"张图片")},fail:function(e){console.log(e.errMsg)}}})})(n.url)),i)}))),e:i}))),e:i})))}:{},{N:e.unref(J)},(e.unref(J),{}),{O:e.unref(J)},e.unref(J)?{P:e.o(T)}:{},{Q:e.unref(v)},e.unref(v)?{R:e.o(h),S:e.p({receivedData:e.unref(J)})}:{},{T:e.sr(x,"36866ed7-10",{k:"pannelPopup"}),U:e.o(h),V:e.o(w),W:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"center"})})}},l=e._export_sfc(s,[["__scopeId","data-v-36866ed7"]]);wx.createPage(l);
