"use strict";const e=require("../common/vendor.js"),n=require("../api/login/loginApi.js"),o=e.defineStore("token",{state:()=>({timeStamp:0,randomStr:"",signature:"",opid:"",session_key:"",phone:""}),actions:{updateToken(n){Object.assign(this,n),e.index.setStorageSync("tokenInfo",n)},async getToken(){try{const e=await n.apiGetToken();return console.log("token res:",e),this.updateToken(e),e}catch(e){throw console.error("获取 token 失败:",e),new Error("Token acquisition failed")}},isTokenSet(){return this.timeStamp&&this.randomStr&&this.signature},async getSession(){try{const o=await new Promise(((n,o)=>{e.index.login({provider:"weixin",success:n,fail:o})})),t=(await this.getToken(),await n.apiLogin({code:o.code}));return this.setLoginSession(t),t}catch(o){throw console.error("获取 session 失败:",o),new Error("Session acquisition failed")}},setLoginSession(n){Object.assign(this,n),e.index.setStorageSync("sessionInfo",n)},getPhone(){return this.phone=this.phone||e.index.getStorageSync("phone"),this.phone},setPhone(n){this.phone=n,e.index.setStorageSync("phone",n)}}});exports.useTokenStore=o;
