"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/common.js"),a=require("../../utils/system.js"),u=require("../api/api.js"),n=require("../../api/station/station.js"),l=require("../../stores/menuPermissionStore.js");if(!Array){(e.resolveComponent("van-dropdown-item")+e.resolveComponent("van-dropdown-menu")+e.resolveComponent("z-paging")+e.resolveComponent("van-progress")+e.resolveComponent("van-loading")+e.resolveComponent("van-image")+e.resolveComponent("van-tag"))()}Math;const r={__name:"dataCenter",setup(r){const o=l.usePermissionStore(),i=e.computed((()=>"1"===K.value?"库存分析":"2"===K.value?"品牌数据":"3"===K.value?"型号数据":"4"===K.value?"内存数据":"5"===K.value?"全称数据":"商品列表")),v=e.ref(null),c=e.ref(null),s=e.ref([]),d=e.ref([]);e.ref(!0);const f=e=>{const t=w.value?J.value.totalNum:J.value.totalPrice,a=w.value?e.num:e.price?e.price:0;return t>0?(a/t*100).toFixed(0):0},p=async(e,t)=>{console.log("pageNo:",e),console.log("pageSize:",t),await W(P.value),console.log("dataCenterFilter",x.value),v.value.complete(x.value)},x=e.computed((()=>G.value.filter((e=>!e.menuAuthority||o.hasMenuAuthority(e.menuAuthority))))),g=e.ref(),m=async(e,t)=>{console.log("pageNo:",e),console.log("pageSize:",t),g.value=e-1;const a=await Y();c.value.complete(a)},h=e.ref(0),y=e.ref(["数据分析","库存分析"]),S=e.ref([]),D=e.ref([{text:"全部采购",value:-1}]),C=e.ref(-1),j=e.ref(-1),k=e=>{C.value=e.detail,c.value.reload(!0)},F=e=>{j.value=e.detail,c.value.reload(!0)},w=e.ref(!1),A=()=>{w.value=!w.value},P=e.ref(0),b=e.ref(["今日","昨日","本月","上月","时间区间"]),q=e.computed((()=>b.value.filter(((e,t)=>4!==t)))),z=e.ref("时间区间"),I=e.ref("开始时间"),B=e.ref("截止时间"),T=e.ref(),N=e.ref(),_=e=>{console.log(e),I.value=e.detail.value,T.value=t.toBeijingTimestamp(e.detail.value)},E=e=>{console.log(e),B.value=e.detail.value,N.value=t.toBeijingTimestamp(e.detail.value)},H=e.ref(!1),L=e.ref(!1),M=()=>{L.value=!L.value,H.value=!0,P.value=4},R=()=>{L.value=!1,H.value=!1,v.value.reload(!0)},V=()=>{I.value="开始时间",B.value="截止时间",T.value="",N.value=""},G=e.ref([]),W=async t=>{const a={lx:t+1,opid:e.index.getStorageSync("sessionInfo").opid,startTime:P.value+1===5?T.value:"",endTime:P.value+1===5?N.value:""},n=await u.apiDataAnalysis(a);console.log("res:",n),G.value=[{text:"销售数据",menuAuthority:"saleData",values:[{text:"销售台数(台)",count:n.xsnum},{text:"销售金额(元)",count:n.xsprice},{text:"售后退货(台)",count:n.shnum},{text:"售后退货(元)",count:n.shprice},{text:"线下销售(台)",count:n.xxnum},{text:"线下销售(元)",count:n.xxprice},{text:"平台销售(台)",count:n.ptnum},{text:"平台销售(元)",count:n.ptprice}],path:"/pagesDataCenterDetail/dataCenterDetail/dataCenterDetail?title=销售数据"},{text:"商品数据",menuAuthority:"productData",values:[{text:"商品录入",count:n.splrcount},{text:"功能检测",count:n.gnjccount},{text:"维修检测",count:n.wxjccount},{text:"拍照",count:n.pzcount},{text:"成色判断",count:n.cscount},{text:"定价上架",count:n.djcount},{text:"临时下架",count:n.lsxjcount},{text:"退出库存",count:n.tcckcount}],path:"/pagesDataCenterProductData/dataCenterProductData/dataCenterProductData"},{text:"先货后款",menuAuthority:"fpbkData",values:[{text:"先货后款(台)",count:n.xhhknum},{text:"先货后款(元)",count:n.xhhkprice},{text:"欠款已收(台)",count:n.xhhkysnum},{text:"欠款已收(元)",count:n.xhhkysprice},{text:"欠款已退(台)",count:n.xhhkytnum},{text:"退货上架(台)",count:n.xhhkythsjnum},{text:"退货下架(台)",count:n.xhhkythxjnum},{text:"退出库存(台)",count:n.xhhkytcknum}],path:"/pagesDataCenterDetail/dataCenterDetail/dataCenterDetail?title=先货后款"},{text:"议价数据",menuAuthority:"yjData",values:[{text:"议价商品(台)",count:n.yjzts},{text:"成功议价(台)",count:n.yjcgnum},{text:"驳回议价(台)",count:n.yjsbnum},{text:"议价成功(元)",count:n.yjcgprice}],path:"/pagesDataCenterDetail/dataCenterDetail/dataCenterDetail?title=议价数据"}]},J=e.ref({totalNum:0,totalPrice:0}),K=e.ref("1"),O=e.ref(""),Q=e.ref(""),U=e.ref(""),X=e.ref(""),$=e.ref(""),Y=async()=>{const e={ckid:-1===C.value?"":String(C.value),cgid:-1===j.value?"":String(j.value),start:g.value,ymdj:K.value,flid:O.value,ppid:Q.value,xhid:U.value,ncid:X.value,qcid:$.value},t=await u.apiStockAnalysis(e);return console.log("res:",t),1===t.zt&&(J.value.totalNum=t.num,J.value.totalPrice=t.price,t.yglist&&t.yglist.length>0&&t.yglist.forEach((e=>{D.value.find((t=>t.value===parseInt(e.id)))||D.value.push({text:e.username,value:parseInt(e.id)}),D.value=[...D.value]}))),1===t.zt?t.lists:[]},Z=()=>{if(console.log("customLeftFn"),"1"!==K.value){g.value="1",K.value=String(parseInt(K.value)-1);const t=e.index.getStorageSync("selectedDataCenterData"),{flid:a,ppid:u,xhid:n,ncid:l,qcid:r}=t.pop();O.value=a,Q.value=u,U.value=n,X.value=l,$.value=r,e.index.setStorageSync("selectedDataCenterData",t),y.value="1"===K.value?["数据分析","库存分析"]:"2"===K.value||"3"===K.value?[item.name]:"4"===K.value?["内存数据"]:"5"===K.value?["全称数据"]:["商品列表"],"1"===K.value?O.value="":"2"===K.value?Q.value="":"3"===K.value?U.value="":"4"===K.value?X.value="":"5"===K.value&&($.value=""),c.value.reload(!0)}else e.index.removeStorageSync("selectedDataCenterData"),e.index.navigateBack()};return e.onLoad((()=>{(async()=>{const t={opid:e.index.getStorageSync("sessionInfo").opid},a=await n.apiAdminGetStore(t);200===a.code&&(console.log("仓库 res:",a),S.value.push({text:"全部仓库",value:-1}),a.lists.forEach((e=>{const{name:t,id:a}=e;S.value.push({text:t,value:parseInt(a)})})))})()})),(t,u)=>e.e({a:e.unref(a.getStatusBarHeight)()+"px",b:e.o(Z),c:e.f(e.unref(y),((t,a,u)=>({a:e.t(t),b:e.o((t=>(t=>{h.value=t,e.nextTick$1((()=>{}))})(a)),a),c:e.unref(h)===a?1:"",d:a}))),d:e.unref(a.getTitleBarHeight)()+"px",e:e.unref(a.getLeftIconLeft)()+"px",f:0===e.unref(h)},0===e.unref(h)?{g:e.f(q.value,((t,a,u)=>({a:e.t(t),b:e.o((e=>(e=>{P.value=e,L.value=!1,H.value=!1,5!==P.value&&v.value.reload(!0)})(a)),a),c:e.unref(P)===a?1:"",d:a}))),h:e.t(e.unref(z)),i:e.o(M),j:4===e.unref(P)?1:"",k:e.t(e.unref(I)),l:e.o(_),m:e.unref(I),n:e.t(e.unref(B)),o:e.o(E),p:e.unref(B),q:e.o(V),r:e.o(R),s:e.unref(L),t:e.unref(L)?1:""}:{},{v:1===e.unref(h)},1===e.unref(h)?{w:e.o(k),x:e.p({value:e.unref(C),options:e.unref(S),popupStyle:"border-radius: 0 0 20rpx 20rpx;"}),y:e.o(F),z:e.p({value:e.unref(j),options:e.unref(D),popupStyle:"border-radius: 0 0 20rpx 20rpx;"}),A:e.p({zIndex:"20",activeColor:"#EB4636"})}:{},{B:e.unref(a.getStatusBarHeight)()+e.unref(a.getTitleBarHeight)()+60+"px",C:0===e.unref(h)},0===e.unref(h)?{D:e.f(e.unref(s),((t,a,u)=>({a:e.t(t.text),b:e.o((a=>{return u=t.path,void e.index.navigateTo({url:u});var u}),a),c:e.f(t.values,((t,a,u)=>({a:e.t(t.count),b:e.t(t.text),c:a}))),d:a}))),E:e.sr(v,"84928cfd-3",{k:"paging"}),F:e.o(p),G:e.o((t=>e.isRef(s)?s.value=t:null)),H:e.p({"show-refresher-update-time":!0,fixed:!1,modelValue:e.unref(s)})}:e.e({I:e.t(i.value),J:"6"!==e.unref(K)},"6"!==e.unref(K)?{K:e.unref(w)?1:"",L:e.o(A)}:{},{M:e.t(e.unref(J).totalNum),N:e.t(e.unref(J).totalPrice),O:"6"!==e.unref(K)},"6"!==e.unref(K)?{P:e.f(e.unref(d),((t,a,u)=>({a:e.t(t.name),b:e.t(f(t)),c:"84928cfd-5-"+u+",84928cfd-4",d:e.p({trackColor:"#F8F8F8",color:"linear-gradient( 90deg, #7EBFFF 0%, #4079FF 100%)",showPivot:!1,percentage:f(t),strokeWidth:"12"}),e:e.t(e.unref(w)?t.num:t.price),f:e.o((a=>(t=>{console.log("item:",t),g.value=0,K.value=String(parseInt(K.value)+1),O.value=String(t.id),y.value="1"===K.value?["数据分析","库存分析"]:"2"===K.value||"3"===K.value?[t.name]:"4"===K.value?["内存数据"]:"5"===K.value?["全称数据"]:["商品列表"],"2"===K.value?O.value=String(t.id):"3"===K.value?Q.value=String(t.id):"4"===K.value?U.value=String(t.id):"5"===K.value?X.value=String(t.id):$.value=String(t.id);const a=e.index.getStorageSync("selectedDataCenterData");a?(a.push({flid:O.value,ppid:Q.value,xhid:U.value,ncid:X.value,qcid:$.value}),e.index.setStorageSync("selectedDataCenterData",a)):(console.log("set"),e.index.setStorageSync("selectedDataCenterData",[{flid:O.value,ppid:Q.value,xhid:U.value,ncid:X.value,qcid:$.value}])),c.value.reload(!0)})(t)),a),g:a}))),Q:e.t(e.unref(w)?"台":"元")}:{R:e.f(e.unref(s),((t,a,u)=>({a:"84928cfd-7-"+u+",84928cfd-6-"+u,b:"84928cfd-6-"+u+",84928cfd-4",c:e.p({width:"95",height:"95",fit:"widthFix",radius:"18rpx",src:t.cover,mode:"aspectFit"}),d:e.t(t.finenessname),e:"84928cfd-8-"+u+",84928cfd-4",f:e.t(t.name),g:e.t(t.ch),h:e.t(t.cgyname),i:e.t(t.ckame),j:e.t(t.price),k:a}))),S:e.p({type:"spinner",size:"20",vertical:!0}),T:e.p({size:"mini",color:"linear-gradient( 132deg, #D94C24 0%, #FF5221 100%)"})},{U:e.sr(c,"84928cfd-4",{k:"paging1"}),V:e.o(m),W:e.o((t=>e.isRef(d)?d.value=t:null)),X:e.p({"show-refresher-update-time":!0,fixed:!1,modelValue:e.unref(d)})}))}},o=e._export_sfc(r,[["__scopeId","data-v-84928cfd"]]);wx.createPage(o);
