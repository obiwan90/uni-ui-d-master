"use strict";const e=require("../../common/vendor.js"),o=require("../api/api.js"),n=require("../../api/warehouseManagement/warehouseManagement.js"),a=require("../../utils/common.js");if(!Array){(e.resolveComponent("custom-header")+e.resolveComponent("van-empty")+e.resolveComponent("van-loading")+e.resolveComponent("van-image")+e.resolveComponent("van-tag")+e.resolveComponent("van-swipe-cell")+e.resolveComponent("uni-popup"))()}const s=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||((()=>"../../components/custom-header/custom-header.js")+t+e.unref(l)+s)();const t=()=>"../../uni_modules/qiao-select/components/qiao-select/qiaoSelect.js",l=()=>"./components/selectedInventory.js",c={__name:"movingInventory",setup(s){const t=e.getCurrentInstance(),l=e.ref("ch"),c=e.ref("ch"),r=e.ref(null),i=e.ref([]),u=e.ref();e.computed((()=>i.value.reduce(((e,o)=>e+parseFloat(o.price)||0),0))),e.ref("");const d=e.ref(!1),p=e.ref(null),f=()=>{console.log("Popup is closed"),p.value.close()},v=e=>{e.show||(d.value=e.show)};e.ref();const h=e.ref([]);e.ref("");e.ref("");const m=e.ref([]),g=e=>{console.log("输入框内容:",e),e.length>0&&w(e)},y=e=>{if(console.log("模糊搜索 e",e),e){i.value.some((o=>o.id===e.id))||i.value.push(e)}r.value.clearData(),m.value=[]},C=e.ref([]),w=async n=>{const a={ch:n,opid:e.index.getStorageSync("sessionInfo").opid},s=await o.apiFinanceChCheck(a);200===s.code?(m.value=s.lists,C.value=s.yglist,h.value=s.yglist):m.value=[],console.log("apiFinanceChCheckData res:",s)},x=async n=>{const{ch:a}=n.goodsinfos,s=await o.apiFinanceChCheck({ch:a,opid:e.index.getStorageSync("sessionInfo").opid});200===s.code&&s.yglist.length>0&&h.value.push(...s.yglist.filter((e=>!h.value.some((o=>e.id===o.id))))),i.value.push(n.goodsinfos)},k=e.ref(""),j=e.ref("请选择"),I=e=>{console.log("selectedOptions",e),k.value=e[0],q.value.forEach((e=>{e.id===k.value&&(j.value=e.name)}))},q=e.ref([]),L=async()=>{S();try{const e=await a.scanCode();console.log("result",e),e&&g(e).then((()=>{m.value.length>0&&(r.value.inputText=m.value[0].ch)}))}catch(e){console.error("扫码失败：",e)}finally{_()}},S=()=>{e.index.showLoading({title:"加载中...",mask:!0})},_=()=>{e.index.hideLoading()},b=async()=>{console.log("cardData",i.value);const o=i.value.map((e=>e.zjid)).join(",");console.log("zjids",o),await(async o=>{const a={zjid:o,ckid:k.value},s=await n.apiWarehouseMove(a);200===s.code&&(e.index.showToast({title:"移库成功",icon:"success",duration:2e3}),i.value=[]),console.log("res:",s)})(o)};return e.onLoad((async e=>{if(e.settlementList&&e.lx){const o=JSON.parse(decodeURIComponent(e.settlementList));console.log("options.settlementList:",o),console.log("options.lx:",e.lx),o.forEach(x)}e.data&&(i.value.push(JSON.parse(decodeURIComponent(e.data))),console.log("cardData",i.value),w(JSON.parse(decodeURIComponent(e.data)).ch)),await(async()=>{const e=await n.apiWarehouseList();200===e.code&&(q.value=e.lists)})()})),e.index.$on("selectedCustomer",(e=>{console.log("selectedCustomer",e),u.value=e})),(o,n)=>e.e({a:e.p({backgroundColor:"#f3f2f6"}),b:e.sr(r,"737dce36-1",{k:"myInputRef"}),c:e.o(g),d:e.o(y),e:e.p({keyId:1,dataList:e.unref(m),phText:"请输入串号",searchKey:"name",showBorder:!1,disabled:!1,searchKey:e.unref(l),showField:e.unref(c)}),f:e.o(L),g:0==e.unref(i).length},0==e.unref(i).length?{h:e.p({description:"请搜索相关商品进行批发"})}:{},{i:e.unref(i).length>0},e.unref(i).length>0?{j:e.f(e.unref(i),((o,n,a)=>e.e({a:"737dce36-5-"+a+",737dce36-4-"+a,b:"737dce36-4-"+a+",737dce36-3-"+a,c:e.p({width:"95",height:"95",fit:"fill",radius:"18rpx",src:o.cover}),d:o.finenessname},o.finenessname?{e:e.t(o.finenessname),f:"737dce36-6-"+a+",737dce36-3-"+a,g:e.p({size:"medium",color:"linear-gradient( 132deg, #D94C24 0%, #FF5221 100%)"})}:{},{h:e.t(o.name),i:e.t(o.ch),j:e.o((n=>e.unref(t).proxy.copyText(o.ch)),n),k:e.t(o.cgyname),l:e.t(o.ckname),m:e.t(o.price),n:e.o((e=>(async e=>{i.value.splice(e,1)})(n)),n),o:"737dce36-3-"+a,p:n}))),k:e.p({type:"spinner",size:"20",vertical:!0}),l:e.p({rightWidth:"41"})}:{},{m:e.unref(i).length>0},e.unref(i).length>0?{n:e.t(e.unref(i).length),o:e.t(e.unref(j)),p:e.unref(q),q:e.o((e=>{return n=e,o.item,console.log("选择 e:",n),console.log("选择",q.value),j.value=q.value[n.detail.value].name,void(k.value=q.value[n.detail.value].id);var n})),r:e.unref(j),s:e.o(b)}:{},{t:e.unref(d)},e.unref(d)?{v:e.o(f),w:e.o(I),x:e.p({cklist:e.unref(q)})}:{},{y:e.sr(p,"737dce36-7",{k:"selectCustomerPannelPopup"}),z:e.o(f),A:e.o(v),B:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"})})}},r=e._export_sfc(c,[["__scopeId","data-v-737dce36"]]);wx.createPage(r);
