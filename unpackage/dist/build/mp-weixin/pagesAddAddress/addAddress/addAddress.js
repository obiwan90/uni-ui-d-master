"use strict";const e=require("../../common/vendor.js"),a=require("../../api/address/address.js"),o=require("../../stores/locationStore.js");if(!Array){e.resolveComponent("custom-header")()}Math;const i={__name:"addAddress",setup(i){o.useLocationStore();const t=e.ref(),n=e.ref("新建地址"),u=e.ref([{id:"1",key:"收件人姓名",value:""},{id:"2",key:"联系人电话",value:""},{id:"3",key:"所在地区",value:"请选择"}]),d=e.ref({fullLocation:"",province:"",city:"",region:"",address:"",postCode:"",longitude:"",latitude:"",name:""}),r=requirePlugin("chooseLocation"),l=()=>{const a=JSON.stringify({latitude:d.value.latitude,longitude:d.value.longitude});e.index.navigateTo({url:`plugin://chooseLocation/index?key=KJXBZ-NOQR4-A4CUH-KEJWI-F25M6-REFWO&referer=demo2&location=${a}&category=生活服务,娱乐休闲`})},s=e=>{f.value.zt=e.detail.value?"1":"0"},c=()=>{e.index.showModal({title:"确认修改地址簿？",success:e=>{e.confirm&&v()}})},v=async()=>{const o=e.index.getStorageSync("addressList");if("1"===f.value.zt){if(o.some((e=>"1"===e.zt)))return void e.index.showModal({title:"提示",content:"已经拥有默认地址了",showCancel:!1})}const i={id:f.value.id,opid:e.index.getStorageSync("sessionInfo").opid,name:u.value[0].value,phone:u.value[1].value,province:d.value.province,city:d.value.city,area:d.value.region,address:d.value.address,zt:f.value.zt};"200"===(await a.apiAddAddress(i)).code&&(e.index.showToast({title:"修改成功",icon:"success",duration:2e3}),e.index.navigateBack())},f=e.ref();return e.onMounted((async()=>{d.value=await o.useLocationStore().getForm()})),e.onLoad((e=>{e.id&&(t.value=e.id,n.value="修改地址",(async e=>{const o={id:e},i=await a.apigetAddressDetail(o);f.value=i.info,d.value.address=i.info.address,d.value.province=i.info.province,d.value.city=i.info.city,d.value.region=i.info.area,u.value[0].value=i.info.name,u.value[1].value=i.info.phone,u.value[2].value=i.info.province+" "+i.info.city+" "+i.info.area})(e.id))})),e.onShow((()=>{const e=r.getLocation();if(e){d.value.address=e.address,d.value.province=e.province,d.value.city=e.city,d.value.region=e.district,d.value.latitude=e.latitude.toString(),d.value.longitude=e.longitude.toString();const a=[e.province,e.city,e.district];d.value.fullLocation=a.join(" "),d.value.name=e.name,u.value[2].value=d.value.fullLocation}})),(a,o)=>e.e({a:e.unref(f)},e.unref(f)?{b:e.t(e.unref(n)),c:e.f(e.unref(u),((a,o,i)=>e.e({a:e.t(a.key),b:"所在地区"!==a.key},"所在地区"!==a.key?{c:a.value,d:e.o((e=>a.value=e.detail.value),o)}:{e:e.t(a.value),f:e.o(l,o)},{g:"所在地区"===a.key},"所在地区"===a.key?{h:e.o(l,o)}:{},{i:o}))),d:e.unref(d).address,e:e.o((a=>e.unref(d).address=a.detail.value)),f:"1"===e.unref(f).zt,g:e.o(s),h:e.o(c)}:{})}},t=e._export_sfc(i,[["__scopeId","data-v-de031068"]]);wx.createPage(t);
