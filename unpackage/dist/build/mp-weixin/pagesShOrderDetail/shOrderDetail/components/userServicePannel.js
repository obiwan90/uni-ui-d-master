"use strict";const e=require("../../../common/vendor.js"),t=require("../../api/api.js");if(!Array){e.resolveComponent("uni-datetime-picker")()}Math;const o={__name:"userServicePannel",props:{infos:{type:Object,default:{}}},emits:["close","successAc"],setup(o,{emit:s}){const n=o,a=s,r=e.ref([]),l=e.ref(null),i=async()=>{if(l.value)r.value=[l.value];else{const o={opid:e.index.getStorageSync("sessionInfo").opid},s=await t.apigetAddress(o);s.lists&&s.lists.length>0?(r.value=s.lists.filter((e=>"1"===e.zt)),console.log("addressList1:",r.value)):r.value=[],console.log("addressList2:",r.value)}},u=e.ref((new Date).toISOString().split("T")[0]),c=e.ref("请选择时间"),d=e.ref("1"),f=e.ref(["08:00:00-09:00:00","09:00:00-10:00:00","10:00:00-11:00:00","11:00:00-12:00:00","12:00:00-13:00:00","13:00:00-14:00:00","14:00:00-15:00:00","15:00:00-16:00:00","16:00:00-17:00:00","17:00:00-18:00:00","18:00:00-19:00:00"]),v=()=>{const e=(()=>{const e=new Date;return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`})(),t=f.value.filter((t=>{const[o,s]=t.split("-");return e>=o&&e<=s}));if(0===t.length)return f.value;const o=f.value.indexOf(t[0]);return f.value.slice(o)},g=e=>{d.value=e},p=e=>{console.log("选择的日期:",e),u.value=e},h=e=>{const t=v();console.log("选择的时间范围:",t[e.detail.value]),c.value=t[e.detail.value]},w=async()=>{"1"!==d.value||"请选择日期"!==u.value?"1"!==d.value||"请选择时间"!==c.value?(console.log("提交日期：",u.value),console.log("提交时间范围：",c.value),console.log("邮寄方式：",d.value),await S()):e.index.showToast({title:"请选择上门时间范围",icon:"none"}):e.index.showToast({title:"请选择上门日期",icon:"none"})},S=async()=>{const o={lx:"2",id:n.infos.id,thfs:d.value,thdz:r.value[0].id,qjrq:"1"===d.value?u.value:"",qjsj:"1"===d.value?c.value:""};try{200===(await t.apiBookingExpress(o)).code?(e.index.showToast({title:"操作成功",icon:"success",duration:500}),setTimeout((()=>{a("close"),a("successAc",n.infos)}),500)):e.index.showToast({title:"操作失败，请重试",icon:"none"})}catch(s){console.error("请求失败:",s),e.index.showToast({title:"网络错误，请稍后再试",icon:"none"})}};return e.onShow((async()=>{console.log("onShow");let e=getCurrentPages();const t=e[e.length-1];console.log("onShow:",t.data.selectedAddress),t.data.selectedAddress&&(l.value=t.data.selectedAddress),await i()})),e.onMounted((async()=>{await i()})),(t,o)=>e.e({a:e.o((e=>t.$emit("close"))),b:"1"===e.unref(d)?"#FFEEEC":"#F9F9F9",c:e.o((e=>g("1"))),d:"2"===e.unref(d)?"#FFEEEC":"#F9F9F9",e:e.o((e=>g("2"))),f:e.t(e.unref(r)[0].province+e.unref(r)[0].city+e.unref(r)[0].area+e.unref(r)[0].address),g:e.t(e.unref(r)[0].name+" "+e.unref(r)[0].phone),h:e.o((t=>{return o="/pagesAddress/address/address?from=subOrder",void e.index.navigateTo({url:o});var o})),i:"1"===e.unref(d)},"1"===e.unref(d)?{j:e.t(e.unref(u)),k:e.sr("datePicker","538e96fa-0"),l:e.o(p),m:e.o((t=>e.isRef(u)?u.value=t:null)),n:e.p({type:"date",border:!1,modelValue:e.unref(u)})}:{},{o:"1"===e.unref(d)},"1"===e.unref(d)?{p:e.t(e.unref(c)),q:v(),r:e.o(h)}:{},{s:e.o(w)})}},s=e._export_sfc(o,[["__scopeId","data-v-538e96fa"]]);wx.createComponent(s);
