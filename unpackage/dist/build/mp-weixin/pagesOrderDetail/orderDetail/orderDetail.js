"use strict";const e=require("../../common/vendor.js");require("../../stores/tokenStore.js"),require("../../stores/userInfoStore.js");const t=require("../api/api.js");if(!Array){(e.resolveComponent("custom-header")+e.resolveComponent("van-image")+e.resolveComponent("uni-popup"))()}const n=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||((()=>"../../components/custom-header/custom-header.js")+e.unref(o)+n+e.unref(a)+e.unref(i)+e.unref(s))();const o=()=>"./components/payPannel.js",a=()=>"./components/rulePannel.js",s=()=>"./components/afterSalesPannel.js",i=()=>"./components/refundPannel.js",r={__name:"orderDetail",setup(n){const o=e.ref(null);e.ref();const a=e.ref(!1),s=e.ref(!1),i=e.ref(!1),r=e.ref(!1),u=e.ref(),l=e.ref("1"),c=e.ref("0"),f=e.computed((()=>!u||"待付款"!==u.type&&"待收货"!==u.type?"100vh":"calc(100vh - 180rpx)")),g=e.ref([{zt:["1"],text:"待付款!"},{zt:["3"],text:"等待发货"},{zt:["4"],text:"待收货"},{zt:["5"],text:"已收货"},{zt:["7"],text:"交易成功"}]),x=e=>{const t=g.value.find((t=>t.zt.includes(e.toString())));return t?t.text:""},p=e.ref([{type:"待付款",text:"相关商品他人付款后将无法购买，请尽快完成支付！",zt:["1"],lx:"2"},{type:"待发货",text:"平台发货前可修改收货信息！",isBargaining:!1,zt:["3"],lx:"2"},{type:"待收货",text:"物品已签收，请确认收货！",isSign:!0,zt:["4"],lx:"2"}]),d=e=>{const t=p.value.find((t=>t.zt.includes(e.toString())));return t?t.text:""},m=e.ref(-1);e.ref([{name:"收货地址",value:"北京市朝阳区天安车公廟工业区天济大厦ab座5b 506",contacts:"金克丝 13502866873"},{name:"备注信息",value:"华为Mate 60 RS 非凡大师 华为Mate 60 RS 非凡大师 华为Mate 60 RS 非凡大师 华为Mate 60 RS 非凡大师 ",contacts:""}]);const v=e.ref([{name:"订单号",value:"NO.202303281234",image:"https://www.xzxskj.com/xcximg/icon_copy@3x.png",zt:["1","3","4","5","7"]},{name:"下单时间",value:"2024-03-12 15:00:00",image:"",zt:["1","3","4","5","7"]},{name:"付款时间",value:"2024-03-12 15:00:00",image:"",zt:["3","4","5","7"]},{name:"发货时间",value:"2024-03-12 15:00:00",image:"",zt:["4","5","7"]},{name:"收货方式",value:"顺丰 154548785112",image:"https://www.xzxskj.com/xcximg/icon_copy@3x.png",zt:["4","5","7"]},{name:"收货时间",value:"2024-03-12 15:00:00",image:"https://www.xzxskj.com/xcximg/icon_copy@3x.png",zt:["5","7"]}]),w=e.ref([{type:"待付款",zt:["1"],btns:[]},{type:"待发货",zt:["3"],btns:[{text:"联系客服",image:"https://www.xzxskj.com/xcximg/icon_kefu@3x.png"},{text:"修改确认",image:"https://www.xzxskj.com/xcximg/icon_save@3x.png"},{text:"催发货",image:"https://www.xzxskj.com/xcximg/icon_cuifahuo@3x.png"},{text:"申请退款",image:"https://www.xzxskj.com/xcximg/icon_tuikuan@3x.png"}]},{type:"待收货",zt:["4"],btns:[{text:"联系客服",image:"https://www.xzxskj.com/xcximg/icon_kefu@3x.png"},{text:"查看物流",image:"https://www.xzxskj.com/xcximg/icon_wuliu@3x.png"}]},{type:"已收货",zt:["5"],btns:[{text:"联系客服",image:"https://www.xzxskj.com/xcximg/icon_kefu@3x.png"},{text:"查看物流",image:"https://www.xzxskj.com/xcximg/icon_wuliu@3x.png"},{text:"申请售后",image:"https://www.xzxskj.com/xcximg/icon_tuikuan@3x.png"}]},{type:"交易成功",zt:["7"],btns:[{text:"联系客服",image:"https://www.xzxskj.com/xcximg/icon_kefu@3x.png"},{text:"查看物流",image:"https://www.xzxskj.com/xcximg/icon_wuliu@3x.png"},{text:"申请售后",image:"https://www.xzxskj.com/xcximg/icon_tuikuan@3x.png"}]}]),z=e.ref(),h=e=>{R(),console.log("selectedPayment",e),z.value=e,l.value=e.payment,console.log("选择的支付类型：",e)},y=e=>{const t=w.value.find((t=>t.zt.includes(e)));return t?t.btns:[]},k=e=>{console.log(e),console.log("进来了吗");let t=[];return"1"===e.zt&&(e.gooinfos.gjbbname&&t.push(e.gooinfos.gjbbname),e.gooinfos.wlbbname&&t.push(e.gooinfos.wlbbname),e.gooinfos.bxzt&&t.push(e.gooinfos.bxzt),e.gooinfos.efficiency&&t.push(`电池${e.gooinfos.efficiency}%`),e.gooinfos.delivery&&t.push(`${e.gooinfos.delivery}发货`)),t.join("丨")},b=e.ref([{image:"https://www.xzxskj.com/xcximg/icon_shunfeng@3x.png",value:"顺丰",expressId:"2"},{image:"https://www.xzxskj.com/xcximg/icon_jingdong@3x.png",value:"京东",expressId:"1"},{image:"https://www.xzxskj.com/xcximg/icon_songhuo@3x.png",value:"送货上门",expressId:"3"},{image:"https://www.xzxskj.com/xcximg/icon_ziti@3x.png",value:"自提",expressId:"4"}]),S=e.ref(0),j=e.ref([]),_=async()=>{if(j.value=[],F&&F.value){const n={opid:e.index.getStorageSync("sessionInfo").opid,addid:F.value.id,goodsid:JSON.stringify(I())},o=await t.apiGetJdFreight(n);"200"===o.code&&(j.value=o.yflist),console.log("京东运费:",o)}},P=async()=>{if(j.value=[],F&&F.value){const e={addid:F.value.id,goodsid:JSON.stringify(I())},n=await t.apiGetSfFreight(e);"200"===n.code&&(j.value=n.yflist),console.log("顺丰运费:",n)}},I=()=>{const e={};console.log("orderInfo",u.value),u.value.gwclist.forEach((t=>{const n=t.gooinfos.shopid,o=t.gooinfos.id;e[n]||(e[n]=[]),e[n].push({goodsid:o})}));return Object.entries(e).map((([e,t])=>({companyId:e,goodsinfos:t})))},T=()=>{let e=0;return console.log("yflist.value",j.value),j.value&&j.value.forEach((t=>{e+=parseFloat(t.price)})),c&&c.value&&(c.value=e),c.value},A=e.ref(null),O=e.ref(null),B=e.ref(null),M=e.ref(null),C=e.ref(!0),$=()=>{r.value=!0,A.value.open()},q=()=>{i.value=!0,O.value.open()},J=()=>{a.value=!0,B.value.open()},N=()=>{s.value=!0,M.value.open()},R=()=>{console.log("Popup is closed"),M.value.close(),A.value.close(),O.value.close(),B.value.close(),C.value=!0},D=e=>{console.log("点击了遮罩e:",e),C.value=!e.show,e.show||(a.value=e.show,s.value=e.show,i.value=e.show,r.value=e.show)},F=e.ref(),G=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`},E=async()=>{const n={id:u.value.id,addid:F.value.id,remarks:u.value.remarks},o=await t.apiOrderEdit(n);"200"===o.code?(e.index.showToast({title:"修改成功",icon:"success",duration:1e3}),setTimeout((()=>{Y(u.value.id)}),500)):e.index.showToast({title:o.msg||"操作失败",icon:"error",duration:1e3})},H=()=>{console.log("立即付款"),"1"===l.value&&L(u.value.id)},L=async n=>{const o={id:n,opid:e.index.getStorageSync("sessionInfo").opid},a=await t.apiGetWxPay(o);console.log("wx支付参数:",a);const s={nonceStr:a.nonceStr,package:a.package,paySign:a.paySign,timeStamp:a.timeStamp,signType:a.signType};W(s)},W=t=>{e.index.requestPayment({provider:"wxpay",...t,success(t){console.log("success:"+JSON.stringify(t)),console.log("支付成功"),e.index.showToast({title:"支付成功",icon:"success",duration:1e3}),e.index.navigateBack()},fail(t){console.log("pay fail:",JSON.stringify(t)),console.log("支付失败"),e.index.showToast({title:"支付失败",icon:"none",duration:1e3})}})},Y=async e=>{var n;const o={lx:"5",id:e},a=await t.apiGetOrderDetail(o);"200"===a.code&&(u.value=a.infos,F.value=a.infos.addinfos,S.value=b.value.findIndex((e=>e.expressId==a.infos.expressid)),a.infos.zyf&&(c.value=a.infos.zyf)),v.value=[{name:"订单号",value:u.value.ordernumber||" ",image:"https://www.xzxskj.com/xcximg/icon_copy@3x.png",zt:["1","3","4","5","7"]},{name:"下单时间",value:G(a.infos.add_time)||" ",image:"",zt:["1","3","4","5","7"]},{name:"付款时间",value:G(a.infos.pay_time)||" ",image:"",zt:["3","4","5","7"]},{name:"发货时间",value:G(a.infos.fhsj)||" ",image:"",zt:["4","5","7"]},{name:"收货方式",value:(null==(n=b.value.find((e=>e.expressId==a.infos.expressid)))?void 0:n.value)||" ",image:"https://www.xzxskj.com/xcximg/icon_copy@3x.png",zt:["4","5","7"]},{name:"收货时间",value:G(a.infos.shsj)||" ",image:"https://www.xzxskj.com/xcximg/icon_copy@3x.png",zt:["5","7"]}],console.log("res",a)},K=e.ref(null);return e.onShow((()=>{console.log("onShow");let e=getCurrentPages();const t=e[e.length-1];console.log("onShow:",t.data.selectedAddress),t.data.selectedAddress&&(console.log("prevPage.data.selectedAddress:",t.data.selectedAddress),F.value=t.data.selectedAddress)})),e.onMounted((()=>{})),e.onLoad((e=>{e.orderId&&Y(e.orderId)})),e.onReady((()=>{setTimeout((()=>{o&&o.value&&(console.log("调用了"),o.value.selectTap(2))}),1e3)})),e.onShow((async()=>{console.log("onShow");let e=getCurrentPages();const t=e[e.length-1];console.log("onShow:",t.data.selectedAddress),t.data.selectedAddress&&(K.value=t.data.selectedAddress),console.log("selectedAddress",K.value)})),(t,n)=>{return e.e({a:e.unref(u)},e.unref(u)?e.e({b:e.unref(u)},e.unref(u)?e.e({c:e.t(x(e.unref(u).zt)),d:d(e.unref(u).zt)},d(e.unref(u).zt)?{e:e.t(d(e.unref(u).zt))}:{},{f:y(e.unref(u).zt).length},y(e.unref(u).zt).length?{g:e.f(y(e.unref(u).zt,e.unref(u).lx),((n,o,i)=>e.e({a:n.image,b:e.t(n.text),c:"联系客服"===n.text},"联系客服"===n.text?{d:e.o(((...e)=>t.onContact&&t.onContact(...e)),o)}:{},{e:o,f:e.o((t=>(t=>{console.log("Button clicked:",t.text),"查看物流"===t.text&&e.index.navigateTo({url:"plugin://kdzs-plugin/logistics-list?num=JD0125961163521&appName=数码购机&title=物流信息"}),"申请售后"===t.text&&(a.value=!0,m.value=-1,setTimeout((()=>{J()}),200)),"申请退款"===t.text&&(s.value=!0,m.value=-1,N()),"修改确认"===t.text&&E()})(n)),o)})))}:{},{h:("1"==e.unref(u).zt||"3"==e.unref(u).zt)&&e.unref(F)},"1"!=e.unref(u).zt&&"3"!=e.unref(u).zt||!e.unref(F)?{}:e.e({i:"1"===e.unref(F).zt},(e.unref(F).zt,{}),{j:e.t(e.unref(F).province),k:e.t(e.unref(F).city),l:e.t(e.unref(F).area),m:e.t(e.unref(F).address),n:e.t(e.unref(F).name),o:e.t(e.unref(F).phone),p:e.o((t=>{return n="/pagesAddress/address/address?from=subOrder",void e.index.navigateTo({url:n});var n})),q:e.f(e.unref(b),((t,n,o)=>e.e({a:t.image,b:e.t(t.value),c:e.unref(S)===n},(e.unref(S),{}),{d:n,e:e.unref(S)===n?1:"",f:e.o((e=>(async e=>{"待付款"===u.type&&(S.value=e,"顺丰"===b.value[e].value&&await P(),"京东"===b.value[e].value&&await _(),"送货上门"===b.value[e].value&&(j.value=[]),"自提"===b.value[e].value&&(j.value=[]))})(n)),n)})))}),{r:e.f(e.unref(u).gwclist,((t,n,o)=>e.e({a:"36ec889b-1-"+o,b:e.p({width:"190rpx",height:"190rpx",radius:"18rpx",src:t.gooinfos.cover,fit:"fill"}),c:t.gooinfos.finenessname},t.gooinfos.finenessname?{d:e.t(t.gooinfos.finenessname)}:{},{e:e.t(t.gooinfos.name),f:"1"===t.gooinfos.zt},"1"===t.gooinfos.zt?{g:e.t(k(t))}:{h:e.t(t.gooinfos.ch)},{i:e.t(t.gooinfos.price)},(e.unref(u).isBargaining,{}),e.unref(u).isBargaining?{j:e.t(t.originalPrice)}:{},"3"===e.unref(u).zt&&"2"===e.unref(u).lx?{k:e.o((e=>(e=>{console.log("单台退款"),s.value=!0,m.value=e,setTimeout((()=>{N()}),200)})(n)),n)}:{},"4"===e.unref(u).zt||"5"===e.unref(u).zt?{l:e.o((e=>(e=>{console.log("单台售后"),a.value=!0,m.value=e,setTimeout((()=>{J()}),200)})(n)),n)}:{},{m:n}))),s:!e.unref(u).isBargaining,t:e.unref(u).isBargaining,v:"3"===e.unref(u).zt&&"2"===e.unref(u).lx,w:"4"===e.unref(u).zt||"5"===e.unref(u).zt,x:e.t(e.unref(u).price),y:e.o(q),z:e.t(T()),A:"1"!==e.unref(u).lx},"1"!==e.unref(u).lx?{B:e.t(e.unref(u).num)}:{},{C:e.t(e.unref(u).price),D:"1"==e.unref(u).zt},"1"==e.unref(u).zt?{E:e.unref(z)?e.unref(z).image:"https://www.xzxskj.com/xcximg/icon_weixin@3x.png",F:e.t(e.unref(z)?e.unref(z).text:"微信支付"),G:e.o($)}:{},{H:"1"==e.unref(u).zt||"2"==e.unref(u).zt},"1"==e.unref(u).zt||"2"==e.unref(u).zt?{I:e.unref(u).remarks,J:e.o((t=>e.unref(u).remarks=t.detail.value))}:{},{K:e.sr(o,"36ec889b-3,36ec889b-2",{k:"payPannelRef"}),L:e.o(R),M:e.o(h),N:e.sr(A,"36ec889b-2",{k:"payPopup"}),O:e.o(R),P:e.o(D),Q:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"}),R:e.unref(i)},e.unref(i)?{S:e.o(R)}:{},{T:e.sr(O,"36ec889b-4",{k:"rulePopup"}),U:e.o(R),V:e.o(D),W:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"}),X:e.unref(s)},e.unref(s)?{Y:e.o(R),Z:e.p({itemIndex:e.unref(m)})}:{},{aa:e.sr(M,"36ec889b-6",{k:"refundPopup"}),ab:e.o(R),ac:e.o(D),ad:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"}),ae:e.unref(a)},e.unref(a)?{af:e.o(R),ag:e.p({itemIndex:e.unref(m)})}:{},{ah:e.sr(B,"36ec889b-8",{k:"afterSalesPopup"}),ai:e.o(R),aj:e.o(D),ak:e.p({"background-color":"rgba(0,0,0,0)","is-mask-click":!0,"safe-area":!1,type:"bottom"}),al:"1"!==e.unref(u).zt&&"2"!==e.unref(u).zt&&"3"!==e.unref(u).zt&&"4"!==e.unref(u).ddlx},"1"!==e.unref(u).zt&&"2"!==e.unref(u).zt&&"3"!==e.unref(u).zt&&"4"!==e.unref(u).ddlx?{am:e.t(e.unref(F).province),an:e.t(e.unref(F).city),ao:e.t(e.unref(F).area),ap:e.t(e.unref(F).address),aq:e.t(e.unref(F).name),ar:e.t(e.unref(F).phone)}:{},{as:"1"!==e.unref(u).zt},"1"!==e.unref(u).zt?{at:e.t(e.unref(u).remarks)}:{},{av:e.f((r=e.unref(u).zt,v.value.filter((e=>e.zt.includes(r)))),((t,n,o)=>e.e({a:e.t(t.name),b:e.t(t.value),c:t.image},t.image?{d:t.image}:{},{e:n}))),aw:"1"==e.unref(u).zt},(e.unref(u).zt,{}),{ax:"4"==e.unref(u).zt},(e.unref(u).zt,{}),{ay:"1"==e.unref(u).zt},"1"==e.unref(u).zt?{az:e.o(H)}:{}):{},{aA:e.unref(C)&&e.unref(u),aB:e.unref(f)}):{});var r}}},u=e._export_sfc(r,[["__scopeId","data-v-36ec889b"]]);wx.createPage(u);
