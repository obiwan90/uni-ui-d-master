"use strict";const e=require("../../../common/vendor.js"),t=require("../../api/api.js");if(!Array){e.resolveComponent("uni-datetime-picker")()}Math;const o={__name:"userServicePannel",props:{order:{type:Object,default:{}}},emits:["close","subExpress"],setup(o,{emit:a}){const n=o,s=a,r=e.ref([]),l=e.ref(null),u=async()=>{if(l.value)r.value=[l.value];else{const o={opid:e.index.getStorageSync("sessionInfo").opid},a=await t.apigetAddress(o);a.lists&&a.lists.length>0?(r.value=a.lists.filter((e=>"1"===e.zt)),console.log("addressList1:",r.value)):r.value=[],console.log("addressList2:",r.value)}},i=e.ref((new Date).toISOString().split("T")[0]),d=e.ref("请选择时间"),c=e.ref("1"),g=e.ref(["08:00:00-09:00:00","09:00:00-10:00:00","10:00:00-11:00:00","11:00:00-12:00:00","12:00:00-13:00:00","13:00:00-14:00:00","14:00:00-15:00:00","15:00:00-16:00:00","16:00:00-17:00:00","17:00:00-18:00:00","18:00:00-19:00:00"]);g.value.filter((e=>{const t=(()=>{const e=new Date;return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`})(),[o,a]=e.split("-");return console.log(`Comparing: start=${o}, end=${a}, currentTime=${t}`),v(i.value)?t>=o&&t<=a:e}));const v=e=>{console.log("dateString",e);const t=new Date,o=new Date(e);return t.getFullYear()===o.getFullYear()&&t.getMonth()===o.getMonth()&&t.getDate()===o.getDate()},f=e=>{c.value=e,"2"===e&&(i.value="请选择日期",d.value="请选择时间")},p=e=>{console.log("选择的日期:",e),i.value=e},m=e=>{console.log("选择的时间范围:",updatedTimeRange.value[e.detail.value]),d.value=updatedTimeRange.value[e.detail.value]},w=async()=>{"1"!==c.value||"请选择日期"!==i.value?"1"!==c.value||"请选择时间"!==d.value?(console.log("提交日期：",i.value),console.log("提交时间范围：",d.value),console.log("邮寄方式：",c.value),await S()):e.index.showToast({title:"请选择上门时间范围",icon:"none"}):e.index.showToast({title:"请选择上门日期",icon:"none"})};function h(e){console.log("orders",e);const t=new Set(e.orders.map((e=>e.id)));return Array.from(t).join(",")}const S=async()=>{const o={lx:"1",id:h(n.order),thfs:c.value,thdz:r.value[0].id,qjrq:"1"===c.value?i.value:"",qjsj:"1"===c.value?d.value:""};try{200===(await t.apiBookingExpress(o)).code?setTimeout((()=>{s("close"),s("subExpress",n.order)}),500):e.index.showToast({title:"操作失败，请重试",icon:"none"})}catch(a){console.error("请求失败:",a),e.index.showToast({title:"网络错误，请稍后再试",icon:"none"})}};return e.onShow((async()=>{console.log("onShow");let e=getCurrentPages();const t=e[e.length-1];console.log("onShow:",t.data.selectedAddress),t.data.selectedAddress&&(l.value=t.data.selectedAddress),await u()})),e.onMounted((async()=>{await u()})),(t,o)=>e.e({a:e.o((e=>t.$emit("close"))),b:"1"===e.unref(c)?"#FFEEEC":"#F9F9F9",c:e.o((e=>f("1"))),d:"2"===e.unref(c)?"#FFEEEC":"#F9F9F9",e:e.o((e=>f("2"))),f:e.t(e.unref(r)[0].province+e.unref(r)[0].city+e.unref(r)[0].area+e.unref(r)[0].address),g:e.t(e.unref(r)[0].name+" "+e.unref(r)[0].phone),h:e.o((t=>{return o="/pagesAddress/address/address?from=subOrder",void e.index.navigateTo({url:o});var o})),i:"1"===e.unref(c)},"1"===e.unref(c)?{j:e.t(e.unref(i)),k:e.sr("datePicker","a78ca7bb-0"),l:e.o(p),m:e.o((t=>e.isRef(i)?i.value=t:null)),n:e.p({type:"date",border:!1,modelValue:e.unref(i)})}:{},{o:"1"===e.unref(c)},"1"===e.unref(c)?{p:e.t(e.unref(d)),q:t.updatedTimeRange,r:e.o(m)}:{},{s:e.o(w)})}},a=e._export_sfc(o,[["__scopeId","data-v-a78ca7bb"]]);wx.createComponent(a);
